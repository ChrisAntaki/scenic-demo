{"version":3,"sources":["node_modules/browser-pack/_prelude.js","build/css/components/dialog.css.js","build/css/ui/ui.css.js","node_modules/promise-pjs/promise.js","node_modules/web-activities/activity-ports.js","src/api/deferred-account-creation.js","src/api/entitlements.js","src/api/offer.js","src/api/subscribe-response.js","src/api/subscriptions.js","src/api/user-data.js","src/components/dialog-manager.js","src/components/dialog.js","src/components/friendly-iframe.js","src/components/graypane.js","src/components/view.js","src/main-babel.js","src/main.js","src/model/doc.js","src/model/page-config-resolver.js","src/model/page-config.js","src/polyfills.js","src/polyfills/array-includes.js","src/polyfills/document-contains.js","src/polyfills/domtokenlist-toggle.js","src/polyfills/math-sign.js","src/polyfills/object-assign.js","src/polyfills/promise.js","src/runtime/button-api.js","src/runtime/callbacks.js","src/runtime/deferred-account-flow.js","src/runtime/deps.js","src/runtime/entitlements-manager.js","src/runtime/fetcher.js","src/runtime/link-accounts-flow.js","src/runtime/offers-api.js","src/runtime/offers-flow.js","src/runtime/pay-flow.js","src/runtime/runtime.js","src/runtime/services.js","src/runtime/storage.js","src/ui/activity-iframe-view.js","src/ui/loading-view.js","src/ui/toast.js","src/utils/activity-utils.js","src/utils/animation.js","src/utils/bytes.js","src/utils/document-ready.js","src/utils/dom.js","src/utils/errors.js","src/utils/json.js","src/utils/jwt.js","src/utils/log.js","src/utils/object.js","src/utils/preconnect.js","src/utils/string.js","src/utils/style.js","src/utils/types.js","src/utils/url.js","src/utils/xhr.js","third_party/babel/custom-babel-helpers.js"],"names":[],"mappings":"AAAA;;ACAO,IAAM,GAAG,GAAG,wuCAAwuC,CAAC;;;;;ACArvC,IAAM,GAAG,GAAG,wpbAAwpb,CAAC;;;;ACA5qb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACngBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;4BCxgD2B,gBAAgB;;iCAChB,sBAAsB;;wBAC1B,aAAa;;;;;;;;;;;;;AAc7B,IAAI,8BAA8B,YAAA,CAAC;;;;;;IAK7B,+BAA+B;;;;;;;;;AAQ/B,WARA,+BAA+B,CAQ9B,YAAY,EAAE,QAAQ,EAAE,YAAY,EAAE,eAAe,EAAE;sCARxD,+BAA+B;;;AAUxC,QAAI,CAAC,YAAY,GAAG,YAAY,CAAC;;AAEjC,QAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;;AAEzB,QAAI,CAAC,YAAY,GAAG,YAAY,CAAC;;AAEjC,QA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","file":"subscriptions.max.js","sourceRoot":"/source/","sourcesContent":["(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()","export const CSS = \".swg-dialog,.swg-toast{box-sizing:border-box;background-color:#fff!important}@media (max-height:640px), (max-width:640px){.swg-dialog,.swg-toast{width:480px!important;left:-240px!important;margin-left:50vw!important;border-top-left-radius:8px!important;border-top-right-radius:8px!important;box-shadow:0 1px 1px rgba(60,64,67,.3),0 1px 4px 1px rgba(60,64,67,.15)!important}}@media (min-width:640px) and (min-height:640px){.swg-dialog{width:630px!important;left:-315px!important;margin-left:50vw!important;background-color:transparent!important;border:none!important}}@media (max-width:480px){.swg-dialog,.swg-toast{width:100%!important;left:0!important;right:0!important;margin-left:0!important;border-top-left-radius:8px!important;border-top-right-radius:8px!important;box-shadow:0 1px 1px rgba(60,64,67,.3),0 1px 4px 1px rgba(60,64,67,.15)!important}}@-webkit-keyframes swg-notify{0%{-webkit-transform:translateY(100%);transform:translateY(100%);opacity:0}to{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}}@-webkit-keyframes swg-notify-hide{0%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}to{-webkit-transform:translateY(100%);transform:translateY(100%);opacity:0}}\\n/*# sourceURL=/./src/components/dialog.css*/\";","export const CSS = \"body{padding:0;margin:0}swg-container,swg-loading,swg-loading-animate,swg-loading-image{display:block}swg-loading-container{width:100%!important;display:-webkit-box!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-align:center!important;-ms-flex-align:center!important;align-items:center!important;-webkit-box-pack:center!important;-ms-flex-pack:center!important;justify-content:center!important;min-height:148px!important;height:100%!important;bottom:0!important;margin-top:5px!important;z-index:2147483647!important}@media (min-height:630px), (min-width:630px){swg-loading-container{width:560px!important;margin-left:35px!important;border-top-left-radius:8px!important;border-top-right-radius:8px!important;background-color:#fff!important;box-shadow:0 1px 1px rgba(60,64,67,.3),0 1px 4px 1px rgba(60,64,67,.15)!important}}swg-loading{z-index:2147483647!important;width:36px;height:36px;overflow:hidden;-webkit-animation:mspin-rotate 1568.63ms infinite linear;animation:mspin-rotate 1568.63ms infinite linear}swg-loading-animate{-webkit-animation:mspin-revrot 5332ms infinite steps(4);animation:mspin-revrot 5332ms infinite steps(4)}swg-loading-image{background-image:url('data:image/svg+xml;charset=utf-8;base64,DQo8c3ZnIHZlcnNpb249IjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxMTY2NCIgaGVpZ2h0PSIzNiIgdmlld0JveD0iMCAwIDExNjY0IDM2Ij48ZGVmcz48cGF0aCBpZD0iYSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iNTguOSIgZD0iTTE4IDUuNUExMi41IDEyLjUgMCAxIDEgNS41IDE4IiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiLz48ZyBpZD0iYiI+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjE3Ni42NiIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNzYuNTgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM2KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNzYuMzIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDcyKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNzUuODUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwOCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTc1LjE0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDQpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjE3NC4xMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTgwKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNzIuNzgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIxNikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTcxLjAxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNTIpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjE2OC43OCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjg4KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNjYuMDIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMyNCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTYyLjczIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzNjApIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjE1OS4wMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzk2KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNTUuMDQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQzMikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTUxLjA1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0NjgpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjE0Ny4yMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNTA0KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxNDMuNzEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDU0MCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTQwLjU0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NzYpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjEzNy43MiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjEyKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMzUuMjEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY0OCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTMyLjk4IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2ODQpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjEzMS4wMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzIwKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMjkuMjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDc1NikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTI3LjcxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg3OTIpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjEyNi4zMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODI4KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMjUuMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODY0KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMjQuMDEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDkwMCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTIzLjA0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5MzYpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjEyMi4xOSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOTcyKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMjEuNDMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwMDgpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjEyMC43NyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTA0NCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTIwLjE5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMDgwKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMTkuNjkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDExMTYpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjExOS4yNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTE1MikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTE4Ljg5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTg4KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMTguNTgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyMjQpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjExOC4zMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTI2MCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTE4LjEzIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjk2KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMTcuOTgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEzMzIpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjExNy44OCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTM2OCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTE3LjgyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDA0KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMTcuOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTQ0MCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTE3LjcyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDc2KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMTcuNDYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1MTIpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjExNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTU0OCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTE2LjI5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNTg0KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMTUuMjkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2MjApIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjExMy45NCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTY1NikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTEyLjE5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNjkyKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMDkuOTciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE3MjgpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjEwNy4yMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTc2NCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iMTAzLjk2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxODAwKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSIxMDAuMjciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4MzYpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9Ijk2LjMyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxODcyKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI5Mi4zNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTkwOCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iODguNTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE5NDQpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9Ijg1LjA3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxOTgwKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI4MS45MiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjAxNikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNzkuMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIwNTIpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9Ijc2LjYxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMDg4KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI3NC40IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMTI0KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI3Mi40NSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjE2MCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNzAuNzEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIxOTYpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjY5LjE2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMjMyKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI2Ny43OSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjI2OCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjYuNTciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIzMDQpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjY1LjQ5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMzQwKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI2NC41MyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjM3NikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjMuNjgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI0MTIpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjYyLjkzIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNDQ4KSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI2Mi4yNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjQ4NCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjEuNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjUyMCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjEuMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjU1NikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjAuNzciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1OTIpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjYwLjQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2MjgpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjYwLjEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2NjQpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjU5Ljg1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNzAwKSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI1OS42NSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjczNikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNTkuNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjc3MikiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNTkuNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjgwOCkiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNTkuMzQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI4NDQpIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjU5LjMyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyODgwKSIvPjwvZz48ZyBpZD0iYyI+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjcwLjcxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMTk2KSIgb3BhY2l0eT0iLjA1Ii8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjY5LjE2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMjMyKSIgb3BhY2l0eT0iLjEiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjcuNzkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyNjgpIiBvcGFjaXR5PSIuMTUiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjYuNTciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIzMDQpIiBvcGFjaXR5PSIuMiIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI2NS40OSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjM0MCkiIG9wYWNpdHk9Ii4yNSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI2NC41MyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjM3NikiIG9wYWNpdHk9Ii4zIi8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjYzLjY4IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNDEyKSIgb3BhY2l0eT0iLjM1Ii8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjYyLjkzIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNDQ4KSIgb3BhY2l0eT0iLjQiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjIuMjciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI0ODQpIiBvcGFjaXR5PSIuNDUiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjEuNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjUyMCkiIG9wYWNpdHk9Ii41Ii8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjYxLjIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1NTYpIiBvcGFjaXR5PSIuNTUiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNjAuNzciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1OTIpIiBvcGFjaXR5PSIuNiIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI2MC40IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNjI4KSIgb3BhY2l0eT0iLjY1Ii8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjYwLjEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2NjQpIiBvcGFjaXR5PSIuNyIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI1OS44NSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjcwMCkiIG9wYWNpdHk9Ii43NSIvPjx1c2UgeGxpbms6aHJlZj0iI2EiIHN0cm9rZS1kYXNob2Zmc2V0PSI1OS42NSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjczNikiIG9wYWNpdHk9Ii44Ii8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjU5LjUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI3NzIpIiBvcGFjaXR5PSIuODUiLz48dXNlIHhsaW5rOmhyZWY9IiNhIiBzdHJva2UtZGFzaG9mZnNldD0iNTkuNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjgwOCkiIG9wYWNpdHk9Ii45Ii8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjU5LjM0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyODQ0KSIgb3BhY2l0eT0iLjk1Ii8+PHVzZSB4bGluazpocmVmPSIjYSIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjU5LjMyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyODgwKSIvPjwvZz48L2RlZnM+PHVzZSB4bGluazpocmVmPSIjYiIgc3Ryb2tlPSIjNDI4NWY0Ii8+PHVzZSB4bGluazpocmVmPSIjYyIgc3Ryb2tlPSIjZGI0NDM3Ii8+PHVzZSB4bGluazpocmVmPSIjYiIgc3Ryb2tlPSIjZGI0NDM3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyOTE2KSIvPjx1c2UgeGxpbms6aHJlZj0iI2MiIHN0cm9rZT0iI2Y0YjQwMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjkxNikiLz48dXNlIHhsaW5rOmhyZWY9IiNiIiBzdHJva2U9IiNmNGI0MDAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDU4MzIpIi8+PHVzZSB4bGluazpocmVmPSIjYyIgc3Ryb2tlPSIjMGY5ZDU4IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1ODMyKSIvPjx1c2UgeGxpbms6aHJlZj0iI2IiIHN0cm9rZT0iIzBmOWQ1OCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODc0OCkiLz48dXNlIHhsaW5rOmhyZWY9IiNjIiBzdHJva2U9IiM0Mjg1ZjQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDg3NDgpIi8+PC9zdmc+');background-size:100%;width:11664px;height:36px;-webkit-animation:swg-loading-film 5332ms infinite steps(324);animation:swg-loading-film 5332ms infinite steps(324)}@-webkit-keyframes swg-loading-film{0%{-webkit-transform:translateX(0);transform:translateX(0)}to{-webkit-transform:translateX(-11664px);transform:translateX(-11664px)}}@keyframes swg-loading-film{0%{-webkit-transform:translateX(0);transform:translateX(0)}to{-webkit-transform:translateX(-11664px);transform:translateX(-11664px)}}@-webkit-keyframes mspin-rotate{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes mspin-rotate{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes mspin-revrot{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(-360deg);transform:rotate(-360deg)}}@keyframes mspin-revrot{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(-360deg);transform:rotate(-360deg)}}\\n/*# sourceURL=/./src/ui/ui.css*/\";","'use strict';\n\n/**\n * Constructs a ES6/Promises A+ Promise instance.\n *\n * @constructor\n * @param {function(function(*=), function (*=))} resolver\n */\nfunction Promise(resolver) {\n  if (!(this instanceof Promise)) {\n    throw new TypeError('Constructor Promise requires `new`');\n  }\n  if (!isFunction(resolver)) {\n    throw new TypeError('Must pass resolver function');\n  }\n\n  /**\n   * @type {function(this:Promise,*=,function(*=),function(*=),Deferred):!Promise}\n   * @private\n   */\n  this._state = PendingPromise;\n\n  /**\n   * @type {*}\n   * @private\n   */\n  this._value = [];\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this._isChainEnd = true;\n\n  doResolve(\n    this,\n    adopter(this, FulfilledPromise),\n    adopter(this, RejectedPromise),\n    { then: resolver }\n  );\n}\n\n/****************************\n  Public Instance Methods\n ****************************/\n\n/**\n * Creates a new promise instance that will receive the result of this promise\n * as inputs to the onFulfilled or onRejected callbacks.\n *\n * @param {function(*)} onFulfilled\n * @param {function(*)} onRejected\n */\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  onFulfilled = isFunction(onFulfilled) ? onFulfilled : void 0;\n  onRejected = isFunction(onRejected) ? onRejected : void 0;\n\n  if (onFulfilled || onRejected) {\n    this._isChainEnd = false;\n  }\n\n  return this._state(\n    this._value,\n    onFulfilled,\n    onRejected\n  );\n};\n\n/**\n * Creates a new promise that will handle the rejected state of this promise.\n *\n * @param {function(*)} onRejected\n * @returns {!Promise}\n */\nPromise.prototype.catch = function(onRejected) {\n  return this.then(void 0, onRejected);\n};\n\n/****************************\n  Public Static Methods\n ****************************/\n\n/**\n * Creates a fulfilled Promise of value. If value is itself a then-able,\n * resolves with the then-able's value.\n *\n * @this {!Promise}\n * @param {*=} value\n * @returns {!Promise}\n */\nPromise.resolve = function(value) {\n  var Constructor = this;\n  var promise;\n\n  if (isObject(value) && value instanceof this) {\n    promise = value;\n  } else {\n    promise = new Constructor(function(resolve) {\n      resolve(value);\n    });\n  }\n\n  return /** @type {!Promise} */(promise);\n};\n\n/**\n * Creates a rejected Promise of reason.\n *\n * @this {!Promise}\n * @param {*=} reason\n * @returns {!Promise}\n */\nPromise.reject = function(reason) {\n  var Constructor = this;\n  var promise = new Constructor(function(_, reject) {\n    reject(reason);\n  });\n\n  return /** @type {!Promise} */(promise);\n};\n\n/**\n * Creates a Promise that will resolve with an array of the values of the\n * passed in promises. If any promise rejects, the returned promise will\n * reject.\n *\n * @this {!Promise}\n * @param {!Array<Promise|*>} promises\n * @returns {!Promise}\n */\nPromise.all = function(promises) {\n  var Constructor = this;\n  var promise = new Constructor(function(resolve, reject) {\n    var length = promises.length;\n    var values = new Array(length);\n\n    if (length === 0) {\n      return resolve(values);\n    }\n\n    each(promises, function(promise, index) {\n      Constructor.resolve(promise).then(function(value) {\n        values[index] = value;\n        if (--length === 0) {\n          resolve(values);\n        }\n      }, reject);\n    });\n  });\n\n  return /** @type {!Promise} */(promise);\n};\n\n/**\n * Creates a Promise that will resolve or reject based on the first\n * resolved or rejected promise.\n *\n * @this {!Promise}\n * @param {!Array<Promise|*>} promises\n * @returns {!Promise}\n */\nPromise.race = function(promises) {\n  var Constructor = this;\n  var promise = new Constructor(function(resolve, reject) {\n    for (var i = 0; i < promises.length; i++) {\n      Constructor.resolve(promises[i]).then(resolve, reject);\n    }\n  });\n\n  return /** @type {!Promise} */(promise);\n};\n\nvar onPossiblyUnhandledRejection = function(reason, promise) {\n  throw reason;\n};\n\n/**\n * An internal use static function.\n */\nPromise._overrideUnhandledExceptionHandler = function(handler) {\n  onPossiblyUnhandledRejection = handler;\n};\n\n/****************************\n  Private functions\n ****************************/\n\n/**\n * The Fulfilled Promise state. Calls onFulfilled with the resolved value of\n * this promise, creating a new promise.\n *\n * If there is no onFulfilled, returns the current promise to avoid an promise\n * instance.\n *\n * @this {!Promise} The current promise\n * @param {*=} value The current promise's resolved value.\n * @param {function(*=)=} onFulfilled\n * @param {function(*=)=} unused\n * @param {Deferred} deferred A deferred object that holds a promise and its\n *     resolve and reject functions. It IS NOT passed when called from\n *     Promise#then to save an object instance (since we may return the current\n *     promise). It IS passed in when adopting the Fulfilled state from the\n *     Pending state.\n * @returns {!Promise}\n */\nfunction FulfilledPromise(value, onFulfilled, unused, deferred) {\n  if (!onFulfilled) {\n    deferredAdopt(deferred, FulfilledPromise, value);\n    return this;\n  }\n  if (!deferred) {\n    deferred = new Deferred(this.constructor);\n  }\n  defer(tryCatchDeferred(deferred, onFulfilled, value));\n  return deferred.promise;\n}\n\n/**\n * The Rejected Promise state. Calls onRejected with the resolved value of\n * this promise, creating a new promise.\n *\n * If there is no onRejected, returns the current promise to avoid an promise\n * instance.\n *\n * @this {!Promise} The current promise\n * @param {*=} reason The current promise's rejection reason.\n * @param {function(*=)=} unused\n * @param {function(*=)=} onRejected\n * @param {Deferred} deferred A deferred object that holds a promise and its\n *     resolve and reject functions. It IS NOT passed when called from\n *     Promise#then to save an object instance (since we may return the current\n *     promise). It IS passed in when adopting the Rejected state from the\n *     Pending state.\n * @returns {!Promise}\n */\nfunction RejectedPromise(reason, unused, onRejected, deferred) {\n  if (!onRejected) {\n    deferredAdopt(deferred, RejectedPromise, reason);\n    return this;\n  }\n  if (!deferred) {\n    deferred = new Deferred(this.constructor);\n  }\n  defer(tryCatchDeferred(deferred, onRejected, reason));\n  return deferred.promise;\n}\n\n/**\n * The Pending Promise state. Eventually calls onFulfilled once the promise has\n * resolved, or onRejected once the promise rejects.\n *\n * If there is no onFulfilled and no onRejected, returns the current promise to\n * avoid an promise instance.\n *\n * @this {!Promise} The current promise\n * @param {*=} queue The current promise's pending promises queue.\n * @param {function(*=)=} onFulfilled\n * @param {function(*=)=} onRejected\n * @param {Deferred} deferred A deferred object that holds a promise and its\n *     resolve and reject functions. It IS NOT passed when called from\n *     Promise#then to save an object instance (since we may return the current\n *     promise). It IS passed in when adopting the Pending state from the\n *     Pending state of another promise.\n * @returns {!Promise}\n */\nfunction PendingPromise(queue, onFulfilled, onRejected, deferred) {\n  if (!deferred) {\n    if (!onFulfilled && !onRejected) { return this; }\n    deferred = new Deferred(this.constructor);\n  }\n  queue.push({\n    deferred: deferred,\n    onFulfilled: onFulfilled || deferred.resolve,\n    onRejected: onRejected || deferred.reject\n  });\n  return deferred.promise;\n}\n\n/**\n * Constructs a deferred instance that holds a promise and its resolve and\n * reject functions.\n *\n * @constructor\n */\nfunction Deferred(Promise) {\n  var deferred = this;\n  /** @type {!Promise} */\n  this.promise = new Promise(function(resolve, reject) {\n    /** @type {function(*=)} */\n    deferred.resolve = resolve;\n\n    /** @type {function(*=)} */\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n\n/**\n * Transitions the state of promise to another state. This is only ever called\n * on with a promise that is currently in the Pending state.\n *\n * @param {!Promise} promise\n * @param {function(this:Promise,*=,function(*=),function(*=),Deferred):!Promise} state\n * @param {*=} value\n */\nfunction adopt(promise, state, value, adoptee) {\n  var queue = promise._value;\n  promise._state = state;\n  promise._value = value;\n\n  if (adoptee && state === PendingPromise) {\n    adoptee._state(value, void 0, void 0, {\n      promise: promise,\n      resolve: void 0,\n      reject: void 0\n    });\n  }\n\n  for (var i = 0; i < queue.length; i++) {\n    var next = queue[i];\n    promise._state(\n      value,\n      next.onFulfilled,\n      next.onRejected,\n      next.deferred\n    );\n  }\n  queue.length = 0;\n\n  // Determine if this rejected promise will be \"handled\".\n  if (state === RejectedPromise && promise._isChainEnd) {\n    setTimeout(function() {\n      if (promise._isChainEnd) {\n        onPossiblyUnhandledRejection(value, promise);\n      }\n    }, 0);\n  }\n}\n\n/**\n * A partial application of adopt.\n *\n * @param {!Promise} promise\n * @param {function(this:Promise,*=,function(*=),function(*=),Deferred):!Promise} state\n * @returns {function(*=)}\n */\nfunction adopter(promise, state) {\n  return function(value) {\n    adopt(promise, state, value);\n  };\n}\n\n/**\n * Updates a deferred promises state. Necessary for updating an adopting\n * promise's state when the adoptee resolves.\n *\n * @param {?Deferred} deferred\n * @param {function(this:Promise,*=,function(*=),function(*=),Deferred):!Promise} state\n * @param {*=} value\n */\nfunction deferredAdopt(deferred, state, value) {\n  if (deferred) {\n    var promise = deferred.promise;\n    promise._state = state;\n    promise._value = value;\n  }\n}\n\n/**\n * A no-op function to prevent double resolving.\n */\nfunction noop() {}\n\n/**\n * Tests if fn is a Function\n *\n * @param {*} fn\n * @returns {boolean}\n */\nfunction isFunction(fn) {\n  return typeof fn === 'function';\n}\n\n/**\n * Tests if fn is an Object\n *\n * @param {*} obj\n * @returns {boolean}\n */\nfunction isObject(obj) {\n  return obj === Object(obj);\n}\n\n/**\n * Iterates over each element of an array, calling the iterator with the\n * element and its index.\n *\n * @param {!Array} collection\n * @param {function(*=,number)} iterator\n */\nfunction each(collection, iterator) {\n  for (var i = 0; i < collection.length; i++) {\n    iterator(collection[i], i);\n  }\n}\n\n/**\n * Creates a function that will attempt to resolve the deferred with the return\n * of fn. If any error is raised, rejects instead.\n *\n * @param {!Deferred} deferred\n * @param {function(*=)} fn\n * @param {*} arg\n * @returns {function()}\n */\nfunction tryCatchDeferred(deferred, fn, arg) {\n  var promise = deferred.promise;\n  var resolve = deferred.resolve;\n  var reject = deferred.reject;\n  return function() {\n    try {\n      var result = fn(arg);\n      doResolve(promise, resolve, reject, result, result);\n    } catch (e) {\n      reject(e);\n    }\n  };\n}\n\n/**\n * Queues and executes multiple deferred functions on another run loop.\n */\nvar defer = (function() {\n  /**\n   * Defers fn to another run loop.\n   */\n  var scheduleFlush;\n  if (typeof window !== 'undefined' && window.postMessage) {\n    window.addEventListener('message', flush);\n    scheduleFlush = function() {\n      window.postMessage('macro-task', '*');\n    };\n  } else {\n    scheduleFlush = function() {\n      setTimeout(flush, 0);\n    };\n  }\n\n  var queue = new Array(16);\n  var length = 0;\n\n  function flush() {\n    for (var i = 0; i < length; i++) {\n      var fn = queue[i];\n      queue[i] = null;\n      fn();\n    }\n    length = 0;\n  }\n\n  /**\n   * @param {function()} fn\n   */\n  function defer(fn) {\n    if (length === 0) { scheduleFlush(); }\n    queue[length++] = fn;\n  }\n\n  return defer;\n})();\n\n/**\n * The Promise resolution procedure.\n * https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n *\n * @param {!Promise} promise\n * @param {function(*=)} resolve\n * @param {function(*=)} reject\n * @param {*} value\n * @param {*=} context\n */\nfunction doResolve(promise, resolve, reject, value, context) {\n  var _reject = reject;\n  var then;\n  var _resolve;\n  try {\n    if (value === promise) {\n      throw new TypeError('Cannot fulfill promise with itself');\n    }\n    var isObj = isObject(value);\n    if (isObj && value instanceof promise.constructor) {\n      adopt(promise, value._state, value._value, value);\n    } else if (isObj && (then = value.then) && isFunction(then)) {\n      _resolve = function(value) {\n        _resolve = _reject = noop;\n        doResolve(promise, resolve, reject, value, value);\n      };\n      _reject = function(reason) {\n        _resolve = _reject = noop;\n        reject(reason);\n      };\n      then.call(\n        context,\n        function(value) { _resolve(value); },\n        function(reason) { _reject(reason); }\n      );\n    } else {\n      resolve(value);\n    }\n  } catch (e) {\n    _reject(e);\n  }\n}\n\nmodule.exports = Promise;\n","/**\n * @license\n * Copyright 2017 The Web Activities Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n /** Version: 1.9 */\n'use strict';\n\n/*eslint no-unused-vars: 0*/\n\n\n/**\n * @enum {string}\n */\nconst ActivityMode = {\n  IFRAME: 'iframe',\n  POPUP: 'popup',\n  REDIRECT: 'redirect',\n};\n\n\n/**\n * The result code used for `ActivityResult`.\n * @enum {string}\n */\nconst ActivityResultCode = {\n  OK: 'ok',\n  CANCELED: 'canceled',\n  FAILED: 'failed',\n};\n\n\n/**\n * The result of an activity. The activity implementation returns this object\n * for a successful result, a cancelation or a failure.\n * @struct\n */\nclass ActivityResult {\n  /**\n   * @param {!ActivityResultCode} code\n   * @param {*} data\n   * @param {!ActivityMode} mode\n   * @param {string} origin\n   * @param {boolean} originVerified\n   * @param {boolean} secureChannel\n   */\n  constructor(code, data, mode, origin, originVerified, secureChannel) {\n    /** @const {!ActivityResultCode} */\n    this.code = code;\n    /** @const {*} */\n    this.data = code == ActivityResultCode.OK ? data : null;\n    /** @const {!ActivityMode} */\n    this.mode = mode;\n    /** @const {string} */\n    this.origin = origin;\n    /** @const {boolean} */\n    this.originVerified = originVerified;\n    /** @const {boolean} */\n    this.secureChannel = secureChannel;\n    /** @const {boolean} */\n    this.ok = code == ActivityResultCode.OK;\n    /** @const {?Error} */\n    this.error = code == ActivityResultCode.FAILED ?\n        new Error(String(data) || '') :\n        null;\n  }\n}\n\n\n/**\n * The activity request that different types of hosts can be started with.\n * @typedef {{\n *   requestId: string,\n *   returnUrl: string,\n *   args: ?Object,\n *   origin: (string|undefined),\n *   originVerified: (boolean|undefined),\n * }}\n */\n\n\n\n/**\n * The activity \"open\" options used for popups and redirects.\n *\n * - returnUrl: override the return URL. By default, the current URL will be\n *   used.\n * - skipRequestInUrl: removes the activity request from the URL, in case\n *   redirect is used. By default, the activity request is appended to the\n *   activity URL. This option can be used if the activity request is passed\n *   to the activity by some alternative means.\n *\n * @typedef {{\n *   returnUrl: (string|undefined),\n *   skipRequestInUrl: (boolean|undefined),\n *   width: (number|undefined),\n *   height: (number|undefined),\n * }}\n */\nlet ActivityOpenOptions;\n\n\n/**\n * Activity client-side binding. The port provides limited ways to communicate\n * with the activity and receive signals and results from it. Not every type\n * of activity exposes a port.\n *\n * @interface\n */\nclass ActivityPort {\n\n  /**\n   * Returns the mode of the activity: iframe, popup or redirect.\n   * @return {!ActivityMode}\n   */\n  getMode() {}\n\n  /**\n   * Accepts the result when ready. The client should verify the activity's\n   * mode, origin, verification and secure channel flags before deciding\n   * whether or not to trust the result.\n   *\n   * Returns the promise that yields when the activity has been completed and\n   * either a result, a cancelation or a failure has been returned.\n   *\n   * @return {!Promise<!ActivityResult>}\n   */\n  acceptResult() {}\n}\n\n\n/**\n * Activity implementation. The host provides interfaces, callbacks and\n * signals for the activity's implementation to communicate with the client\n * and return the results.\n *\n * @interface\n */\n\n\n\nconst SENTINEL = '__ACTIVITIES__';\n\n/**\n * The messenger helper for activity's port and host.\n */\nclass Messenger {\n\n  /**\n   * @param {!Window} win\n   * @param {!Window|function():?Window} targetOrCallback\n   * @param {?string} targetOrigin\n   */\n  constructor(win, targetOrCallback, targetOrigin) {\n    /** @private @const {!Window} */\n    this.win_ = win;\n    /** @private @const {!Window|function():?Window} */\n    this.targetOrCallback_ = targetOrCallback;\n\n    /**\n     * May start as unknown (`null`) until received in the first message.\n     * @private {?string}\n     */\n    this.targetOrigin_ = targetOrigin;\n\n    /** @private {?Window} */\n    this.target_ = null;\n\n    /** @private {boolean} */\n    this.acceptsChannel_ = false;\n\n    /** @private {?MessagePort} */\n    this.port_ = null;\n\n    /** @private {?function(string, ?Object)} */\n    this.onCommand_ = null;\n\n    /** @private {?function(!Object)} */\n    this.onCustomMessage_ = null;\n\n    /**\n     * @private {?Object<string, !ChannelHolder>}\n     */\n    this.channels_ = null;\n\n    /** @private @const */\n    this.boundHandleEvent_ = this.handleEvent_.bind(this);\n  }\n\n  /**\n   * Connect the port to the host or vice versa.\n   * @param {function(string, ?Object)} onCommand\n   */\n  connect(onCommand) {\n    if (this.onCommand_) {\n      throw new Error('already connected');\n    }\n    this.onCommand_ = onCommand;\n    this.win_.addEventListener('message', this.boundHandleEvent_);\n  }\n\n  /**\n   * Disconnect messenger.\n   */\n  disconnect() {\n    if (this.onCommand_) {\n      this.onCommand_ = null;\n      if (this.port_) {\n        closePort(this.port_);\n        this.port_ = null;\n      }\n      this.win_.removeEventListener('message', this.boundHandleEvent_);\n      if (this.channels_) {\n        for (const k in this.channels_) {\n          const channelObj = this.channels_[k];\n          if (channelObj.port1) {\n            closePort(channelObj.port1);\n          }\n          if (channelObj.port2) {\n            closePort(channelObj.port2);\n          }\n        }\n        this.channels_ = null;\n      }\n    }\n  }\n\n  /**\n   * Returns whether the messenger has been connected already.\n   * @return {boolean}\n   */\n  isConnected() {\n    return this.targetOrigin_ != null;\n  }\n\n  /**\n   * Returns the messaging target. Only available when connection has been\n   * establihsed.\n   * @return {!Window}\n   */\n  getTarget() {\n    const target = this.getOptionalTarget_();\n    if (!target) {\n      throw new Error('not connected');\n    }\n    return target;\n  }\n\n  /**\n   * @return {?Window}\n   * @private\n   */\n  getOptionalTarget_() {\n    if (this.onCommand_ && !this.target_) {\n      if (typeof this.targetOrCallback_ == 'function') {\n        this.target_ = this.targetOrCallback_();\n      } else {\n        this.target_ = /** @type {!Window} */ (this.targetOrCallback_);\n      }\n    }\n    return this.target_;\n  }\n\n  /**\n   * Returns the messaging origin. Only available when connection has been\n   * establihsed.\n   * @return {string}\n   */\n  getTargetOrigin() {\n    if (this.targetOrigin_ == null) {\n      throw new Error('not connected');\n    }\n    return this.targetOrigin_;\n  }\n\n  /**\n   * The host sends this message to the client to indicate that it's ready to\n   * start communicating. The client is expected to respond back with the\n   * \"start\" command. See `sendStartCommand` method.\n   */\n  sendConnectCommand() {\n    this.sendCommand('connect', {'acceptsChannel': true});\n  }\n\n  /**\n   * The client sends this message to the host upon receiving the \"connect\"\n   * message to start the main communication channel. As a payload, the message\n   * will contain the provided start arguments.\n   * @param {?Object} args\n   */\n  sendStartCommand(args) {\n    let channel = null;\n    if (this.acceptsChannel_ && typeof this.win_.MessageChannel == 'function') {\n      channel = new this.win_.MessageChannel();\n    }\n    if (channel) {\n      this.sendCommand('start', args, [channel.port2]);\n      // It's critical to switch to port messaging only after \"start\" has been\n      // sent. Otherwise, it won't be delivered.\n      this.switchToChannel_(channel.port1);\n    } else {\n      this.sendCommand('start', args);\n    }\n  }\n\n  /**\n   * Sends the specified command from the port to the host or vice versa.\n   * @param {string} cmd\n   * @param {?Object=} opt_payload\n   * @param {?Array=} opt_transfer\n   */\n  sendCommand(cmd, opt_payload, opt_transfer) {\n    const data = {\n      'sentinel': SENTINEL,\n      'cmd': cmd,\n      'payload': opt_payload || null,\n    };\n    if (this.port_) {\n      this.port_.postMessage(data, opt_transfer || undefined);\n    } else {\n      const target = this.getTarget();\n      // Only \"connect\" command is allowed to use `targetOrigin == '*'`\n      const targetOrigin =\n          cmd == 'connect' ?\n          (this.targetOrigin_ != null ? this.targetOrigin_ : '*') :\n          this.getTargetOrigin();\n      target.postMessage(data, targetOrigin, opt_transfer || undefined);\n    }\n  }\n\n  /**\n   * Sends a message to the client.\n   * @param {!Object} payload\n   */\n  customMessage(payload) {\n    this.sendCommand('msg', payload);\n  }\n\n  /**\n   * Registers a callback to receive messages from the client.\n   * @param {function(!Object)} callback\n   */\n  onCustomMessage(callback) {\n    this.onCustomMessage_ = callback;\n  }\n\n  /**\n   * @param {string=} opt_name\n   * @return {!Promise<!MessagePort>}\n   */\n  startChannel(opt_name) {\n    const name = opt_name || '';\n    const channelObj = this.getChannelObj_(name);\n    if (!channelObj.port1) {\n      const channel = new this.win_.MessageChannel();\n      channelObj.port1 = channel.port1;\n      channelObj.port2 = channel.port2;\n      channelObj.resolver(channelObj.port1);\n    }\n    if (channelObj.port2) {\n      // Not yet sent.\n      this.sendCommand('cnset', {'name': name}, [channelObj.port2]);\n      channelObj.port2 = null;\n    }\n    return channelObj.promise;\n  }\n\n  /**\n   * @param {string=} opt_name\n   * @return {!Promise<!MessagePort>}\n   */\n  askChannel(opt_name) {\n    const name = opt_name || '';\n    const channelObj = this.getChannelObj_(name);\n    if (!channelObj.port1) {\n      this.sendCommand('cnget', {'name': name});\n    }\n    return channelObj.promise;\n  }\n\n  /**\n   * @param {string} name\n   * @param {!MessagePort} port\n   * @private\n   */\n  receiveChannel_(name, port) {\n    const channelObj = this.getChannelObj_(name);\n    channelObj.port1 = port;\n    channelObj.resolver(port);\n  }\n\n  /**\n   * @param {string} name\n   * @return {!ChannelHolder}\n   */\n  getChannelObj_(name) {\n    if (!this.channels_) {\n      this.channels_ = {};\n    }\n    let channelObj = this.channels_[name];\n    if (!channelObj) {\n      let resolver;\n      const promise = new Promise(resolve => {\n        resolver = resolve;\n      });\n      channelObj = {\n        port1: null,\n        port2: null,\n        resolver,\n        promise,\n      };\n      this.channels_[name] = channelObj;\n    }\n    return channelObj;\n  }\n\n  /**\n   * @param {!MessagePort} port\n   * @private\n   */\n  switchToChannel_(port) {\n    if (this.port_) {\n      closePort(this.port_);\n    }\n    this.port_ = port;\n    this.port_.onmessage = event => {\n      const data = event.data;\n      const cmd = data && data['cmd'];\n      const payload = data && data['payload'] || null;\n      if (cmd) {\n        this.handleCommand_(cmd, payload, event);\n      }\n    };\n    // Even though all messaging will switch to ports, the window-based message\n    // listener will be preserved just in case the host is refreshed and needs\n    // another connection.\n  }\n\n  /**\n   * @param {!MessageEvent} event\n   * @private\n   */\n  handleEvent_(event) {\n    const data = event.data;\n    if (!data || data['sentinel'] != SENTINEL) {\n      return;\n    }\n    const cmd = data['cmd'];\n    if (this.port_ && cmd != 'connect' && cmd != 'start') {\n      // Messaging channel has already taken over. However, the \"connect\" and\n      // \"start\" commands are allowed to proceed in case re-connection is\n      // requested.\n      return;\n    }\n    const origin = /** @type {string} */ (event.origin);\n    const payload = data['payload'] || null;\n    if (this.targetOrigin_ == null && cmd == 'start') {\n      this.targetOrigin_ = origin;\n    }\n    if (this.targetOrigin_ == null && event.source) {\n      if (this.getOptionalTarget_() == event.source) {\n        this.targetOrigin_ = origin;\n      }\n    }\n    // Notice that event.source may differ from the target because of\n    // friendly-iframe intermediaries.\n    if (origin != this.targetOrigin_) {\n      return;\n    }\n    this.handleCommand_(cmd, payload, event);\n  }\n\n  /**\n   * @param {string} cmd\n   * @param {?Object} payload\n   * @param {!MessageEvent} event\n   * @private\n   */\n  handleCommand_(cmd, payload, event) {\n    if (cmd == 'connect') {\n      if (this.port_) {\n        // In case the port has already been open - close it to reopen it\n        // again later.\n        closePort(this.port_);\n        this.port_ = null;\n      }\n      this.acceptsChannel_ = payload && payload['acceptsChannel'] || false;\n      this.onCommand_(cmd, payload);\n    } else if (cmd == 'start') {\n      const port = event.ports && event.ports[0];\n      if (port) {\n        this.switchToChannel_(port);\n      }\n      this.onCommand_(cmd, payload);\n    } else if (cmd == 'msg') {\n      if (this.onCustomMessage_ != null && payload != null) {\n        this.onCustomMessage_(payload);\n      }\n    } else if (cmd == 'cnget') {\n      const name = payload['name'];\n      this.startChannel(name);\n    } else if (cmd == 'cnset') {\n      const name = payload['name'];\n      const port = event.ports[0];\n      this.receiveChannel_(name, /** @type {!MessagePort} */ (port));\n    } else {\n      this.onCommand_(cmd, payload);\n    }\n  }\n}\n\n\n/**\n * @param {!MessagePort} port\n */\nfunction closePort(port) {\n  try {\n    port.close();\n  } catch (e) {\n    // Ignore.\n  }\n}\n\n\n\n/** DOMException.ABORT_ERR name */\nconst ABORT_ERR_NAME = 'AbortError';\n\n/** DOMException.ABORT_ERR = 20 */\nconst ABORT_ERR_CODE = 20;\n\n/** @type {?HTMLAnchorElement} */\nlet aResolver;\n\n\n/**\n * @param {string} urlString\n * @return {!HTMLAnchorElement}\n */\nfunction parseUrl(urlString) {\n  if (!aResolver) {\n    aResolver = /** @type {!HTMLAnchorElement} */ (document.createElement('a'));\n  }\n  aResolver.href = urlString;\n  return /** @type {!HTMLAnchorElement} */ (aResolver);\n}\n\n\n/**\n * @param {!Location|!URL|!HTMLAnchorElement} loc\n * @return {string}\n */\nfunction getOrigin(loc) {\n  return loc.origin || loc.protocol + '//' + loc.host;\n}\n\n\n/**\n * @param {string} urlString\n * @return {string}\n */\nfunction getOriginFromUrl(urlString) {\n  return getOrigin(parseUrl(urlString));\n}\n\n\n/**\n * @param {!Window} win\n * @return {string}\n */\n\n\n\n/**\n * @param {string} urlString\n * @return {string}\n */\nfunction removeFragment(urlString) {\n  const index = urlString.indexOf('#');\n  if (index == -1) {\n    return urlString;\n  }\n  return urlString.substring(0, index);\n}\n\n\n/**\n * Parses and builds Object of URL query string.\n * @param {string} query The URL query string.\n * @return {!Object<string, string>}\n */\nfunction parseQueryString(query) {\n  if (!query) {\n    return {};\n  }\n  return (/^[?#]/.test(query) ? query.slice(1) : query)\n      .split('&')\n      .reduce((params, param) => {\n        const item = param.split('=');\n        const key = decodeURIComponent(item[0] || '');\n        const value = decodeURIComponent(item[1] || '');\n        if (key) {\n          params[key] = value;\n        }\n        return params;\n      }, {});\n}\n\n\n/**\n * @param {string} queryString  A query string in the form of \"a=b&c=d\". Could\n *   be optionally prefixed with \"?\" or \"#\".\n * @param {string} param The param to get from the query string.\n * @return {?string}\n */\nfunction getQueryParam(queryString, param) {\n  return parseQueryString(queryString)[param];\n}\n\n\n/**\n * Add a query-like parameter to the fragment string.\n * @param {string} url\n * @param {string} param\n * @param {string} value\n * @return {string}\n */\nfunction addFragmentParam(url, param, value) {\n  return url +\n      (url.indexOf('#') == -1 ? '#' : '&') +\n      encodeURIComponent(param) + '=' + encodeURIComponent(value);\n}\n\n\n/**\n * @param {string} queryString  A query string in the form of \"a=b&c=d\". Could\n *   be optionally prefixed with \"?\" or \"#\".\n * @param {string} param The param to remove from the query string.\n * @return {?string}\n */\nfunction removeQueryParam(queryString, param) {\n  if (!queryString) {\n    return queryString;\n  }\n  const search = encodeURIComponent(param) + '=';\n  let index = -1;\n  do {\n    index = queryString.indexOf(search, index);\n    if (index != -1) {\n      const prev = index > 0 ? queryString.substring(index - 1, index) : '';\n      if (prev == '' || prev == '?' || prev == '#' || prev == '&') {\n        let end = queryString.indexOf('&', index + 1);\n        if (end == -1) {\n          end = queryString.length;\n        }\n        queryString =\n            queryString.substring(0, index) +\n            queryString.substring(end + 1);\n      } else {\n        index++;\n      }\n    }\n  } while (index != -1 && index < queryString.length);\n  return queryString;\n}\n\n\n/**\n * @param {?string} requestString\n * @param {boolean=} trusted\n * @return {?ActivityRequest}\n */\n\n\n\n/**\n * @param {!ActivityRequest} request\n * @return {string}\n */\nfunction serializeRequest(request) {\n  const map = {\n    'requestId': request.requestId,\n    'returnUrl': request.returnUrl,\n    'args': request.args,\n  };\n  if (request.origin !== undefined) {\n    map['origin'] = request.origin;\n  }\n  if (request.originVerified !== undefined) {\n    map['originVerified'] = request.originVerified;\n  }\n  return JSON.stringify(map);\n}\n\n\n/**\n * Creates or emulates a DOMException of AbortError type.\n * See https://heycam.github.io/webidl/#aborterror.\n * @param {!Window} win\n * @param {string=} opt_message\n * @return {!DOMException}\n */\nfunction createAbortError(win, opt_message) {\n  const message = 'AbortError' + (opt_message ? ': ' + opt_message : '');\n  let error = null;\n  if (typeof win['DOMException'] == 'function') {\n    // TODO(dvoytenko): remove typecast once externs are fixed.\n    const constr = /** @type {function(new:DOMException, string, string)} */ (\n        win['DOMException']);\n    try {\n      error = new constr(message, ABORT_ERR_NAME);\n    } catch (e) {\n      // Ignore. In particular, `new DOMException()` fails in Edge.\n    }\n  }\n  if (!error) {\n    // TODO(dvoytenko): remove typecast once externs are fixed.\n    const constr = /** @type {function(new:DOMException, string)} */ (\n        Error);\n    error = new constr(message);\n    error.name = ABORT_ERR_NAME;\n    error.code = ABORT_ERR_CODE;\n  }\n  return error;\n}\n\n\n/**\n * Resolves the activity result as a promise:\n *  - `OK` result is yielded as the promise's payload;\n *  - `CANCEL` result is rejected with the `AbortError`;\n *  - `FAILED` result is rejected with the embedded error.\n *\n * @param {!Window} win\n * @param {!ActivityResult} result\n * @param {function((!ActivityResult|!Promise))} resolver\n */\nfunction resolveResult(win, result, resolver) {\n  if (result.ok) {\n    resolver(result);\n  } else {\n    const error = result.error || createAbortError(win);\n    error.activityResult = result;\n    resolver(Promise.reject(error));\n  }\n}\n\n\n\n/**\n * The `ActivityPort` implementation for the iframe case. Unlike other types\n * of activities, iframe-based activities are always connected and can react\n * to size requests.\n *\n * @implements {ActivityPort}\n */\nclass ActivityIframePort {\n\n  /**\n   * @param {!HTMLIFrameElement} iframe\n   * @param {string} url\n   * @param {?Object=} opt_args\n   */\n  constructor(iframe, url, opt_args) {\n    /** @private @const {!HTMLIFrameElement} */\n    this.iframe_ = iframe;\n    /** @private @const {string} */\n    this.url_ = url;\n    /** @private @const {?Object} */\n    this.args_ = opt_args || null;\n\n    /** @private @const {!Window} */\n    this.win_ = /** @type {!Window} */ (this.iframe_.ownerDocument.defaultView);\n\n    /** @private @const {string} */\n    this.targetOrigin_ = getOriginFromUrl(url);\n\n    /** @private {boolean} */\n    this.connected_ = false;\n\n    /** @private {?function()} */\n    this.connectedResolver_ = null;\n\n    /** @private @const {!Promise} */\n    this.connectedPromise_ = new Promise(resolve => {\n      this.connectedResolver_ = resolve;\n    });\n\n    /** @private {?function()} */\n    this.readyResolver_ = null;\n\n    /** @private @const {!Promise} */\n    this.readyPromise_ = new Promise(resolve => {\n      this.readyResolver_ = resolve;\n    });\n\n    /** @private {?function((!ActivityResult|!Promise))} */\n    this.resultResolver_ = null;\n\n    /** @private @const {!Promise<!ActivityResult>} */\n    this.resultPromise_ = new Promise(resolve => {\n      this.resultResolver_ = resolve;\n    });\n\n    /** @private {?function(number)} */\n    this.onResizeRequest_ = null;\n\n    /** @private {?number} */\n    this.requestedHeight_ = null;\n\n    /** @private @const {!Messenger} */\n    this.messenger_ = new Messenger(\n        this.win_,\n        () => this.iframe_.contentWindow,\n        this.targetOrigin_);\n  }\n\n  /** @override */\n  getMode() {\n    return ActivityMode.IFRAME;\n  }\n\n  /**\n   * Waits until the activity port is connected to the host.\n   * @return {!Promise}\n   */\n  connect() {\n    if (!this.win_.document.documentElement.contains(this.iframe_)) {\n      throw new Error('iframe must be in DOM');\n    }\n    this.messenger_.connect(this.handleCommand_.bind(this));\n    this.iframe_.src = this.url_;\n    return this.connectedPromise_;\n  }\n\n  /**\n   * Disconnect the activity binding and cleanup listeners.\n   */\n  disconnect() {\n    this.connected_ = false;\n    this.messenger_.disconnect();\n  }\n\n  /** @override */\n  acceptResult() {\n    return this.resultPromise_;\n  }\n\n  /**\n   * Sends a message to the host.\n   * @param {!Object} payload\n   */\n  message(payload) {\n    this.messenger_.customMessage(payload);\n  }\n\n  /**\n   * Registers a callback to receive messages from the host.\n   * @param {function(!Object)} callback\n   */\n  onMessage(callback) {\n    this.messenger_.onCustomMessage(callback);\n  }\n\n  /**\n   * Creates a new communication channel or returns an existing one.\n   * @param {string=} opt_name\n   * @return {!Promise<!MessagePort>}\n   */\n  messageChannel(opt_name) {\n    return this.messenger_.askChannel(opt_name);\n  }\n\n  /**\n   * Returns a promise that yields when the iframe is ready to be interacted\n   * with.\n   * @return {!Promise}\n   */\n  whenReady() {\n    return this.readyPromise_;\n  }\n\n  /**\n   * Register a callback to handle resize requests. Once successfully resized,\n   * ensure to call `resized()` method.\n   * @param {function(number)} callback\n   */\n  onResizeRequest(callback) {\n    this.onResizeRequest_ = callback;\n    Promise.resolve().then(() => {\n      if (this.requestedHeight_ != null) {\n        callback(this.requestedHeight_);\n      }\n    });\n  }\n\n  /**\n   * Signals back to the activity implementation that the client has updated\n   * the activity's size.\n   */\n  resized() {\n    if (!this.connected_) {\n      return;\n    }\n    const height = this.iframe_.offsetHeight;\n    this.messenger_.sendCommand('resized', {'height': height});\n  }\n\n  /**\n   * @param {string} cmd\n   * @param {?Object} payload\n   * @private\n   */\n  handleCommand_(cmd, payload) {\n    if (cmd == 'connect') {\n      // First ever message. Indicates that the receiver is listening.\n      this.connected_ = true;\n      this.messenger_.sendStartCommand(this.args_);\n      this.connectedResolver_();\n    } else if (cmd == 'result') {\n      // The last message. Indicates that the result has been received.\n      if (this.resultResolver_) {\n        const code = /** @type {!ActivityResultCode} */ (payload['code']);\n        const data =\n            code == ActivityResultCode.FAILED ?\n            new Error(payload['data'] || '') :\n            payload['data'];\n        const result = new ActivityResult(\n            code,\n            data,\n            ActivityMode.IFRAME,\n            this.messenger_.getTargetOrigin(),\n            /* originVerified */ true,\n            /* secureChannel */ true);\n        resolveResult(this.win_, result, this.resultResolver_);\n        this.resultResolver_ = null;\n        this.messenger_.sendCommand('close');\n        this.disconnect();\n      }\n    } else if (cmd == 'ready') {\n      if (this.readyResolver_) {\n        this.readyResolver_();\n        this.readyResolver_ = null;\n      }\n    } else if (cmd == 'resize') {\n      this.requestedHeight_ = /** @type {number} */ (payload['height']);\n      if (this.onResizeRequest_) {\n        this.onResizeRequest_(this.requestedHeight_);\n      }\n    }\n  }\n}\n\n\n\n/**\n * The `ActivityPort` implementation for the standalone window activity\n * client executed as a popup.\n *\n * @implements {ActivityPort}\n */\nclass ActivityWindowPort {\n\n  /**\n   * @param {!Window} win\n   * @param {string} requestId\n   * @param {string} url\n   * @param {string} target\n   * @param {?Object=} opt_args\n   * @param {?ActivityOpenOptions=} opt_options\n   */\n  constructor(win, requestId, url, target, opt_args, opt_options) {\n    const isValidTarget =\n        target &&\n        (target == '_blank' || target == '_top' || target[0] != '_');\n    if (!isValidTarget) {\n      throw new Error('The only allowed targets are \"_blank\", \"_top\"' +\n          ' and name targets');\n    }\n\n    /** @private @const {!Window} */\n    this.win_ = win;\n    /** @private @const {string} */\n    this.requestId_ = requestId;\n    /** @private @const {string} */\n    this.url_ = url;\n    /** @private @const {string} */\n    this.openTarget_ = target;\n    /** @private @const {?Object} */\n    this.args_ = opt_args || null;\n    /** @private @const {?ActivityOpenOptions} */\n    this.options_ = opt_options || null;\n\n    /** @private {?function((!ActivityResult|!Promise))} */\n    this.resultResolver_ = null;\n\n    /** @private @const {!Promise<!ActivityResult>} */\n    this.resultPromise_ = new Promise(resolve => {\n      this.resultResolver_ = resolve;\n    });\n\n    /** @private {?Window} */\n    this.targetWin_ = null;\n\n    /** @private {?number} */\n    this.heartbeatInterval_ = null;\n\n    /** @private {?Messenger} */\n    this.messenger_ = null;\n  }\n\n  /** @override */\n  getMode() {\n    return this.openTarget_ == '_top' ?\n        ActivityMode.REDIRECT :\n        ActivityMode.POPUP;\n  }\n\n  /**\n   * Opens the activity in a window, either as a popup or via redirect.\n   *\n   * Returns the promise that will yield when the window returns or closed.\n   * Notice, that this promise may never complete if \"redirect\" mode was used.\n   *\n   * @return {!Promise}\n   */\n  open() {\n    return this.openInternal_();\n  }\n\n  /**\n   * @return {?Window}\n   */\n  getTargetWin() {\n    return this.targetWin_;\n  }\n\n  /**\n   * Disconnect the activity binding and cleanup listeners.\n   */\n  disconnect() {\n    if (this.heartbeatInterval_) {\n      this.win_.clearInterval(this.heartbeatInterval_);\n      this.heartbeatInterval_ = null;\n    }\n    if (this.messenger_) {\n      this.messenger_.disconnect();\n      this.messenger_ = null;\n    }\n    if (this.targetWin_) {\n      // Try to close the popup window. The host will also try to do the same.\n      try {\n        this.targetWin_.close();\n      } catch (e) {\n        // Ignore.\n      }\n      this.targetWin_ = null;\n    }\n    this.resultResolver_ = null;\n  }\n\n  /** @override */\n  acceptResult() {\n    return this.resultPromise_;\n  }\n\n  /**\n   * This method wraps around window's open method. It first tries to execute\n   * `open` call with the provided target and if it fails, it retries the call\n   * with the `_top` target. This is necessary given that in some embedding\n   * scenarios, such as iOS' WKWebView, navigation to `_blank` and other targets\n   * is blocked by default.\n   * @return {!Promise}\n   * @private\n   */\n  openInternal_() {\n    const featuresStr = this.buildFeatures_();\n\n    // Protectively, the URL will contain the request payload, unless explicitly\n    // directed not to via `skipRequestInUrl` option.\n    let url = this.url_;\n    if (!(this.options_ && this.options_.skipRequestInUrl)) {\n      const returnUrl =\n          this.options_ && this.options_.returnUrl ||\n          removeFragment(this.win_.location.href);\n      const requestString = serializeRequest({\n        requestId: this.requestId_,\n        returnUrl,\n        args: this.args_,\n      });\n      url = addFragmentParam(url, '__WA__', requestString);\n    }\n\n    // Open the window.\n    // Try first with the specified target. If we're inside the WKWebView or\n    // a similar environments, this method is expected to fail by default for\n    // all targets except `_top`.\n    let targetWin;\n    let openTarget = this.openTarget_;\n    try {\n      targetWin = this.win_.open(url, openTarget, featuresStr);\n    } catch (e) {\n      // Ignore.\n    }\n    // Then try with `_top` target.\n    if (!targetWin && openTarget != '_top') {\n      openTarget = '_top';\n      try {\n        targetWin = this.win_.open(url, openTarget);\n      } catch (e) {\n        // Ignore.\n      }\n    }\n\n    // Setup the target window.\n    if (targetWin) {\n      this.targetWin_ = targetWin;\n      if (openTarget != '_top') {\n        this.setupPopup_();\n      }\n    } else {\n      this.disconnectWithError_(new Error('failed to open window'));\n    }\n\n    // Return result promise, even though it may never complete.\n    return this.resultPromise_.catch(() => {\n      // Ignore. Call to the `acceptResult()` should fail if needed.\n    });\n  }\n\n  /**\n   * @return {string}\n   * @private\n   */\n  buildFeatures_() {\n    const screen = this.win_.screen;\n    let w = Math.floor(Math.min(600, screen.width * 0.9));\n    let h = Math.floor(Math.min(600, screen.height * 0.9));\n    if (this.options_) {\n      if (this.options_.width) {\n        w = Math.min(this.options_.width, screen.width);\n      }\n      if (this.options_.height) {\n        h = Math.min(this.options_.height, screen.height);\n      }\n    }\n    const x = Math.floor((screen.width - w) / 2);\n    const y = Math.floor((screen.height - h) / 2);\n    const features = {\n      'height': h,\n      'width': w,\n      'resizable': 'yes',\n      'scrollbars': 'yes',\n    };\n    // Do not set left/top in Edge: it fails.\n    const nav = this.win_.navigator;\n    if (!/Edge/i.test(nav && nav.userAgent)) {\n      features['left'] = x;\n      features['top'] = y;\n    }\n    let featuresStr = '';\n    for (const f in features) {\n      if (featuresStr) {\n        featuresStr += ',';\n      }\n      featuresStr += `${f}=${features[f]}`;\n    }\n    return featuresStr;\n  }\n\n  /** @private */\n  setupPopup_() {\n    // Keep alive to catch the window closing, which would indicate\n    // \"cancel\" signal.\n    this.heartbeatInterval_ = this.win_.setInterval(() => {\n      this.check_(/* delayCancel */ true);\n    }, 500);\n\n    // Start up messaging. The messaging is explicitly allowed to proceed\n    // without origin check b/c all arguments have already been passed in\n    // the URL and special handling is enforced when result is delivered.\n    this.messenger_ = new Messenger(\n        this.win_,\n        /** @type {!Window} */ (this.targetWin_),\n        /* targetOrigin */ null);\n    this.messenger_.connect(this.handleCommand_.bind(this));\n  }\n\n  /**\n   * @param {boolean=} opt_delayCancel\n   * @private\n   */\n  check_(opt_delayCancel) {\n    if (!this.targetWin_ || this.targetWin_.closed) {\n      this.win_.clearInterval(this.heartbeatInterval_);\n      this.heartbeatInterval_ = null;\n      // Give a chance for the result to arrive, but otherwise consider the\n      // responce to be empty.\n      this.win_.setTimeout(() => {\n        try {\n          this.result_(ActivityResultCode.CANCELED, /* data */ null);\n        } catch (e) {\n          this.disconnectWithError_(e);\n        }\n      }, opt_delayCancel ? 3000 : 0);\n    }\n  }\n\n  /**\n   * @param {!Error} reason\n   * @private\n   */\n  disconnectWithError_(reason) {\n    if (this.resultResolver_) {\n      this.resultResolver_(Promise.reject(reason));\n    }\n    this.disconnect();\n  }\n\n  /**\n   * @param {!ActivityResultCode} code\n   * @param {*} data\n   * @private\n   */\n  result_(code, data) {\n    if (this.resultResolver_) {\n      const isConnected = this.messenger_.isConnected();\n      const result = new ActivityResult(\n          code,\n          data,\n          ActivityMode.POPUP,\n          isConnected ?\n              this.messenger_.getTargetOrigin() :\n              getOriginFromUrl(this.url_),\n          /* originVerified */ isConnected,\n          /* secureChannel */ isConnected);\n      resolveResult(this.win_, result, this.resultResolver_);\n      this.resultResolver_ = null;\n    }\n    if (this.messenger_) {\n      this.messenger_.sendCommand('close');\n    }\n    this.disconnect();\n  }\n\n  /**\n   * @param {string} cmd\n   * @param {?Object} payload\n   * @private\n   */\n  handleCommand_(cmd, payload) {\n    if (cmd == 'connect') {\n      // First ever message. Indicates that the receiver is listening.\n      this.messenger_.sendStartCommand(this.args_);\n    } else if (cmd == 'result') {\n      // The last message. Indicates that the result has been received.\n      const code = /** @type {!ActivityResultCode} */ (payload['code']);\n      const data =\n          code == ActivityResultCode.FAILED ?\n          new Error(payload['data'] || '') :\n          payload['data'];\n      this.result_(code, data);\n    } else if (cmd == 'check') {\n      this.win_.setTimeout(() => this.check_(), 200);\n    }\n  }\n}\n\n\n/**\n * @param {!Window} win\n * @param {string} fragment\n * @param {string} requestId\n * @return {?ActivityPort}\n */\nfunction discoverRedirectPort(win, fragment, requestId) {\n  // Try to find the result in the fragment.\n  const paramName = '__WA_RES__';\n  const fragmentParam = getQueryParam(fragment, paramName);\n  if (!fragmentParam) {\n    return null;\n  }\n  const response = /** @type {?Object} */ (JSON.parse(\n      decodeURIComponent(fragmentParam)));\n  if (!response || response['requestId'] != requestId) {\n    return null;\n  }\n\n  // Remove the found param from the fragment.\n  const cleanFragment = removeQueryParam(win.location.hash, paramName) || '';\n  if (cleanFragment != win.location.hash) {\n    if (win.history && win.history.replaceState) {\n      try {\n        win.history.replaceState(win.history.state, '', cleanFragment);\n      } catch (e) {\n        // Ignore.\n      }\n    }\n  }\n\n  const code = response['code'];\n  const data = response['data'];\n  const origin = response['origin'];\n  const referrerOrigin = win.document.referrer &&\n      getOriginFromUrl(win.document.referrer);\n  const originVerified = origin == referrerOrigin;\n  return new ActivityWindowRedirectPort(\n      win,\n      code,\n      data,\n      origin,\n      originVerified);\n}\n\n\n/**\n * The `ActivityPort` implementation for the standalone window activity\n * client executed as a popup.\n *\n * @implements {ActivityPort}\n */\nclass ActivityWindowRedirectPort {\n\n  /**\n   * @param {!Window} win\n   * @param {!ActivityResultCode} code\n   * @param {*} data\n   * @param {string} targetOrigin\n   * @param {boolean} targetOriginVerified\n   */\n  constructor(win, code, data, targetOrigin, targetOriginVerified) {\n    /** @private @const {!Window} */\n    this.win_ = win;\n    /** @private @const {!ActivityResultCode} */\n    this.code_ = code;\n    /** @private @const {*} */\n    this.data_ = data;\n    /** @private {string} */\n    this.targetOrigin_ = targetOrigin;\n    /** @private {boolean} */\n    this.targetOriginVerified_ = targetOriginVerified;\n  }\n\n  /** @override */\n  getMode() {\n    return ActivityMode.REDIRECT;\n  }\n\n  /** @override */\n  acceptResult() {\n    const result = new ActivityResult(\n        this.code_,\n        this.data_,\n        ActivityMode.REDIRECT,\n        this.targetOrigin_,\n        this.targetOriginVerified_,\n        /* secureChannel */ false);\n    return new Promise(resolve => {\n      resolveResult(this.win_, result, resolve);\n    });\n  }\n}\n\n\n\n/**\n * The page-level activities manager ports. This class is intended to be used\n * as a singleton. It can start activities of all modes: iframe, popup, and\n * redirect.\n */\nclass ActivityPorts {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @const {string} */\n    this.version = '1.9';\n\n    /** @private @const {!Window} */\n    this.win_ = win;\n\n    /** @private @const {string} */\n    this.fragment_ = win.location.hash;\n\n    /**\n     * @private @const {!Object<string, !Array<function(!ActivityPort)>>}\n     */\n    this.requestHandlers_ = {};\n\n    /**\n     * The result buffer is indexed by `requestId`.\n     * @private @const {!Object<string, !ActivityPort>}\n     */\n    this.resultBuffer_ = {};\n  }\n\n  /**\n   * Start an activity within the specified iframe.\n   * @param {!HTMLIFrameElement} iframe\n   * @param {string} url\n   * @param {?Object=} opt_args\n   * @return {!Promise<!ActivityIframePort>}\n   */\n  openIframe(iframe, url, opt_args) {\n    const port = new ActivityIframePort(iframe, url, opt_args);\n    return port.connect().then(() => port);\n  }\n\n  /**\n   * Start an activity in a separate window. The result will be delivered\n   * to the `onResult` callback.\n   *\n   * The activity can be opened in two modes: \"popup\" and \"redirect\". This\n   * depends on the `target` value, but also on the browser/environment.\n   *\n   * The allowed `target` values are `_blank`, `_top` and name targets. The\n   * `_self`, `_parent` and similar targets are not allowed.\n   *\n   * The `_top` target indicates that the activity should be opened as a\n   * \"redirect\", while other targets indicate that the activity should be\n   * opened as a popup. The activity client will try to honor the requested\n   * target. However, it's not always possible. Some environments do not\n   * allow popups and they either force redirect or fail the window open\n   * request. In this case, the activity will try to fallback to the \"redirect\"\n   * mode.\n   *\n   * @param {string} requestId\n   * @param {string} url\n   * @param {string} target\n   * @param {?Object=} opt_args\n   * @param {?ActivityOpenOptions=} opt_options\n   * @return {{targetWin: ?Window}}\n   */\n  open(requestId, url, target, opt_args, opt_options) {\n    const port = new ActivityWindowPort(\n        this.win_, requestId, url, target, opt_args, opt_options);\n    port.open().then(() => {\n      // Await result if possible. Notice that when falling back to \"redirect\",\n      // the result will never arrive through this port.\n      this.consumeResultAll_(requestId, port);\n    });\n    return {targetWin: port.getTargetWin()};\n  }\n\n  /**\n   * Registers the callback for the result of the activity opened with the\n   * specified `requestId` (see the `open()` method). The callback is a\n   * function that takes a single `ActivityPort` argument. The client\n   * can use this object to verify the port using it's origin, verified and\n   * secure channel flags. Then the client can call\n   * `ActivityPort.acceptResult()` method to accept the result.\n   *\n   * The activity result is handled via a separate callback because of a\n   * possible redirect. So use of direct callbacks and/or promises is not\n   * possible in that case.\n   *\n   * A typical implementation would look like:\n   * ```\n   * ports.onResult('request1', function(port) {\n   *   port.acceptResult().then(function(result) {\n   *     // Only verified origins are allowed.\n   *     if (result.origin == expectedOrigin &&\n   *         result.originVerified &&\n   *         result.secureChannel) {\n   *       handleResultForRequest1(result);\n   *     }\n   *   });\n   * })\n   *\n   * ports.open('request1', request1Url, '_blank');\n   * ```\n   *\n   * @param {string} requestId\n   * @param {function(!ActivityPort)} callback\n   */\n  onResult(requestId, callback) {\n    let handlers = this.requestHandlers_[requestId];\n    if (!handlers) {\n      handlers = [];\n      this.requestHandlers_[requestId] = handlers;\n    }\n    handlers.push(callback);\n\n    // Consume available result.\n    const availableResult = this.discoverResult_(requestId);\n    if (availableResult) {\n      this.consumeResult_(availableResult, callback);\n    }\n  }\n\n  /**\n   * @param {string} requestId\n   * @return {?ActivityPort}\n   * @private\n   */\n  discoverResult_(requestId) {\n    let port = this.resultBuffer_[requestId];\n    if (!port && this.fragment_) {\n      port = discoverRedirectPort(\n          this.win_, this.fragment_, requestId);\n      if (port) {\n        this.resultBuffer_[requestId] = port;\n      }\n    }\n    return port;\n  }\n\n  /**\n   * @param {!ActivityPort} port\n   * @param {function(!ActivityPort)} callback\n   * @private\n   */\n  consumeResult_(port, callback) {\n    Promise.resolve().then(() => {\n      callback(port);\n    });\n  }\n\n  /**\n   * @param {string} requestId\n   * @param {!ActivityPort} port\n   * @private\n   */\n  consumeResultAll_(requestId, port) {\n    // Find and execute handlers.\n    const handlers = this.requestHandlers_[requestId];\n    if (handlers) {\n      handlers.forEach(handler => {\n        this.consumeResult_(port, handler);\n      });\n    }\n    // Buffer the result for callbacks that may arrive in the future.\n    this.resultBuffer_[requestId] = port;\n  }\n}\n\n\n\nmodule.exports = {\n  ActivityPorts,\n  ActivityIframePort,\n  ActivityMode,\n  ActivityOpenOptions,\n  ActivityPort,\n  ActivityResult,\n  ActivityResultCode,\n  ActivityWindowPort,\n};\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Entitlements} from './entitlements';\nimport {PurchaseData} from './subscribe-response';\nimport {UserData} from './user-data';\n\n\n/**\n * Properties:\n * - entitlements - the current entitlements.\n * - consent - whether to ask the user for account creation consent.\n *   Default is `true`.\n *\n * @typedef {{\n *   entitlements: (?Entitlements|undefined),\n *   consent: (boolean|undefined),\n * }}\n */\nexport let DeferredAccountCreationRequest;\n\n\n/**\n */\nexport class DeferredAccountCreationResponse {\n\n  /**\n   * @param {!Entitlements} entitlements\n   * @param {!UserData} userData\n   * @param {!PurchaseData} purchaseData\n   * @param {function():!Promise} completeHandler\n   */\n  constructor(entitlements, userData, purchaseData, completeHandler) {\n    /** @const {!Entitlements} */\n    this.entitlements = entitlements;\n    /** @const {!UserData} */\n    this.userData = userData;\n    /** @const {!PurchaseData} */\n    this.purchaseData = purchaseData;\n    /** @private @const {function():!Promise} */\n    this.completeHandler_ = completeHandler;\n  }\n\n  /**\n   * @return {!DeferredAccountCreationResponse}\n   */\n  clone() {\n    return new DeferredAccountCreationResponse(\n        this.entitlements,\n        this.userData,\n        this.purchaseData,\n        this.completeHandler_);\n  }\n\n  /**\n   * @return {!Object}\n   */\n  json() {\n    return {\n      'entitlements': this.entitlements.json(),\n      'userData': this.userData.json(),\n      'purchaseData': this.purchaseData.json(),\n    };\n  }\n\n  /**\n   * Allows the receiving site to complete/acknowledge that it registered\n   * the subscription info. The typical action would be to create an\n   * account (or match an existing one) and associated the subscription with\n   * that account.\n   *\n   * SwG will display progress indicator until this method is called and\n   * upon receiving this call will show the confirmation to the user.\n   * The promise returned by this method will yield once the user closes\n   * the confirmation.\n   *\n   * @return {!Promise}\n   */\n  complete() {\n    return this.completeHandler_();\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * The holder of the entitlements for a service.\n */\nexport class Entitlements {\n\n  /**\n   * @param {string} service\n   * @param {string} raw\n   * @param {!Array<!Entitlement>} entitlements\n   * @param {?string} currentProduct\n   * @param {function(!Entitlements)} ackHandler\n   */\n  constructor(service, raw, entitlements, currentProduct, ackHandler) {\n    /** @const {string} */\n    this.service = service;\n    /** @const {string} */\n    this.raw = raw;\n    /** @const {!Array<!Entitlement>} */\n    this.entitlements = entitlements;\n\n    /** @private @const {?string} */\n    this.product_ = currentProduct;\n    /** @private @const {function(!Entitlements)} */\n    this.ackHandler_ = ackHandler;\n  }\n\n  /**\n   * @return {!Entitlements}\n   */\n  clone() {\n    return new Entitlements(\n        this.service,\n        this.raw,\n        this.entitlements.map(ent => ent.clone()),\n        this.product_,\n        this.ackHandler_);\n  }\n\n  /**\n   * @return {!Object}\n   */\n  json() {\n    return {\n      'service': this.service,\n      'entitlements': this.entitlements.map(item => item.json()),\n    };\n  }\n\n  /**\n   * @param {string=} opt_source\n   * @return {boolean}\n   */\n  enablesThis(opt_source) {\n    return this.enables(this.product_, opt_source);\n  }\n\n  /**\n   * @param {string=} opt_source\n   * @return {boolean}\n   */\n  enablesAny(opt_source) {\n    for (let i = 0; i < this.entitlements.length; i++) {\n      if (this.entitlements[i].products.length > 0 &&\n          (!opt_source || opt_source == this.entitlements[i].source)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Whether these entitlements enable the specified product, optionally also\n   * restricting the source.\n   * @param {?string} product\n   * @param {string=} opt_source\n   * @return {boolean}\n   */\n  enables(product, opt_source) {\n    if (!product) {\n      return false;\n    }\n    return !!this.getEntitlementFor(product, opt_source);\n  }\n\n  /**\n   * Returns the first matching entitlement for the current product,\n   * optionally also matching the specified source.\n   * @param {string=} opt_source\n   * @return {?Entitlement}\n   */\n  getEntitlementForThis(opt_source) {\n    return this.getEntitlementFor(this.product_, opt_source);\n  }\n\n  /**\n   * Returns the first matching entitlement for the specified product,\n   * optionally also matching the specified source.\n   * @param {?string} product\n   * @param {string=} opt_source\n   * @return {?Entitlement}\n   */\n  getEntitlementFor(product, opt_source) {\n    if (product && this.entitlements.length > 0) {\n      for (let i = 0; i < this.entitlements.length; i++) {\n        if (this.entitlements[i].enables(product) &&\n            (!opt_source || opt_source == this.entitlements[i].source)) {\n          return this.entitlements[i];\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Returns the first matching entitlement for the specified source w/o\n   * matching any specific products.\n   * @param {string} source\n   * @return {?Entitlement}\n   */\n  getEntitlementForSource(source) {\n    if (this.entitlements.length > 0) {\n      for (let i = 0; i < this.entitlements.length; i++) {\n        if (this.entitlements[i].subscriptionToken &&\n            (source == this.entitlements[i].source)) {\n          return this.entitlements[i];\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * A 3p site should call this method to acknowledge that it \"saw\" and\n   * \"understood\" entitlements.\n   */\n  ack() {\n    this.ackHandler_(this);\n  }\n}\n\n\n/**\n * The single entitlement object.\n */\nexport class Entitlement {\n\n  /**\n   * @param {string} source\n   * @param {!Array<string>} products\n   * @param {string} subscriptionToken\n   */\n  constructor(source, products, subscriptionToken) {\n    /** @const {string} */\n    this.source = source;\n    /** @const {!Array<string>} */\n    this.products = products;\n    /** @const {string} */\n    this.subscriptionToken = subscriptionToken;\n  }\n\n  /**\n   * @return {!Entitlement}\n   */\n  clone() {\n    return new Entitlement(\n        this.source,\n        this.products.slice(0),\n        this.subscriptionToken);\n  }\n\n  /**\n   * @return {!Object}\n   */\n  json() {\n    return {\n      'source': this.source,\n      'products': this.products,\n      'subscriptionToken': this.subscriptionToken,\n    };\n  }\n\n  /**\n   * @param {?string} product\n   * @return {boolean}\n   */\n  enables(product) {\n    if (!product) {\n      return false;\n    }\n    return this.products.includes(product);\n  }\n\n  /**\n   * @param {?Object} json\n   * @return {!Entitlement}\n   */\n  static parseFromJson(json) {\n    if (!json) {\n      json = {};\n    }\n    const source = json['source'] || '';\n    const products = json['products'] || [];\n    const subscriptionToken = json['subscriptionToken'];\n    return new Entitlement(source, products, subscriptionToken);\n  }\n\n  /**\n   * The JSON is expected in one of the forms:\n   * - Single entitlement: `{products: [], ...}`.\n   * - A list of entitlements: `[{products: [], ...}, {...}]`.\n   * @param {!Object|!Array<!Object>} json\n   * @return {!Array<!Entitlement>}\n   */\n  static parseListFromJson(json) {\n    const jsonList = Array.isArray(json) ?\n        /** @type {!Array<Object>} */ (json) : [json];\n    return jsonList.map(json => Entitlement.parseFromJson(json));\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n */\nexport class Offer {\n\n  /**\n   * @param {string} skuId\n   * @param {string} title\n   * @param {string} description\n   * @param {string} price\n   */\n  constructor(skuId, title, description, price) {\n    /** @const {string} */\n    this.skuId = skuId;\n    /** @const {string} */\n    this.title = title;\n    /** @const {string} */\n    this.description = description;\n    /** @const {string} */\n    this.price = price;\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {UserData} from './user-data';\n\n\n/**\n */\nexport class SubscribeResponse {\n\n  /**\n   * @param {string} raw\n   * @param {!PurchaseData} purchaseData\n   * @param {?UserData} userData\n   * @param {function():!Promise} completeHandler\n   */\n  constructor(raw, purchaseData, userData, completeHandler) {\n    /** @const {string} */\n    this.raw = raw;\n    /** @const {!PurchaseData} */\n    this.purchaseData = purchaseData;\n    /** @const {?UserData} */\n    this.userData = userData;\n    /** @private @const {function():!Promise} */\n    this.completeHandler_ = completeHandler;\n  }\n\n  /**\n   * @return {!SubscribeResponse}\n   */\n  clone() {\n    return new SubscribeResponse(\n        this.raw,\n        this.purchaseData,\n        this.userData,\n        this.completeHandler_);\n  }\n\n  /**\n   * @return {!Object}\n   */\n  json() {\n    return {\n      'purchaseData': this.purchaseData.json(),\n      'userData': this.userData ? this.userData.json() : null,\n    };\n  }\n\n  /**\n   * Allows the receiving site to complete/acknowledge that it registered\n   * the subscription purchase. The typical action would be to create an\n   * account (or match an existing one) and associated the purchase with\n   * that account.\n   *\n   * SwG will display progress indicator until this method is called and\n   * upon receiving this call will show the confirmation to the user.\n   * The promise returned by this method will yield once the user closes\n   * the confirmation.\n   *\n   * @return {!Promise}\n   */\n  complete() {\n    return this.completeHandler_();\n  }\n}\n\n\n/**\n */\nexport class PurchaseData {\n\n  /**\n   * @param {string} raw\n   * @param {string} signature\n   */\n  constructor(raw, signature) {\n    /** @const {string} */\n    this.raw = raw;\n    /** @const {string} */\n    this.signature = signature;\n  }\n\n  /**\n   * @return {!PurchaseData}\n   */\n  clone() {\n    return new PurchaseData(this.raw, this.signature);\n  }\n\n  /**\n   * @return {!Object}\n   */\n  json() {\n    return {\n      'data': this.raw,\n      'signature': this.signature,\n    };\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Entitlements} from './entitlements';\nimport {Offer} from './offer';\nimport {\n  DeferredAccountCreationRequest,\n  DeferredAccountCreationResponse,\n} from './deferred-account-creation';\nimport {SubscribeResponse} from './subscribe-response';\n\n\n/**\n * @interface\n */\nexport class Subscriptions {\n\n  /**\n   * Optionally initializes the subscriptions runtime with publication or\n   * product ID. If not called, the runtime will look for the initialization\n   * parameters in the page's markup.\n   * @param {string} productOrPublicationId\n   */\n  init(productOrPublicationId) {}\n\n  /**\n   * Starts the entitlement flow.\n   */\n  start() {}\n\n  /**\n   * Resets the entitlements that can be fetched again.\n   */\n  reset() {}\n\n  /**\n   * @return {!Promise<!Entitlements>}\n   */\n  getEntitlements() {}\n\n  /**\n   * Set the subscribe callback.\n   * @param {function(!Promise<!Entitlements>)} callback\n   */\n  setOnEntitlementsResponse(callback) {}\n\n  /**\n   * Returns a set of offers.\n   * @param {{\n   *   productId: (string|undefined),\n   * }=} opt_options\n   * @return {!Promise<!Array<!Offer>>}\n   */\n  getOffers(opt_options) {}\n\n  /**\n   * Starts the Offers flow.\n   * @param {!OffersRequest=} opt_options\n   */\n  showOffers(opt_options) {}\n\n  /**\n   * Show subscription option.\n   * @param {!OffersRequest=} opt_options\n   */\n  showSubscribeOption(opt_options) {}\n\n  /**\n   * Show abbreviated offers.\n   * @param {!OffersRequest=} opt_options\n   */\n  showAbbrvOffer(opt_options) {}\n\n  /**\n   * Set the callback for the native subscribe request. Setting this callback\n   * triggers the \"native\" option in the offers flow.\n   * @param {function()} callback\n   */\n  setOnNativeSubscribeRequest(callback) {}\n\n  /**\n   * Set the subscribe complete callback.\n   * @param {function(!Promise<!SubscribeResponse>)} callback\n   */\n  setOnSubscribeResponse(callback) {}\n\n  /**\n   * Starts subscription purchase flow.\n   * @param {string} sku\n   */\n  subscribe(sku) {}\n\n  /**\n   * (Not launched)\n   * Starts the deferred account creation flow.\n   * See `DeferredAccountCreationRequest` for more details.\n   * @param {?DeferredAccountCreationRequest=} opt_options\n   * @return {!Promise<!DeferredAccountCreationResponse>}\n   */\n  completeDeferredAccountCreation(opt_options) {}\n\n  /**\n   * @param {function(!LoginRequest)} callback\n   */\n  setOnLoginRequest(callback) {}\n\n  /**\n   * @param {function()} callback\n   */\n  setOnLinkComplete(callback) {}\n\n  /**\n   * Starts the Account linking flow.\n   * TODO(dparikh): decide if it's only exposed for testing or PROD purposes.\n   */\n  linkAccount() {}\n\n  /**\n   * Notifies the client that a flow has been started. The name of the flow\n   * is passed as the callback argument. The flow name corresponds to the\n   * method name in this interface, such as \"showOffers\", or \"subscribe\".\n   * See `SubscriptionFlows` for the full list.\n   *\n   * Also see `setOnFlowCanceled` method.\n   *\n   * @param {function({flow: string, data: !Object})} callback\n   */\n  setOnFlowStarted(callback) {}\n\n  /**\n   * Notifies the client that a flow has been canceled. The name of the flow\n   * is passed as the callback argument. The flow name corresponds to the\n   * method name in this interface, such as \"showOffers\", or \"subscribe\".\n   * See `SubscriptionFlows` for the full list.\n   *\n   * Notice that some of the flows, such as \"subscribe\", could additionally\n   * have their own \"cancel\" events.\n   *\n   * Also see `setOnFlowStarted` method.\n   *\n   * @param {function({flow: string, data: !Object})} callback\n   */\n  setOnFlowCanceled(callback) {}\n\n /**\n  * Starts the save subscriptions flow.\n  * @param {!SaveSubscriptionRequest} request\n  * @return {!Promise<boolean>} status or promise of status of request\n  */\n  saveSubscription(request) {}\n\n  /**\n   * Creates an element with the SwG button style and the provided callback.\n   * The default theme is \"light\".\n   *\n   * @param {!ButtonOptions|function()} optionsOrCallback\n   * @param {function()=} opt_callback\n   * @return {!Element}\n   */\n  createButton(optionsOrCallback, opt_callback) {}\n\n  /**\n   * Attaches the SwG button style and the provided callback to an existing\n   * DOM element. The default theme is \"light\".\n   *\n   * @param {!Element} button\n   * @param {!ButtonOptions|function()} optionsOrCallback\n   * @param {function()=} opt_callback\n   */\n  attachButton(button, optionsOrCallback, opt_callback) {}\n}\n\n\n/** @enum {string} */\nexport const SubscriptionFlows = {\n  SHOW_OFFERS: 'showOffers',\n  SHOW_SUBSCRIBE_OPTION: 'showSubscribeOption',\n  SHOW_ABBRV_OFFER: 'showAbbrvOffer',\n  SUBSCRIBE: 'subscribe',\n  COMPLETE_DEFERRED_ACCOUNT_CREATION: 'completeDeferredAccountCreation',\n  LINK_ACCOUNT: 'linkAccount',\n};\n\n\n/**\n * Properties:\n * - skus - a list of SKUs to return from the defined or default list. The\n *   order is preserved.\n * - list - a predefined list of SKUs. Use of this property is uncommon.\n *   Possible values are \"default\" and \"amp\". Default is \"default\".\n * - isClosable - a boolean value to determine whether the view is closable.\n *\n * @typedef {{\n *   skus: (!Array<string>|undefined),\n *   list: (string|undefined),\n *   isClosable: (boolean|undefined),\n * }}\n */\nexport let OffersRequest;\n\n\n/**\n * @typedef {{\n *   linkRequested: boolean,\n * }}\n */\nexport let LoginRequest;\n\n\n/**\n * @typedef {{\n *   token: string,\n * }}\n */\nexport let SaveSubscriptionRequest;\n\n/**\n * Properties:\n * - theme: \"light\" or \"dark\". Default is \"light\".\n *\n * @typedef {{\n *   theme: string,\n * }}\n */\nexport let ButtonOptions;\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n */\nexport class UserData {\n\n  /**\n   * @param {string} idToken\n   * @param {!Object} data\n   */\n  constructor(idToken, data) {\n    /** @const {string} */\n    this.idToken = idToken;\n    /** @private @const {!Object} */\n    this.data = data;\n\n    /** @const {string} */\n    this.id = data['sub'];\n    /** @const {string} */\n    this.email = data['email'];\n    /** @const {boolean} */\n    this.emailVerified = data['email_verified'];\n    /** @const {string} */\n    this.name = data['name'];\n    /** @const {string} */\n    this.givenName = data['given_name'];\n    /** @const {string} */\n    this.familyName = data['family_name'];\n    /** @const {string} */\n    this.pictureUrl = data['picture'];\n  }\n\n  /**\n   * @return {!UserData}\n   */\n  clone() {\n    return new UserData(this.idToken, this.data);\n  }\n\n  /**\n   * @return {!Object}\n   */\n  json() {\n    return {\n      'id': this.id,\n      'email': this.email,\n      'emailVerified': this.emailVerified,\n      'name': this.name,\n      'givenName': this.givenName,\n      'familyName': this.familyName,\n      'pictureUrl': this.pictureUrl,\n    };\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Dialog} from './dialog';\nimport {Graypane} from './graypane';\nimport {isCancelError} from '../utils/errors';\n\nconst POPUP_Z_INDEX = 2147483647;\n\n\n/**\n * The class for the top level dialog.\n * @final\n */\nexport class DialogManager {\n\n  /**\n   * @param {!../model/doc.Doc} doc\n   */\n  constructor(doc) {\n    /** @private @const {!../model/doc.Doc} */\n    this.doc_ = doc;\n\n    /** @private {?Dialog} */\n    this.dialog_ = null;\n\n    /** @private {?Promise<!Dialog>} */\n    this.openPromise_ = null;\n\n    /** @private @const {!Graypane} */\n    this.popupGraypane_ = new Graypane(doc, POPUP_Z_INDEX);\n\n    /** @private {?Window} */\n    this.popupWin_ = null;\n\n    this.popupGraypane_.getElement().addEventListener('click', () => {\n      if (this.popupWin_) {\n        try {\n          this.popupWin_.focus();\n        } catch (e) {\n          // Ignore error.\n        }\n      }\n    });\n  }\n\n  /**\n   * @return {!Promise<!Dialog>}\n   */\n  openDialog() {\n    if (!this.openPromise_) {\n      this.dialog_ = new Dialog(this.doc_);\n      this.openPromise_ = this.dialog_.open();\n    }\n    return this.openPromise_;\n  }\n\n  /**\n   * @param {!./view.View} view\n   * @return {!Promise}\n   */\n  openView(view) {\n    view.whenComplete().catch(reason => {\n      if (isCancelError(reason)) {\n        this.completeView(view);\n      }\n      throw (reason);\n    });\n    return this.openDialog().then(dialog => {\n      return dialog.openView(view);\n    });\n  }\n\n  /**\n   * @param {?./view.View} view\n   */\n  completeView(view) {\n    // Give a small amount of time for another view to take over the dialog.\n    setTimeout(() => {\n      if (this.dialog_ && this.dialog_.getCurrentView() == view) {\n        this.close_();\n      }\n    }, 100);\n  }\n\n  /**\n   */\n  completeAll() {\n    if (this.dialog_) {\n      this.close_();\n    }\n    if (this.popupGraypane_.isAttached()) {\n      this.popupGraypane_.destroy();\n    }\n  }\n\n  /** @private */\n  close_() {\n    this.dialog_.close();\n    this.dialog_ = null;\n    this.openPromise_ = null;\n  }\n\n  /**\n   * @param {?Window|undefined} targetWin\n   */\n  popupOpened(targetWin) {\n    this.popupWin_ = targetWin || null;\n    if (!this.popupGraypane_.isAttached()) {\n      this.popupGraypane_.attach();\n    }\n    this.popupGraypane_.show();\n  }\n\n  /**\n   */\n  popupClosed() {\n    this.popupWin_ = null;\n    try {\n      this.popupGraypane_.hide();\n    } catch (e) {\n      // Ignore.\n    }\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {CSS as DIALOG_CSS} from '../../build/css/ui/ui.css';\nimport {Graypane} from './graypane';\nimport {LoadingView} from '../ui/loading-view';\nimport {\n  createElement,\n  injectStyleSheet,\n  removeChildren,\n} from '../utils/dom';\nimport {\n  setStyles,\n  setImportantStyles,\n} from '../utils/style';\nimport {transition} from '../utils/animation';\nimport {FriendlyIframe} from './friendly-iframe';\n\nconst Z_INDEX = 2147483647;\n\n/**\n * Default iframe important styles.\n * Note: The iframe responsiveness media query style is injected in the\n * publisher's page since style attribute can not include media query.\n * @const {!Object<string, string|number>}\n */\nconst rootElementImportantStyles = {\n  'min-height': '50px',\n  'border': 'none',\n  'display': 'block',\n  'position': 'fixed',\n  'z-index': Z_INDEX,\n  'box-sizing': 'border-box',\n};\n\n/**\n * Reset view styles.\n * @const {!Object<string, string|number>}\n */\nconst resetViewStyles = {\n  'position': 'absolute',\n  'top': '0',\n  'left': '0',\n  'right': '0',\n  'bottom': '0',\n  'opacity': 0,\n  /* These lines are a work around to this issue in iOS:     */\n  /* https://bugs.webkit.org/show_bug.cgi?id=155198          */\n  'height': 0,\n  'max-height': '100%',\n  'max-width': '100%',\n  'min-height': '100%',\n  'min-width': '100%',\n  'width': 0,\n};\n\n/**\n * Position of the dialog.\n * @const @enum {string}\n */\nconst PositionAt = {\n  BOTTOM: 'BOTTOM',\n  TOP: 'TOP',\n  FLOAT: 'FLOAT',\n  FULL: 'FULL',\n};\n\n\n/**\n * The class for the top level dialog.\n * @final\n */\nexport class Dialog {\n\n  /**\n   * Create a dialog for the provided doc.\n   * @param {!../model/doc.Doc} doc\n   * @param {!Object<string, string|number>=} importantStyles\n   * @param {!Object<string, string|number>=} styles\n   */\n  constructor(doc, importantStyles = {}, styles = {}) {\n    /** @private @const {!../model/doc.Doc} */\n    this.doc_ = doc;\n\n    /** @private @const {!FriendlyIframe} */\n    this.iframe_ = new FriendlyIframe(\n        doc.getWin().document, {'class': 'swg-dialog'});\n\n    /** @private @const {!Graypane} */\n    this.graypane_ = new Graypane(doc, Z_INDEX - 1);\n\n    const modifiedImportantStyles =\n        Object.assign({}, rootElementImportantStyles, importantStyles);\n    setImportantStyles(\n        this.iframe_.getElement(), modifiedImportantStyles);\n\n    setStyles(this.iframe_.getElement(), styles);\n\n    /** @private {LoadingView} */\n    this.loadingView_ = null;\n\n    /** @private {?Element} */\n    this.container_ = null;  // Depends on constructed document inside iframe.\n\n    /** @private {?./view.View} */\n    this.view_ = null;\n\n    /** @private {?Promise} */\n    this.animating_ = null;\n  }\n\n  /**\n   * Opens the dialog and builds the iframe container.\n   * @param {boolean=} animated\n   * @return {!Promise<!Dialog>}\n   */\n  open(animated = true) {\n    const iframe = this.iframe_;\n    if (iframe.isConnected()) {\n      throw new Error('already opened');\n    }\n\n    // Attach.\n    this.doc_.getBody().appendChild(iframe.getElement());  // Fires onload.\n    this.graypane_.attach();\n\n    if (animated) {\n      this.animate_(() => {\n        setImportantStyles(iframe.getElement(), {\n          'transform': 'translateY(100%)',\n        });\n        return transition(iframe.getElement(), {\n          'transform': 'translateY(0)',\n        }, 300, 'ease-out');\n      });\n    }\n\n    return iframe.whenReady().then(() => {\n      this.buildIframe_();\n      return this;\n    });\n  }\n\n  /**\n   * Build the iframe with the styling after iframe is loaded.\n   * @private\n   */\n  buildIframe_() {\n    const iframe = this.iframe_;\n    const iframeBody = iframe.getBody();\n    const iframeDoc = /** @type {!HTMLDocument} */ (this.iframe_.getDocument());\n\n    // Inject Google fonts in <HEAD> section of the iframe.\n    injectStyleSheet(iframeDoc, DIALOG_CSS);\n\n    // Add Loading indicator.\n    this.loadingView_ = new LoadingView(iframeDoc);\n    iframeBody.appendChild(this.loadingView_.getElement());\n\n    // Container for all dynamic content, including 3P iframe.\n    this.container_ = createElement(iframeDoc, 'swg-container', {});\n    iframeBody.appendChild(this.container_);\n    this.setPosition_();\n  }\n\n  /**\n   * Closes the dialog.\n   * @param {boolean=} animated\n   * @return {!Promise}\n   */\n  close(animated = true) {\n    let animating;\n    if (animated) {\n      animating = this.animate_(() => {\n        this.graypane_.hide(/* animate */ true);\n        return transition(this.getElement(), {\n          'transform': 'translateY(100%)',\n        }, 300, 'ease-out');\n      });\n    } else {\n      animating = Promise.resolve();\n    }\n    return animating.then(() => {\n      this.doc_.getBody().removeChild(this.iframe_.getElement());\n      this.removePaddingToHtml_();\n      this.graypane_.destroy();\n    });\n  }\n\n  /**\n   * Gets the container within the dialog.\n   * @return {!Element}\n   */\n  getContainer() {\n    if (!this.container_) {\n      throw new Error('not opened yet');\n    }\n    return this.container_;\n  }\n\n  /**\n   * Gets the attached iframe instance.\n   * @return {!FriendlyIframe}\n   */\n  getIframe() {\n    return this.iframe_;\n  }\n\n  /**\n   * Gets the Iframe element.\n   * @return {!HTMLIFrameElement}\n   */\n  getElement() {\n    return this.iframe_.getElement();\n  }\n\n  /**\n   * Whether to display loading indicator.\n   * @param {boolean} isLoading\n   */\n  setLoading(isLoading) {\n    if (isLoading) {\n      this.loadingView_.show();\n    } else {\n      this.loadingView_.hide();\n    }\n  }\n\n  /** @return {?./view.View} */\n  getCurrentView() {\n    return this.view_;\n  }\n\n  /**\n   * Opens the given view and removes existing view from the DOM if any.\n   * @param {!./view.View} view\n   * @return {!Promise}\n   */\n  openView(view) {\n    if (this.view_) {\n      // TODO(dparikh): Maybe I need to keep it until the new one is ready.\n      removeChildren(this.getContainer());\n    }\n    this.view_ = view;\n\n    setImportantStyles(view.getElement(), resetViewStyles);\n    this.setLoading(true);\n    this.getContainer().appendChild(view.getElement());\n\n    // If the current view should fade the parent document.\n    if (view.shouldFadeBody()) {\n      this.graypane_.show(/* animate */ true);\n    }\n    return view.init(this).then(() => {\n      setImportantStyles(view.getElement(), {\n        'opacity': 1,\n      });\n      this.setLoading(false);\n    });\n  }\n\n  /**\n   * Resizes the dialog container.\n   * @param {!./view.View} view\n   * @param {number} height\n   * @param {boolean=} animated\n   * @return {?Promise}\n   */\n  resizeView(view, height, animated = true) {\n    if (this.view_ != view) {\n      return null;\n    }\n    const newHeight = this.getMaxAllowedHeight_(height);\n\n    let animating;\n    if (animated) {\n      const oldHeight = this.getElement().offsetHeight;\n      if (newHeight >= oldHeight) {\n        // Expand.\n        animating = this.animate_(() => {\n          setImportantStyles(this.getElement(), {\n            'height': `${newHeight}px`,\n            'transform': `translateY(${newHeight - oldHeight}px)`,\n          });\n          return transition(this.getElement(), {\n            'transform': 'translateY(0)',\n          }, 300, 'ease-out');\n        });\n      } else {\n        // Collapse.\n        animating = this.animate_(() => {\n          return transition(this.getElement(), {\n            'transform': `translateY(${oldHeight - newHeight}px)`,\n          }, 300, 'ease-out').then(() => {\n            setImportantStyles(this.getElement(), {\n              'height': `${newHeight}px`,\n              'transform': 'translateY(0)',\n            });\n          });\n        });\n      }\n    } else {\n      setImportantStyles(this.getElement(), {\n        'height': `${newHeight}px`,\n      });\n      animating = Promise.resolve();\n    }\n    return animating.then(() => {\n      this.updatePaddingToHtml_(height);\n      view.resized();\n    });\n  }\n\n  /**\n   * @param {function():!Promise} callback\n   * @return {!Promise}\n   * @private\n   */\n  animate_(callback) {\n    const wait = this.animating_ || Promise.resolve();\n    return this.animating_ = wait.then(() => {\n      return callback();\n    }, () => {\n      // Ignore errors to make sure animations don't get stuck.\n    }).then(() => {\n      this.animating_ = null;\n    });\n  }\n\n  /**\n   * Returns maximum allowed height for current viewport.\n   * @param {number} height\n   * @return {number}\n   * @private\n   */\n  getMaxAllowedHeight_(height) {\n    return Math.min(height, this.doc_.getWin()./*OK*/innerHeight * 0.9);\n  }\n\n  /**\n   * Gets the element's height.\n   * @return {number}\n   * @private\n   */\n  getHeight_() {\n    return this.getElement().offsetHeight;\n  }\n\n  /**\n   * Sets the position of the dialog. Currently 'BOTTOM' is set by default.\n   */\n  setPosition_() {\n    setImportantStyles(this.getElement(), this.getPositionStyle_());\n  }\n\n  /**\n   * Add the padding to the containing page so as to not hide the content\n   * behind the popup, if rendered at the bottom.\n   * @param {number} newHeight\n   * @private\n   */\n  updatePaddingToHtml_(newHeight) {\n    if (this.inferPosition_() == PositionAt.BOTTOM) {\n      const bottomPadding = newHeight + 20;  // Add some extra padding.\n      const htmlElement = this.doc_.getRootElement();\n      setImportantStyles(htmlElement, {\n        'padding-bottom': `${bottomPadding}px`,\n      });\n    }\n  }\n\n  /**\n   * Removes previouly added bottom padding from the document.\n   * @private`\n   */\n  removePaddingToHtml_() {\n    this.doc_.getRootElement().style.removeProperty('padding-bottom');\n  }\n\n\n  /**\n   * Calculates the position of the dialog. Currently dialog is positioned at\n   * the bottom only. This could change in future to adjust the dialog position\n   * based on the screen size.\n   * @return {string}\n   * @private\n   */\n  inferPosition_() {\n    return PositionAt.BOTTOM;\n  }\n\n  /**\n   * Returns the styles required to postion the dialog.\n   * @return {!Object<string, string|number>}\n   * @private\n   */\n  getPositionStyle_() {\n    const dialogPosition = this.inferPosition_();\n    switch (dialogPosition) {\n      case PositionAt.BOTTOM:\n        return {'bottom': 0};\n      case PositionAt.TOP:\n        return {'top': 0};\n      case PositionAt.FLOAT:\n        return {\n          'position': 'fixed',\n          'top': '50%',\n          'left': '50%',\n          'transform': 'translate(-50%, -50%)',\n        };\n      case PositionAt.FULL:\n        return {\n          'position': 'fixed',\n          'height': '100%',\n          'top': 0,\n          'bottom': 0,\n        };\n      default:\n        return {'bottom': 0};\n    }\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createElement,\n} from '../utils/dom';\nimport {resetAllStyles} from '../utils/style';\n\n/** @const {!Object<string|number>} */\nconst friendlyIframeAttributes = {\n  'frameborder': 0,\n  'scrolling': 'no',\n  'src': 'about:blank',\n};\n\n/**\n * The class for building friendly iframe.\n */\nexport class FriendlyIframe {\n\n  /**\n   * @param {!Document} doc\n   * @param {!Object<string, string|number>=} attrs\n   */\n  constructor(doc, attrs = {}) {\n\n    const mergedAttrs = Object.assign({}, friendlyIframeAttributes, attrs);\n\n    /** @private @const {!HTMLIFrameElement} */\n    this.iframe_ =\n        /** @type {!HTMLIFrameElement} */ (\n            createElement(doc, 'iframe', mergedAttrs));\n\n    // Ensure that the new iframe does not inherit any CSS styles.\n    resetAllStyles(this.iframe_);\n\n    /** @private @const {!Promise} */\n    this.ready_ = new Promise(resolve => {\n      this.iframe_.onload = resolve;\n    });\n  }\n\n  /**\n   * When promise is resolved.\n   * @return {!Promise}\n   */\n  whenReady() {\n    return this.ready_;\n  }\n\n  /**\n   * Gets the iframe element.\n   * @return {!HTMLIFrameElement}\n   */\n  getElement() {\n    return this.iframe_;\n  }\n\n  /**\n   * Gets the document object of the iframe element.\n   * @return {!Document}\n   */\n  getDocument() {\n    const doc = this.getElement().contentDocument ||\n        (this.getElement().contentWindow &&\n        this.getElement().contentWindow.document);\n\n    if (!doc) {\n      throw new Error('not loaded');\n    }\n    return doc;\n  }\n\n  /**\n   * Gets the body of the iframe.\n   * @return {!Element}\n   */\n  getBody() {\n    return /** @type {!Element} */ (this.getDocument().body);\n  }\n\n  /**\n   * Whether the iframe is connected.\n   * @return {boolean}\n   */\n  isConnected() {\n    if (!this.getElement().ownerDocument) {\n      return false;\n    }\n    return this.getElement().ownerDocument.contains(this.iframe_);\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  setImportantStyles,\n} from '../utils/style';\nimport {transition} from '../utils/animation';\n\n\nexport class Graypane {\n\n  /**\n   * @param {!../model/doc.Doc} doc\n   * @param {number} zIndex\n   */\n  constructor(doc, zIndex) {\n    /** @private @const {!../model/doc.Doc} */\n    this.doc_ = doc;\n\n    /** @private @const {!Element} */\n    this.fadeBackground_ = this.doc_.getWin().document.createElement(\n        'swg-popup-background');\n    setImportantStyles(this.fadeBackground_, {\n      'z-index': zIndex,\n      'display': 'none',\n      'position': 'fixed',\n      'top': 0,\n      'right': 0,\n      'bottom': 0,\n      'left': 0,\n      'background-color': 'rgba(32, 33, 36, .6)',\n    });\n  }\n\n  /**\n   * @return {!Element}\n   */\n  getElement() {\n    return this.fadeBackground_;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isAttached() {\n    return !!this.fadeBackground_.parentNode;\n  }\n\n  /**\n   * Attaches the graypane to the document.\n   */\n  attach() {\n    this.doc_.getBody().appendChild(this.fadeBackground_);\n  }\n\n  /**\n   * Detaches the graypane to the document.\n   */\n  destroy() {\n    this.doc_.getBody().removeChild(this.fadeBackground_);\n  }\n\n  /**\n   * Shows the graypane.\n   * @param {boolean=} animated\n   * @return {!Promise|undefined}\n   */\n  show(animated = true) {\n    setImportantStyles(this.fadeBackground_, {\n      'display': 'block',\n      'opacity': animated ? 0 : 1,\n    });\n    if (animated) {\n      return transition(this.fadeBackground_, {\n        'opacity': 1,\n      }, 300, 'ease-out');\n    }\n  }\n\n  /**\n   * Hides the graypane.\n   * @param {boolean=} animated\n   * @return {!Promise|undefined}\n   */\n  hide(animated = true) {\n    if (animated) {\n      return transition(this.fadeBackground_, {\n        'opacity': 0,\n      }, 300, 'ease-out').then(() => {\n        setImportantStyles(this.fadeBackground_, {'display': 'none'});\n      });\n    }\n    setImportantStyles(this.fadeBackground_, {'display': 'none'});\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * abstract View Class. Used to render the content within the Dialog. The\n * extended class has actual content.\n * @abstract\n */\nexport class View {\n\n  /**\n   * Empty constructor.\n   */\n  constructor() {}\n\n  /**\n   * Gets the iframe element.\n   * @return {!Element}\n   * @abstract\n   */\n  getElement() {}\n\n  /**\n   * @param {!./dialog.Dialog} unusedDialog\n   * @return {!Promise}\n   * @abstract\n   */\n  init(unusedDialog) {}\n\n  /**\n   * Resizes the content.\n   */\n  resized() {\n    // Do nothing by default. Override if needed.\n  }\n\n  /*\n   * Accept the result.\n   * @return {!Promise}\n   */\n  whenComplete() {}\n\n  /**\n   * @return {boolean}\n   * @abstract\n   */\n  shouldFadeBody() {}\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Entry point into library for compilation with babel. Just loads main.js\n// and Babel's helpers.\n\nimport '../third_party/babel/custom-babel-helpers';\nimport './main';\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview\n * The entry point for runtime (swg.js).\n */\n\nimport './polyfills';\nimport {installRuntime} from './runtime/runtime';\n\ninstallRuntime(self);\n\nconsole.info('Subscriptions Runtime: $internalRuntimeVersion$');\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {isDocumentReady, whenDocumentReady} from '../utils/document-ready';\n\n\n/**\n * @interface\n */\nexport class Doc {\n\n  /**\n   * @return {!Window}\n   */\n  getWin() {}\n\n  /**\n   * The `Document` node or analog.\n   * @return {!Node}\n   */\n  getRootNode() {}\n\n  /**\n   * The `Document.documentElement` element or analog.\n   * @return {!Element}\n   */\n  getRootElement() {}\n\n  /**\n   * The `Document.head` element or analog. Returns `null` if not available\n   * yet.\n   * @return {!Element}\n   */\n  getHead() {}\n\n  /**\n   * The `Document.body` element or analog. Returns `null` if not available\n   * yet.\n   * @return {?Element}\n   */\n  getBody() {}\n\n  /**\n   * Whether the document has been fully constructed.\n   * @return {boolean}\n   */\n  isReady() {}\n\n  /**\n   * Resolved when document has been fully constructed.\n   * @return {!Promise}\n   */\n  whenReady() {}\n}\n\n\n/** @implements {Doc} */\nexport class GlobalDoc {\n\n  /**\n   * @param {!Window|!Document} winOrDoc\n   */\n  constructor(winOrDoc) {\n    const isWin = !!winOrDoc.document;\n    /** @private @const {!Window} */\n    this.win_ = isWin ?\n        /** @type {!Window} */ (winOrDoc) :\n        /** @type {!Window} */ (\n            (/** @type {!Document} */ (winOrDoc)).defaultView);\n    /** @private @const {!Document} */\n    this.doc_ = isWin ?\n        /** @type {!Window} */ (winOrDoc).document :\n        /** @type {!Document} */ (winOrDoc);\n  }\n\n  /** @override */\n  getWin() {\n    return this.win_;\n  }\n\n  /** @override */\n  getRootNode() {\n    return this.doc_;\n  }\n\n  /** @override */\n  getRootElement() {\n    return this.doc_.documentElement;\n  }\n\n  /** @override */\n  getHead() {\n    // `document.head` always has a chance to be parsed, at least partially.\n    return /** @type {!Element} */ (this.doc_.head);\n  }\n\n  /** @override */\n  getBody() {\n    return this.doc_.body;\n  }\n\n  /** @override */\n  isReady() {\n    return isDocumentReady(this.doc_);\n  }\n\n  /** @override */\n  whenReady() {\n    return whenDocumentReady(this.doc_);\n  }\n}\n\n\n/**\n * @param {!Document|!Window|!Doc} input\n * @return {!Doc}\n */\nexport function resolveDoc(input) {\n  // Is it a `Document`\n  if ((/** @type {!Document} */ (input)).nodeType === /* DOCUMENT */ 9) {\n    return new GlobalDoc(/** @type {!Document} */ (input));\n  }\n  // Is it a `Window`?\n  if ((/** @type {!Window} */ (input)).document) {\n    return new GlobalDoc(/** @type {!Window} */ (input));\n  }\n  return /** @type {!Doc} */ (input);\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Doc, resolveDoc} from './doc';\nimport {PageConfig} from './page-config';\nimport {hasNextNodeInDocumentOrder} from '../utils/dom';\nimport {isArray} from '../utils/types';\nimport {tryParseJson} from '../utils/json';\n\nconst ALREADY_SEEN = '__SWG-SEEN__';\nconst CONTROL_FLAG = 'subscriptions-control';\n\n\n/**\n */\nexport class PageConfigResolver {\n\n  /**\n   * @param {!Window|!Document|!Doc} winOrDoc\n   */\n  constructor(winOrDoc) {\n    /** @private @const {!Doc} */\n    this.doc_ = resolveDoc(winOrDoc);\n\n    /** @private {?function((!PageConfig|!Promise))} */\n    this.configResolver_ = null;\n\n    /** @private @const {!Promise<!PageConfig>} */\n    this.configPromise_ = new Promise(resolve => {\n      this.configResolver_ = resolve;\n    });\n\n    /** @private @const {!MetaParser} */\n    this.metaParser_ = new MetaParser(this.doc_);\n    /** @private @const {!JsonLdParser} */\n    this.ldParser_ = new JsonLdParser(this.doc_);\n    /** @private @const {!MicrodataParser} */\n    this.microdataParser_ = new MicrodataParser(this.doc_);\n  }\n\n  /**\n   * @return {!Promise<!PageConfig>}\n   */\n  resolveConfig() {\n    // Try resolve the config at different times.\n    Promise.resolve().then(this.check.bind(this));\n    this.doc_.whenReady().then(this.check.bind(this));\n    return this.configPromise_;\n  }\n\n  /**\n   * @return {?PageConfig}\n   */\n  check() {\n    // Already resolved.\n    if (!this.configResolver_) {\n      return null;\n    }\n    let config = this.metaParser_.check();\n    if (!config) {\n      config = this.ldParser_.check();\n    }\n    if (!config) {\n      config = this.microdataParser_.check();\n    }\n    if (config) {\n      // Product ID has been found: initialize the rest of the config.\n      this.configResolver_(config);\n      this.configResolver_ = null;\n    } else if (this.doc_.isReady()) {\n      this.configResolver_(Promise.reject(\n          new Error('No config could be discovered in the page')));\n      this.configResolver_ = null;\n    }\n    return config;\n  }\n}\n\n\nclass MetaParser {\n  /**\n   * @param {!Doc} doc\n   */\n  constructor(doc) {\n    /** @private @const {!Doc} */\n    this.doc_ = doc;\n  }\n\n  /**\n   * @return {?PageConfig}\n   */\n  check() {\n    if (!this.doc_.getBody()) {\n      // Wait until the whole `<head>` is parsed.\n      return null;\n    }\n\n    // Try to find product id.\n    const productId = getMetaTag(this.doc_.getRootNode(),\n        'subscriptions-product-id');\n    if (!productId) {\n      return null;\n    }\n\n    // Is locked?\n    const accessibleForFree = getMetaTag(this.doc_.getRootNode(),\n        'subscriptions-accessible-for-free');\n    const locked = (accessibleForFree &&\n        accessibleForFree.toLowerCase() == 'false') || false;\n\n    return new PageConfig(productId, locked);\n  }\n}\n\n\nclass JsonLdParser {\n  /**\n   * @param {!Doc} doc\n   */\n  constructor(doc) {\n    /** @private @const {!Doc} */\n    this.doc_ = doc;\n  }\n\n  /**\n   * @return {?PageConfig}\n   */\n  check() {\n    if (!this.doc_.getBody()) {\n      // Wait until the whole `<head>` is parsed.\n      return null;\n    }\n\n    const domReady = this.doc_.isReady();\n\n    // type: 'application/ld+json'\n    const elements = this.doc_.getRootNode().querySelectorAll(\n        'script[type=\"application/ld+json\"]');\n    for (let i = 0; i < elements.length; i++) {\n      const element = elements[i];\n      if (element[ALREADY_SEEN] ||\n          !element.textContent ||\n          !domReady && !hasNextNodeInDocumentOrder(element)) {\n        continue;\n      }\n      element[ALREADY_SEEN] = true;\n      if (element.textContent.indexOf('NewsArticle') == -1) {\n        continue;\n      }\n      const possibleConfig = this.tryExtractConfig_(element);\n      if (possibleConfig) {\n        return possibleConfig;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * @param {!Element} element\n   * @return {?PageConfig}\n   */\n  tryExtractConfig_(element) {\n    const json = tryParseJson(element.textContent);\n    if (!json) {\n      return null;\n    }\n\n    // Must be a NewsArticle.\n    if (!this.checkType_(json, 'NewsArticle')) {\n      return null;\n    }\n\n    // Must have a isPartOf[@type=Product].\n    let productId = null;\n    const partOfArray = this.valueArray_(json, 'isPartOf');\n    if (partOfArray) {\n      for (let i = 0; i < partOfArray.length; i++) {\n        productId = this.discoverProductId_(partOfArray[i]);\n        if (productId) {\n          break;\n        }\n      }\n    }\n    if (!productId) {\n      return null;\n    }\n\n    // Found product id, just check for the access flag.\n    const isAccessibleForFree = this.bool_(\n        this.singleValue_(json, 'isAccessibleForFree'),\n        /* default */ true);\n\n    return new PageConfig(productId, !isAccessibleForFree);\n  }\n\n  /**\n   * @param {*} value\n   * @param {boolean} def\n   * @return {boolean}\n   */\n  bool_(value, def) {\n    if (value == null || value === '') {\n      return def;\n    }\n    if (typeof value == 'boolean') {\n      return value;\n    }\n    if (typeof value == 'string') {\n      const lowercase = value.toLowerCase();\n      if (lowercase == 'false') {\n        return false;\n      }\n      if (lowercase == 'true') {\n        return true;\n      }\n    }\n    return def;\n  }\n\n  /**\n   * @param {!Object} json\n   * @return {?string}\n   */\n  discoverProductId_(json) {\n    // Must have type `Product`.\n    if (!this.checkType_(json, 'Product')) {\n      return null;\n    }\n    return /** @type {?string} */ (this.singleValue_(json, 'productID'));\n  }\n\n  /**\n   * @param {!Object} json\n   * @param {string} name\n   * @return {?Array}\n   */\n  valueArray_(json, name) {\n    const value = json[name];\n    if (value == null || value === '') {\n      return null;\n    }\n    return isArray(value) ? value : [value];\n  }\n\n  /**\n   * @param {!Object} json\n   * @param {string} name\n   * @return {*}\n   */\n  singleValue_(json, name) {\n    const valueArray = this.valueArray_(json, name);\n    const value = valueArray && valueArray[0];\n    return (value == null || value === '') ? null : value;\n  }\n\n  /**\n   * @param {!Object} json\n   * @param {string} expectedType\n   * @return {boolean}\n   */\n  checkType_(json, expectedType) {\n    const typeArray = this.valueArray_(json, '@type');\n    if (!typeArray) {\n      return false;\n    }\n    return (typeArray.includes(expectedType) ||\n        typeArray.includes('http://schema.org/' + expectedType));\n  }\n}\n\nclass MicrodataParser {\n  /**\n   * @param {!Doc} doc\n   */\n  constructor(doc) {\n    /** @private @const {!Doc} */\n    this.doc_ = doc;\n    /** @private {?boolean} */\n    this.access_ = null;\n    /** @private {?string} */\n    this.productId_ = null;\n  }\n\n  /**\n   * Returns false if access is restricted, otherwise true\n   * @param {!Element} root An element that is an item of type 'NewsArticle'\n   * @return {?boolean} locked access\n   * @private\n   */\n  discoverAccess_(root) {\n    const ALREADY_SEEN = 'alreadySeenForAccessInfo';\n    const nodeList = root\n        .querySelectorAll(\"[itemprop='isAccessibleForFree']\");\n    for (let i = 0; nodeList[i]; i++) {\n      const element = nodeList[i];\n      const content = element.getAttribute('content') || element.textContent;\n      if (!content) {\n        continue;\n      }\n      if (this.isValidElement_(element, root, ALREADY_SEEN)) {\n        let accessForFree = null;\n        if (content.toLowerCase() == 'true') {\n          accessForFree = true;\n        } else if (content.toLowerCase() == 'false') {\n          accessForFree = false;\n        }\n        return accessForFree;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Verifies if an element is valid based on the following\n   * - child of an item of type 'NewsArticle'\n   * - not a child of an item of any other type\n   * - not seen before, marked using the alreadySeen tag\n   * @param {?Element} current the element to be verified\n   * @param {!Element} root the parent to track up to\n   * @param {!string} alreadySeen used to tag already visited nodes\n   * @return {!boolean} valid node\n   * @private\n   */\n  isValidElement_(current, root, alreadySeen) {\n    for (let node = current;\n        node && !node[alreadySeen]; node = node.parentNode) {\n      node[alreadySeen] = true;\n      if (node.hasAttribute('itemscope')) {\n        /**{?string} */\n        const type = node.getAttribute('itemtype');\n        if (type.indexOf('http://schema.org/NewsArticle') >= 0) {\n          return true;\n        } else {\n          return false;\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Obtains the product ID that meets the requirements\n   * - child of an item of type 'NewsArticle'\n   * - Not a child of an item of type 'Section'\n   * - child of an item of type 'productID'\n   * @param {!Element} root An element that is an item of type 'NewsArticle'\n   * @return {?string} product ID, if found\n   * @private\n   */\n  discoverProductId_(root) {\n    const ALREADY_SEEN = 'alreadySeenForProductInfo';\n    const nodeList = root\n        .querySelectorAll('[itemprop=\"productID\"]');\n    for (let i = 0; nodeList[i]; i++) {\n      const element = nodeList[i];\n      const content = element.getAttribute('content') || element.textContent;\n      const item = element.closest('[itemtype][itemscope]');\n      const type = item.getAttribute('itemtype');\n      if (type.indexOf('http://schema.org/Product') <= -1) {\n        continue;\n      }\n      if (this.isValidElement_(item.parentElement, root, ALREADY_SEEN)) {\n        return content;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Returns PageConfig if available\n   * @return {?PageConfig} PageConfig found so far\n   */\n  getPageConfig_() {\n    let locked = null;\n    if (this.access_ != null) {\n      locked = !this.access_;\n    } else if (this.doc_.isReady()) {\n      // Default to unlocked\n      locked = false;\n    }\n    if (this.productId_ != null && locked != null) {\n      return new PageConfig(this.productId_, locked);\n    }\n    return null;\n  }\n\n  /**\n   * Extracts page config from Microdata in the DOM\n   * @return {?PageConfig} PageConfig found\n   */\n  tryExtractConfig_() {\n    let config = this.getPageConfig_();\n    if (config) {\n      return config;\n    }\n    const nodeList = this.doc_.getRootNode().querySelectorAll(\n        '[itemscope][itemtype*=\"http://schema.org/NewsArticle\"]');\n    for (let i = 0; nodeList[i] && config == null; i++) {\n      const element = nodeList[i];\n      if (this.access_ == null) {\n        this.access_ = this.discoverAccess_(element);\n      }\n      if (!this.productId_) {\n        this.productId_ = this.discoverProductId_(element);\n      }\n      config = this.getPageConfig_();\n    }\n    return config;\n  }\n\n  /**\n   * @return {?PageConfig}\n   */\n  check() {\n    if (!this.doc_.getBody()) {\n      // Wait until the whole `<head>` is parsed.\n      return null;\n    }\n    return this.tryExtractConfig_();\n  }\n}\n\n/**\n * @param {!Node} rootNode\n * @return {?string}\n */\nexport function getControlFlag(rootNode) {\n  // Look for the flag in `meta`.\n  const flag = getMetaTag(rootNode, CONTROL_FLAG);\n  if (flag) {\n    return flag;\n  }\n  // Look for the flag in `script`.\n  const el = rootNode.querySelector(`script[${CONTROL_FLAG}]`);\n  if (el) {\n    return el.getAttribute(CONTROL_FLAG);\n  }\n  return null;\n}\n\n/**\n * Returns the value from content attribute of a meta tag with given name.\n *\n * If multiple tags are found, the first value is returned.\n *\n * @param {!Node} rootNode\n * @param {string} name The tag name to look for.\n * @return {?string} attribute value or empty string.\n * @private\n */\nfunction getMetaTag(rootNode, name) {\n  const el = rootNode.querySelector(`meta[name=\"${name}\"]`);\n  if (el) {\n    return el.getAttribute('content');\n  }\n  return null;\n}\n\n\n/** @package Visible for testing only. */\nexport function getDocClassForTesting() {\n  return Doc;\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n */\nexport class PageConfig {\n\n  /**\n   * @param {string} productOrPublicationId\n   * @param {boolean} locked\n   */\n  constructor(productOrPublicationId, locked) {\n    let publicationId, productId, label;\n    const div = productOrPublicationId.indexOf(':');\n    if (div != -1) {\n      // The argument is a product id.\n      productId = productOrPublicationId;\n      publicationId = productId.substring(0, div);\n      label = productId.substring(div + 1);\n    } else {\n      // The argument is a publication id.\n      publicationId = productOrPublicationId;\n      productId = null;\n      label = null;\n    }\n\n    /** @private @const {string} */\n    this.publicationId_ = publicationId;\n    /** @private @const {?string} */\n    this.productId_ = productId;\n    /** @private @const {?string} */\n    this.label_ = label;\n    /** @private @const {boolean} */\n    this.locked_ = locked;\n  }\n\n  /**\n   * @return {string}\n   */\n  getPublicationId() {\n    return this.publicationId_;\n  }\n\n  /**\n   * @return {?string}\n   */\n  getProductId() {\n    return this.productId_;\n  }\n\n  /**\n   * @return {?string}\n   */\n  getLabel() {\n    return this.label_;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isLocked() {\n    return this.locked_;\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Loads all polyfills needed by the project.\n * This list should not get longer without a very good reason.\n */\nimport {\n  install as installDOMTokenListToggle,\n} from './polyfills/domtokenlist-toggle';\nimport {install as installDocContains} from './polyfills/document-contains';\nimport {install as installMathSign} from './polyfills/math-sign';\nimport {install as installObjectAssign} from './polyfills/object-assign';\nimport {install as installPromise} from './polyfills/promise';\nimport {install as installArrayIncludes} from './polyfills/array-includes';\n\n\ninstallDOMTokenListToggle(self);\ninstallMathSign(self);\ninstallObjectAssign(self);\ninstallPromise(self);\ninstallDocContains(self);\ninstallArrayIncludes(self);\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * Returns true if the element is in the array and false otherwise.\n *\n * @param {*} value\n * @param {number=} opt_fromIndex\n * @return {boolean}\n * @this {Array}\n */\nfunction includes(value, opt_fromIndex) {\n  const fromIndex = opt_fromIndex || 0;\n  const len = this.length;\n  let i = fromIndex >= 0 ? fromIndex : Math.max(len + fromIndex, 0);\n  for (; i < len; i++) {\n    const other = this[i];\n    // If value has been found OR (value is NaN AND other is NaN)\n    /*eslint \"no-self-compare\": 0*/\n    if (other === value || (value !== value && other !== other)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n* Sets the Array.contains polyfill if it does not exist.\n* @param {!Window} win\n*/\nexport function install(win) {\n  if (!win.Array.prototype.includes) {\n    win.Object.defineProperty(Array.prototype, 'includes', {\n      enumerable: false,\n      configurable: true,\n      writable: true,\n      value: includes,\n    });\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * Polyfill for `document.contains()` method. Notice that according to spec\n * `document.contains` is inclusionary.\n * See https://developer.mozilla.org/en-US/docs/Web/API/Node/contains\n * @param {?Node} node\n * @return {boolean}\n * @this {Node}\n */\nfunction documentContainsPolyfill(node) {\n  // Per spec, \"contains\" method is inclusionary\n  // i.e. `node.contains(node) == true`. However, we still need to test\n  // equality to the document itself.\n  return node == this || this.documentElement.contains(node);\n}\n\n\n/**\n * Polyfills `HTMLDocument.contains` API.\n * @param {!Window} win\n */\nexport function install(win) {\n  if (!win.HTMLDocument.prototype.contains) {\n    win.Object.defineProperty(win.HTMLDocument.prototype, 'contains', {\n      enumerable: false,\n      configurable: true,\n      writable: true,\n      value: documentContainsPolyfill,\n    });\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * Polyfill for `DOMTokenList.prototype.toggle(token, opt_force)` method.\n * This is specially important because IE does not support `opt_force` attribute.\n * See https://goo.gl/hgKNYY for details.\n * @param {string} token\n * @param {boolean=} opt_force\n * @this {DOMTokenList}\n * @return {boolean}\n */\nfunction domTokenListTogglePolyfill(token, opt_force) {\n  const remove = opt_force === undefined ? this.contains(token) : !opt_force;\n  if (remove) {\n    this.remove(token);\n    return false;\n  } else {\n    this.add(token);\n    return true;\n  }\n}\n\n\n/**\n * Polyfills `DOMTokenList.prototype.toggle` API in IE.\n * @param {!Window} win\n */\nexport function install(win) {\n  if (isIe(win) && win.DOMTokenList) {\n    win.Object.defineProperty(win.DOMTokenList.prototype, 'toggle', {\n      enumerable: false,\n      configurable: true,\n      writable: true,\n      value: domTokenListTogglePolyfill,\n    });\n  }\n}\n\n\n/**\n * Whether the current browser is a IE browser.\n * @param {!Window} win\n * @return {boolean}\n */\nfunction isIe(win) {\n  return /Trident|MSIE|IEMobile/i.test(win.navigator.userAgent);\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Parses the number x and returns its sign. For positive x returns 1, for\n * negative, -1. For 0 and -0, returns 0 and -0 respectively. For any number\n * that parses to NaN, returns NaN.\n *\n * @param {number} x\n * @returns {number}\n */\nexport function sign(x) {\n  x = Number(x);\n\n  // If x is 0, -0, or NaN, return it.\n  if (!x) {\n    return x;\n  }\n\n  return x > 0 ? 1 : -1;\n};\n\n\n/**\n * Sets the Math.sign polyfill if it does not exist.\n * @param {!Window} win\n */\nexport function install(win) {\n  if (!win.Math.sign) {\n    win.Object.defineProperty(win.Math, 'sign', {\n      enumerable: false,\n      configurable: true,\n      writable: true,\n      value: sign,\n    });\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * Copies values of all enumerable own properties from one or more source\n * objects (provided as extended arguments to the function) to a target object.\n *\n * @param {!Object} target\n * @param {...Object} var_args\n * @returns {!Object}\n */\nexport function assign(target, var_args) {\n  if (target == null) {\n    throw new TypeError('Cannot convert undefined or null to object');\n  }\n\n  const output = Object(target);\n  for (let i = 1; i < arguments.length; i++) {\n    const source = arguments[i];\n    if (source != null) {\n      for (const key in source) {\n        if (hasOwnProperty.call(source, key)) {\n          output[key] = source[key];\n        }\n      }\n    }\n  }\n  return output;\n}\n\n\n/**\n * Sets the Object.assign polyfill if it does not exist.\n * @param {!Window} win\n */\nexport function install(win) {\n  if (!win.Object.assign) {\n    win.Object.defineProperty(win.Object, 'assign', {\n      enumerable: false,\n      configurable: true,\n      writable: true,\n      value: assign,\n    });\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport * as Promise from 'promise-pjs/promise';\n\n/**\n * Sets the Promise polyfill if it does not exist.\n * @param {!Window} win\n */\nexport function install(win) {\n  if (!win.Promise) {\n    win.Promise = /** @type {?} */ (Promise);\n    // In babel the * export is an Object with a default property.\n    // In closure compiler it is the Promise function itself.\n    if (Promise.default) {\n      win.Promise = Promise.default;\n    }\n    // We copy the individual static methods, because closure\n    // compiler flattens the polyfill namespace.\n    win.Promise.resolve = Promise.resolve;\n    win.Promise.reject = Promise.reject;\n    win.Promise.all = Promise.all;\n    win.Promise.race = Promise.race;\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {createElement} from '../utils/dom';\n\n\n/**\n * The button stylesheet can be found in the `/assets/swg-button.css`.\n * It's produced by the `assets:swg-button` gulp task and deployed to\n * `https://news.google.com/swg/js/v1/swg-button.css`.\n */\nexport class ButtonApi {\n\n  /**\n   * @param {!../model/doc.Doc} doc\n   */\n  constructor(doc) {\n    /** @private @const {!../model/doc.Doc} */\n    this.doc_ = doc;\n  }\n\n  /**\n   */\n  init() {\n    const head = this.doc_.getHead();\n    if (!head) {\n      return;\n    }\n\n    const url = 'https://news.google.com/swg/js/v1/swg-button.css';\n    const existing = head.querySelector(`link[href=\"${url}\"]`);\n    if (existing) {\n      return;\n    }\n\n    // <link rel=\"stylesheet\" href=\"...\" type=\"text/css\">\n    head.appendChild(createElement(this.doc_.getWin().document, 'link', {\n      'rel': 'stylesheet',\n      'type': 'text/css',\n      'href': url,\n    }));\n  }\n\n  /**\n   * @param {!Object|function()} optionsOrCallback\n   * @param {function()=} opt_callback\n   * @return {!Element}\n   */\n  create(optionsOrCallback, opt_callback) {\n    const button = createElement(this.doc_.getWin().document, 'button', {});\n    return this.attach(button, optionsOrCallback, opt_callback);\n  }\n\n  /**\n   * @param {!Element} button\n   * @param {!Object|function()} optionsOrCallback\n   * @param {function()=} opt_callback\n   * @return {!Element}\n   */\n  attach(button, optionsOrCallback, opt_callback) {\n    const options =\n        typeof optionsOrCallback != 'function' ?\n        optionsOrCallback : null;\n    const callback = /** @type {function()} */ (\n        (typeof optionsOrCallback == 'function' ? optionsOrCallback : null) ||\n            opt_callback);\n    let theme = options && options['theme'];\n    if (theme !== 'light' && theme !== 'dark') {\n      theme = 'light';\n    }\n    button.classList.add(`swg-button-${theme}`);\n    button.setAttribute('role', 'button');\n    // TODO(dvoytenko): i18n.\n    button.setAttribute('title', 'Subscribe with Google');\n    button.addEventListener('click', callback);\n    return button;\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/** @enum {number} */\nconst CallbackId = {\n  ENTITLEMENTS: 1,\n  SUBSCRIBE_REQUEST: 2,\n  SUBSCRIBE_RESPONSE: 3,\n  LOGIN_REQUEST: 4,\n  LINK_PROGRESS: 5,\n  LINK_COMPLETE: 6,\n  FLOW_STARTED: 7,\n  FLOW_CANCELED: 8,\n};\n\n\n/**\n */\nexport class Callbacks {\n\n  /**\n   */\n  constructor() {\n    /** @private @const {!Object<CallbackId, function(*)>} */\n    this.callbacks_ = {};\n    /** @private @const {!Object<CallbackId, *>} */\n    this.resultBuffer_ = {};\n  }\n\n  /**\n   * @param {function(!Promise<!../api/entitlements.Entitlements>)} callback\n   */\n  setOnEntitlementsResponse(callback) {\n    this.setCallback_(CallbackId.ENTITLEMENTS, callback);\n  }\n\n  /**\n   * @param {!Promise<!../api/entitlements.Entitlements>} promise\n   */\n  triggerEntitlementsResponse(promise) {\n    return this.trigger_(\n        CallbackId.ENTITLEMENTS,\n        promise.then(res => res.clone()));\n  }\n\n  /**\n   * @return {boolean}\n   */\n  hasEntitlementsResponsePending() {\n    return !!this.resultBuffer_[CallbackId.ENTITLEMENTS];\n  }\n\n  /**\n   * @param {function(!../api/subscriptions.LoginRequest)} callback\n   */\n  setOnLoginRequest(callback) {\n    this.setCallback_(CallbackId.LOGIN_REQUEST, callback);\n  }\n\n  /**\n   * @param {!../api/subscriptions.LoginRequest} request\n   * @return {boolean} Whether the callback has been found.\n   */\n  triggerLoginRequest(request) {\n    return this.trigger_(CallbackId.LOGIN_REQUEST, request);\n  }\n\n  /**\n   * @param {function()} callback\n   */\n  setOnLinkProgress(callback) {\n    this.setCallback_(CallbackId.LINK_PROGRESS, callback);\n  }\n\n  /**\n   * @return {boolean} Whether the callback has been found.\n   */\n  triggerLinkProgress() {\n    return this.trigger_(CallbackId.LINK_PROGRESS, true);\n  }\n\n  /**\n   */\n  resetLinkProgress() {\n    this.resetCallback_(CallbackId.LINK_PROGRESS);\n  }\n\n  /**\n   * @param {function()} callback\n   */\n  setOnLinkComplete(callback) {\n    this.setCallback_(CallbackId.LINK_COMPLETE, callback);\n  }\n\n  /**\n   * @return {boolean} Whether the callback has been found.\n   */\n  triggerLinkComplete() {\n    return this.trigger_(CallbackId.LINK_COMPLETE, true);\n  }\n\n  /**\n   * @return {boolean}\n   */\n  hasLinkCompletePending() {\n    return !!this.resultBuffer_[CallbackId.LINK_COMPLETE];\n  }\n\n  /**\n   * @param {function()} callback\n   */\n  setOnSubscribeRequest(callback) {\n    this.setCallback_(CallbackId.SUBSCRIBE_REQUEST, callback);\n  }\n\n  /**\n   * @return {boolean} Whether the callback has been found.\n   */\n  triggerSubscribeRequest() {\n    return this.trigger_(CallbackId.SUBSCRIBE_REQUEST, true);\n  }\n\n  /**\n   * @return {boolean}\n   */\n  hasSubscribeRequestCallback() {\n    return !!this.callbacks_[CallbackId.SUBSCRIBE_REQUEST];\n  }\n\n  /**\n   * @param {function(!Promise<!../api/subscribe-response.SubscribeResponse>)} callback\n   */\n  setOnSubscribeResponse(callback) {\n    this.setCallback_(CallbackId.SUBSCRIBE_RESPONSE, callback);\n  }\n\n  /**\n   * @param {!Promise<!../api/subscribe-response.SubscribeResponse>} responsePromise\n   * @return {boolean} Whether the callback has been found.\n   */\n  triggerSubscribeResponse(responsePromise) {\n    return this.trigger_(\n        CallbackId.SUBSCRIBE_RESPONSE,\n        responsePromise.then(res => res.clone()));\n  }\n\n  /**\n   * @return {boolean}\n   */\n  hasSubscribeResponsePending() {\n    return !!this.resultBuffer_[CallbackId.SUBSCRIBE_RESPONSE];\n  }\n\n  /**\n   * @param {function({flow: string, data: !Object})} callback\n   */\n  setOnFlowStarted(callback) {\n    this.setCallback_(CallbackId.FLOW_STARTED, callback);\n  }\n\n  /**\n   * @param {string} flow\n   * @param {!Object=} opt_data\n   * @return {boolean} Whether the callback has been found.\n   */\n  triggerFlowStarted(flow, opt_data) {\n    return this.trigger_(CallbackId.FLOW_STARTED, {\n      flow,\n      data: opt_data || {},\n    });\n  }\n\n  /**\n   * @param {function({flow: string, data: !Object})} callback\n   */\n  setOnFlowCanceled(callback) {\n    this.setCallback_(CallbackId.FLOW_CANCELED, callback);\n  }\n\n  /**\n   * @param {string} flow\n   * @param {!Object=} opt_data\n   * @return {boolean} Whether the callback has been found.\n   */\n  triggerFlowCanceled(flow, opt_data) {\n    return this.trigger_(CallbackId.FLOW_CANCELED, {\n      flow,\n      data: opt_data || {},\n    });\n  }\n\n  /**\n   * @param {!CallbackId} id\n   * @param {function(?)} callback\n   * @private\n   */\n  setCallback_(id, callback) {\n    this.callbacks_[id] = callback;\n    // If result already exist, execute the callback right away.\n    if (id in this.resultBuffer_) {\n      this.executeCallback_(id, callback, this.resultBuffer_[id]);\n    }\n  }\n\n  /**\n   * @param {!CallbackId} id\n   * @param {*} data\n   * @return {boolean}\n   * @private\n   */\n  trigger_(id, data) {\n    this.resultBuffer_[id] = data;\n    const callback = this.callbacks_[id];\n    if (callback) {\n      this.executeCallback_(id, callback, data);\n    }\n    return !!callback;\n  }\n\n  /**\n   * @param {!CallbackId} id\n   * @private\n   */\n  resetCallback_(id) {\n    if (id in this.resultBuffer_) {\n      delete this.resultBuffer_[id];\n    }\n  }\n\n  /**\n   * @param {!CallbackId} id\n   * @param {function(*)} callback\n   * @param {*} data\n   * @private\n   */\n  executeCallback_(id, callback, data) {\n    // Always execute callbacks in a microtask.\n    Promise.resolve().then(() => {\n      callback(data);\n      this.resetCallback_(id);\n    });\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {ActivityIframeView} from '../ui/activity-iframe-view';\nimport {\n  DeferredAccountCreationResponse,\n} from '../api/deferred-account-creation';\nimport {JwtHelper} from '../utils/jwt';\nimport {PayCompleteFlow} from './pay-flow';\nimport {\n  PurchaseData,\n  SubscribeResponse,\n} from '../api/subscribe-response';\nimport {SubscriptionFlows} from '../api/subscriptions';\nimport {UserData} from '../api/user-data';\nimport {feArgs, feUrl} from './services';\nimport {isCancelError} from '../utils/errors';\n\n\n/**\n * The flow to initiate deferred account process.\n * See `Subscriptions.completeDeferredAccountCreation` API.\n */\nexport class DeferredAccountFlow {\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   * @param {?../api/deferred-account-creation.DeferredAccountCreationRequest} options\n   */\n  constructor(deps, options) {\n    /** @private @const {!./deps.DepsDef} */\n    this.deps_ = deps;\n\n    /** @private @const {!Window} */\n    this.win_ = deps.win();\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {!../components/dialog-manager.DialogManager} */\n    this.dialogManager_ = deps.dialogManager();\n\n    /** @private {?ActivityIframeView} */\n    this.activityIframeView_ = null;\n\n    /** @private {?Promise} */\n    this.openPromise_ = null;\n\n    /** @type {!../api/deferred-account-creation.DeferredAccountCreationRequest} */\n    const defaultOptions = {\n      entitlements: null,\n      consent: true,\n    };\n    /** @private @const {!../api/deferred-account-creation.DeferredAccountCreationRequest} */\n    this.options_ = Object.assign(defaultOptions, options || {});\n  }\n\n  /**\n   * Starts the deferred account flow.\n   * @return {!Promise<!DeferredAccountCreationResponse>}\n   */\n  start() {\n    const entitlements = this.options_.entitlements;\n\n    // For now, entitlements are required to be present and have the Google\n    // token. This is strictly not required for the implementation. But it's\n    // preferrable API-wise at this time.\n    if (!entitlements || !entitlements.getEntitlementForSource('google')) {\n      throw new Error('No entitlements with \"google\" source');\n    }\n\n    // Start/cancel events.\n    this.deps_.callbacks().triggerFlowStarted(\n        SubscriptionFlows.COMPLETE_DEFERRED_ACCOUNT_CREATION);\n\n    this.activityIframeView_ = new ActivityIframeView(\n        this.win_,\n        this.activityPorts_,\n        feUrl('/recoveriframe'),\n        feArgs({\n          'publicationId': this.deps_.pageConfig().getPublicationId(),\n          'productId': this.deps_.pageConfig().getProductId(),\n          'entitlements': entitlements && entitlements.raw || null,\n          'consent': this.options_.consent,\n        }),\n        /* shouldFadeBody */ true);\n\n    this.openPromise_ = this.dialogManager_.openView(this.activityIframeView_);\n    return this.activityIframeView_.acceptResult().then(result => {\n      // The consent part is complete.\n      return this.handleConsentResponse_(/** @type {!Object} */ (result.data));\n    }, reason => {\n      if (isCancelError(reason)) {\n        this.deps_.callbacks().triggerFlowCanceled(\n            SubscriptionFlows.COMPLETE_DEFERRED_ACCOUNT_CREATION);\n      } else {\n        this.dialogManager_.completeView(this.activityIframeView_);\n      }\n      throw reason;\n    });\n  }\n\n  /**\n   * @param {!Object} data\n   * @return {!DeferredAccountCreationResponse}\n   * @private\n   */\n  handleConsentResponse_(data) {\n    this.deps_.entitlementsManager().blockNextNotification();\n\n    // Parse the response.\n    const entitlementsJwt = data['entitlements'];\n    const idToken = data['idToken'];\n    const entitlements = this.deps_.entitlementsManager()\n        .parseEntitlements({'signedEntitlements': entitlementsJwt});\n    const userData = new UserData(\n        idToken,\n        /** @type {!Object} */ (new JwtHelper().decode(idToken)));\n    const purchaseData = new PurchaseData(\n        data['purchaseData'],\n        data['purchaseDataSignature']);\n\n    // For now, we'll use the `PayCompleteFlow` as a \"creating account\" flow.\n    // But this can be eventually implemented by the same iframe.\n    const creatingFlow = new PayCompleteFlow(this.deps_);\n    const completeHandler = creatingFlow.complete.bind(creatingFlow);\n\n    const response = new DeferredAccountCreationResponse(\n        entitlements,\n        userData,\n        purchaseData,\n        completeHandler);\n\n    // Start the \"sync\" flow.\n    creatingFlow.start(new SubscribeResponse(\n        '',  // raw field doesn't matter in this case\n        purchaseData,\n        userData,\n        () => Promise.resolve()  // completeHandler doesn't matter in this case\n        ));\n    return response;\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/** @interface */\nexport class DepsDef {\n\n  /**\n   * @return {!../model/doc.Doc}\n   */\n  doc() {}\n\n  /**\n   * @return {!Window}\n   */\n  win() {}\n\n  /**\n   * @return {!../model/page-config.PageConfig}\n   */\n  pageConfig() {}\n\n  /**\n   * @return {!web-activities/activity-ports.ActivityPorts}\n   */\n  activities() {}\n\n  /**\n   * @return {!../components/dialog-manager.DialogManager}\n   */\n  dialogManager() {}\n\n  /**\n   * @return {!./entitlements-manager.EntitlementsManager}\n   */\n  entitlementsManager() {}\n\n  /**\n   * @return {!./callbacks.Callbacks}\n   */\n  callbacks() {}\n\n  /**\n   * @return {!../runtime/storage.Storage}\n   */\n  storage() {}\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Entitlement, Entitlements} from '../api/entitlements';\nimport {JwtHelper} from '../utils/jwt';\nimport {Toast} from '../ui/toast';\nimport {serviceUrl} from './services';\nimport {feArgs, feUrl} from '../runtime/services';\n\nconst SERVICE_ID = 'subscribe.google.com';\nconst TOAST_STORAGE_KEY = 'toast';\n\n\n/**\n */\nexport class EntitlementsManager {\n\n  /**\n   * @param {!Window} win\n   * @param {!../model/page-config.PageConfig} config\n   * @param {!./fetcher.Fetcher} fetcher\n   * @param {!./deps.DepsDef} deps\n   */\n  constructor(win, config, fetcher, deps) {\n    /** @private @const {!Window} */\n    this.win_ = win;\n\n    /** @private @const {!../model/page-config.PageConfig} */\n    this.config_ = config;\n\n    /** @private @const {string} */\n    this.publicationId_ = this.config_.getPublicationId();\n\n    /** @private @const {!./fetcher.Fetcher} */\n    this.fetcher_ = fetcher;\n\n    /** @private @const {!./deps.DepsDef} */\n    this.deps_ = deps;\n\n    /** @private @const {!JwtHelper} */\n    this.jwtHelper_ = new JwtHelper();\n\n    /** @private {?Promise<!Entitlements>} */\n    this.responsePromise_ = null;\n\n    /** @private {number} */\n    this.positiveRetries_ = 0;\n\n    /** @private {boolean} */\n    this.blockNextNotification_ = false;\n\n    /** @private @const {!./storage.Storage} */\n    this.storage_ = deps.storage();\n  }\n\n  /**\n   * @param {boolean=} opt_expectPositive\n   */\n  reset(opt_expectPositive) {\n    this.responsePromise_ = null;\n    this.positiveRetries_ = Math.max(\n        this.positiveRetries_, opt_expectPositive ? 3 : 0);\n  }\n\n  /**\n   * @return {!Promise<!Entitlements>}\n   */\n  getEntitlements() {\n    if (!this.responsePromise_) {\n      this.responsePromise_ = this.getEntitlementsFlow_();\n    }\n    return this.responsePromise_;\n  }\n\n  /**\n   * @return {!Promise<!Entitlements>}\n   */\n  fetchEntitlements() {\n    // TODO(dvoytenko): Replace retries with consistent fetch.\n    let positiveRetries = this.positiveRetries_;\n    this.positiveRetries_ = 0;\n    const attempt = () => {\n      positiveRetries--;\n      return this.fetch_().then(entitlements => {\n        if (entitlements.enablesThis() || positiveRetries <= 0) {\n          return entitlements;\n        }\n        return new Promise(resolve => {\n          this.win_.setTimeout(() => {\n            resolve(attempt());\n          }, 550);\n        });\n      });\n    };\n    return attempt();\n  }\n\n  /**\n   * @param {boolean} value\n   */\n  setToastShown(value) {\n    this.storage_.set(TOAST_STORAGE_KEY, value ? '1' : '0');\n  }\n\n  /**\n   */\n  blockNextNotification() {\n    this.blockNextNotification_ = true;\n  }\n\n  /**\n   */\n  unblockNextNotification() {\n    this.blockNextNotification_ = false;\n  }\n\n  /**\n   * The JSON must either contain a \"signedEntitlements\" with JWT, or\n   * \"entitlements\" field with plain JSON object.\n   * @param {!Object} json\n   * @return {!Entitlements}\n   */\n  parseEntitlements(json) {\n    const ackHandler = this.ack_.bind(this);\n    const signedData = json['signedEntitlements'];\n    if (signedData) {\n      const jwt = this.jwtHelper_.decode(signedData);\n      const entitlementsClaim = jwt['entitlements'];\n      if (entitlementsClaim) {\n        return new Entitlements(\n            SERVICE_ID,\n            signedData,\n            Entitlement.parseListFromJson(entitlementsClaim),\n            this.config_.getProductId(),\n            ackHandler);\n      }\n    } else {\n      const plainEntitlements = json['entitlements'];\n      if (plainEntitlements) {\n        return new Entitlements(\n            SERVICE_ID,\n            '',\n            Entitlement.parseListFromJson(plainEntitlements),\n            this.config_.getProductId(),\n            ackHandler);\n      }\n    }\n    // Empty response.\n    return new Entitlements(\n        SERVICE_ID,\n        '',\n        [],\n        this.config_.getProductId(),\n        ackHandler);\n  }\n\n  /**\n   * @return {!Promise<!Entitlements>}\n   */\n  getEntitlementsFlow_() {\n    return this.fetchEntitlements().then(entitlements => {\n      this.onEntitlementsFetched_(entitlements);\n      return entitlements;\n    });\n  }\n\n  /**\n   * @param {!Entitlements} entitlements\n   * @private\n   */\n  onEntitlementsFetched_(entitlements) {\n    // Skip any notifications and toast if other flows are ongoing.\n    // TODO(dvoytenko): what's the right action when pay flow was canceled?\n    const blockNotification = this.blockNextNotification_;\n    this.blockNextNotification_ = false;\n    if (blockNotification) {\n      return;\n    }\n\n    // Notify on the received entitlements.\n    this.deps_.callbacks().triggerEntitlementsResponse(\n        Promise.resolve(entitlements));\n\n    // Show a toast if needed.\n    this.maybeShowToast_(entitlements);\n  }\n\n  /**\n   * @param {!Entitlements} entitlements\n   * @return {!Promise}\n   * @private\n   */\n  maybeShowToast_(entitlements) {\n    const entitlement = entitlements.getEntitlementForThis();\n    if (!entitlement) {\n      return Promise.resolve();\n    }\n    // Check if storage bit is set. It's only set by the `Entitlements.ack`\n    // method.\n    return this.storage_.get(TOAST_STORAGE_KEY).then(value => {\n      if (value == '1') {\n        // Already shown;\n        return;\n      }\n      if (entitlement) {\n        this.showToast_(entitlement);\n      }\n    });\n  }\n\n  /**\n   * @param {!Entitlement} entitlement\n   * @private\n   */\n  showToast_(entitlement) {\n    const source = entitlement.source || 'google';\n    return new Toast(this.deps_, feUrl('/toastiframe'), feArgs({\n      'publicationId': this.publicationId_,\n      'source': source,\n    })).open();\n  }\n\n  /**\n   * @param {!Entitlements} entitlements\n   * @private\n   */\n  ack_(entitlements) {\n    if (entitlements.getEntitlementForThis()) {\n      this.setToastShown(true);\n    }\n  }\n\n  /**\n   * @return {!Promise<!Entitlements>}\n   * @private\n   */\n  fetch_() {\n    const url = serviceUrl(\n        '/publication/' +\n        encodeURIComponent(this.publicationId_) +\n        '/entitlements');\n    return this.fetcher_.fetchCredentialedJson(url)\n        .then(json => this.parseEntitlements(json));\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Xhr} from '../utils/xhr';\n\n\n/**\n * @interface\n */\nexport class Fetcher {\n\n  /**\n   * @param {string} unusedUrl\n   * @return {!Promise<!Object>}\n   */\n  fetchCredentialedJson(unusedUrl) {}\n}\n\n\n/**\n * @implements {Fetcher}\n */\nexport class XhrFetcher {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @const {!Xhr} */\n    this.xhr_ = new Xhr(win);\n  }\n\n  /** @override */\n  fetchCredentialedJson(url) {\n    const init = /** @type {!../utils/xhr.FetchInitDef} */ ({\n      method: 'GET',\n      headers: {'Accept': 'text/plain, application/json'},\n      credentials: 'include',\n    });\n    return this.xhr_.fetch(url, init).then(response => response.json());\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {ActivityIframeView} from '../ui/activity-iframe-view';\nimport {SubscriptionFlows} from '../api/subscriptions';\nimport {acceptPortResultData} from '../utils/activity-utils';\nimport {feArgs, feOrigin, feUrl} from './services';\nimport {isCancelError} from '../utils/errors';\n\nconst LINK_REQUEST_ID = 'swg-link';\n\n\n/**\n * The flow to initiate linkback flow.\n */\nexport class LinkbackFlow {\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   */\n  constructor(deps) {\n    /** @private @const {!./deps.DepsDef} */\n    this.deps_ = deps;\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {!../model/page-config.PageConfig} */\n    this.pageConfig_ = deps.pageConfig();\n\n    /** @private @const {!../components/dialog-manager.DialogManager} */\n    this.dialogManager_ = deps.dialogManager();\n  }\n\n  /**\n   * Starts the Link account flow.\n   * @return {!Promise}\n   */\n  start() {\n    this.deps_.callbacks().triggerFlowStarted(SubscriptionFlows.LINK_ACCOUNT);\n    const opener = this.activityPorts_.open(\n        LINK_REQUEST_ID,\n        feUrl('/linkbackstart'),\n        '_blank',\n        feArgs({\n          'publicationId': this.pageConfig_.getPublicationId(),\n        }), {});\n    this.dialogManager_.popupOpened(opener && opener.targetWin);\n    return Promise.resolve();\n  }\n}\n\n\n/**\n * The class for Link accounts flow.\n */\nexport class LinkCompleteFlow {\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   */\n  static configurePending(deps) {\n    function handler(port) {\n      deps.entitlementsManager().blockNextNotification();\n      deps.callbacks().triggerLinkProgress();\n      deps.dialogManager().popupClosed();\n      const promise = acceptPortResultData(\n          port,\n          feOrigin(),\n          /* requireOriginVerified */ false,\n          /* requireSecureChannel */ false);\n      return promise.then(response => {\n        const flow = new LinkCompleteFlow(deps, response);\n        flow.start();\n      }, reason => {\n        if (isCancelError(reason)) {\n          deps.callbacks().triggerFlowCanceled(SubscriptionFlows.LINK_ACCOUNT);\n        }\n      });\n    };\n    deps.activities().onResult(LINK_REQUEST_ID, handler);\n  }\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   * @param {?Object} response\n   */\n  constructor(deps, response) {\n    /** @private @const {!Window} */\n    this.win_ = deps.win();\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {!../components/dialog-manager.DialogManager} */\n    this.dialogManager_ = deps.dialogManager();\n\n    /** @private @const {!./entitlements-manager.EntitlementsManager} */\n    this.entitlementsManager_ = deps.entitlementsManager();\n\n    /** @private @const {!./callbacks.Callbacks} */\n    this.callbacks_ = deps.callbacks();\n\n    const index = response && response['index'] || '0';\n    /** @private @const {!ActivityIframeView} */\n    this.activityIframeView_ =\n        new ActivityIframeView(\n            this.win_,\n            this.activityPorts_,\n            feUrl('/linkconfirmiframe', '/u/' + index),\n            feArgs({\n              'productId': deps.pageConfig().getProductId(),\n              'publicationId': deps.pageConfig().getPublicationId(),\n            }),\n            /* shouldFadeBody */ true);\n\n    /** @private {?function()} */\n    this.completeResolver_ = null;\n\n    /** @private @const {!Promise} */\n    this.completePromise_ = new Promise(resolve => {\n      this.completeResolver_ = resolve;\n    });\n  }\n\n  /**\n   * Starts the Link account flow.\n   * @return {!Promise}\n   */\n  start() {\n    const promise = this.activityIframeView_.port().then(port => {\n      return acceptPortResultData(\n          port,\n          feOrigin(),\n          /* requireOriginVerified */ true,\n          /* requireSecureChannel */ true);\n    });\n    promise.then(response => {\n      this.complete_(response);\n    }).catch(reason => {\n      // Rethrow async.\n      setTimeout(() => {\n        throw reason;\n      });\n    }).then(() => {\n      // The flow is complete.\n      this.dialogManager_.completeView(this.activityIframeView_);\n    });\n    return this.dialogManager_.openView(this.activityIframeView_);\n  }\n\n  /**\n   * @param {?Object} response\n   * @private\n   */\n  complete_(response) {\n    this.callbacks_.triggerLinkComplete();\n    this.callbacks_.resetLinkProgress();\n    this.entitlementsManager_.setToastShown(true);\n    this.entitlementsManager_.unblockNextNotification();\n    this.entitlementsManager_.reset(response && response['success'] || false);\n    this.completeResolver_();\n  }\n\n  /** @return {!Promise} */\n  whenComplete() {\n    return this.completePromise_;\n  }\n}\n\n/**\n * The flow to save subscription information.\n */\nexport class LinkSaveFlow {\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   * @param {!../api/subscriptions.SaveSubscriptionRequest} saveSubscriptionRequest\n   */\n  constructor(deps, saveSubscriptionRequest) {\n    /** @private @const {!Window} */\n    this.win_ = deps.win();\n\n    /** @private @const {!./deps.DepsDef} */\n    this.deps_ = deps;\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {!../components/dialog-manager.DialogManager} */\n    this.dialogManager_ = deps.dialogManager();\n\n    /** TODO(sohanirao): Default request only for test */\n    /** @type {!../api/subscriptions.SaveSubscriptionRequest} */\n    const defaultRequest = {token: 'test'};\n\n    /** @private {!../api/subscriptions.SaveSubscriptionRequest} */\n    this.saveSubscriptionRequest_ = saveSubscriptionRequest || defaultRequest;\n\n    /** @private {?ActivityIframeView} */\n    this.activityIframeView_ = null;\n  }\n\n  /**\n   * Starts the save subscription\n   * @return {!Promise}\n   */\n  start() {\n    this.activityIframeView_ = new ActivityIframeView(\n      this.win_,\n      this.activityPorts_,\n      feUrl('/linksaveiframe'),\n      feArgs({\n        'publicationId': this.deps_.pageConfig().getPublicationId(),\n        'token': this.saveSubscriptionRequest_['token'],\n        'isClosable': true,\n      }),\n      /* shouldFadeBody */ false\n    );\n    /** {!Promise<boolean>} */\n    return this.dialogManager_.openView(this.activityIframeView_).then(() => {\n      return this.activityIframeView_.port().then(port => {\n        return acceptPortResultData(\n            port,\n            feOrigin(),\n            /* requireOriginVerified */ true,\n            /* requireSecureChannel */ true);\n      }).then(result => {\n        return result['linked'];\n      }).catch(() => {\n        return false;\n      }).then(result => {\n        // The flow is complete.\n        this.dialogManager_.completeView(this.activityIframeView_);\n        return result;\n      });\n    });\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {serviceUrl} from './services';\n\n\nexport class OffersApi {\n\n  /**\n   * @param {!../model/page-config.PageConfig} config\n   * @param {!./fetcher.Fetcher} fetcher\n   */\n  constructor(config, fetcher) {\n    /** @private @const {!../model/page-config.PageConfig} */\n    this.config_ = config;\n\n    /** @private @const {!./fetcher.Fetcher} */\n    this.fetcher_ = fetcher;\n  }\n\n  /**\n   * @param {string=} opt_productId\n   * @return {!Promise<!Array<!../api/offer.Offer>>}\n   */\n  getOffers(opt_productId) {\n    const productId = opt_productId || this.config_.getProductId();\n    if (!productId) {\n      throw new Error('getOffers requires productId in config or arguments');\n    }\n    return this.fetch_(productId);\n  }\n\n  /**\n   * @param {string} productId\n   * @return {!Promise<!Array<!../api/offer.Offer>>}\n   * @private\n   */\n  fetch_(productId) {\n    const url = serviceUrl(\n        '/publication/' +\n        encodeURIComponent(this.config_.getPublicationId()) +\n        '/offers' +\n        '?label=' + encodeURIComponent(productId));\n    // TODO(dvoytenko): switch to a non-credentialed request after launch.\n    return this.fetcher_.fetchCredentialedJson(url).then(json => {\n      return json['offers'] || [];\n    });\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {ActivityIframeView} from '../ui/activity-iframe-view';\nimport {PayStartFlow} from './pay-flow';\nimport {SubscriptionFlows} from '../api/subscriptions';\nimport {feArgs, feUrl} from './services';\n\n/**\n * Offers view is closable when request was originated from 'AbbrvOfferFlow'\n * or from 'SubscribeOptionFlow'.\n */\nconst OFFERS_VIEW_CLOSABLE = true;\n\n/**\n * The class for Offers flow.\n */\nexport class OffersFlow {\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   * @param {!../api/subscriptions.OffersRequest|undefined} options\n   */\n  constructor(deps, options) {\n    /** @private @const {!./deps.DepsDef} */\n    this.deps_ = deps;\n\n    /** @private @const {!Window} */\n    this.win_ = deps.win();\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {!../components/dialog-manager.DialogManager} */\n    this.dialogManager_ = deps.dialogManager();\n\n    let isClosable = options && options.isClosable;\n    if (isClosable == undefined) {\n      isClosable = false;  // Default is to hide Close button.\n    }\n\n    /** @private @const {!ActivityIframeView} */\n    this.activityIframeView_ = new ActivityIframeView(\n        this.win_,\n        this.activityPorts_,\n        feUrl('/offersiframe'),\n        feArgs({\n          'productId': deps.pageConfig().getProductId(),\n          'publicationId': deps.pageConfig().getPublicationId(),\n          'showNative': deps.callbacks().hasSubscribeRequestCallback(),\n          'list': options && options.list || 'default',\n          'skus': options && options.skus || null,\n          'isClosable': isClosable,\n        }),\n        /* shouldFadeBody */ true);\n  }\n\n  /**\n   * Starts the offers flow or alreadySubscribed flow.\n   * @return {!Promise}\n   */\n  start() {\n    // Start/cancel events.\n    this.deps_.callbacks().triggerFlowStarted(\n        SubscriptionFlows.SHOW_OFFERS);\n    this.activityIframeView_.onCancel(() => {\n      this.deps_.callbacks().triggerFlowCanceled(\n          SubscriptionFlows.SHOW_OFFERS);\n    });\n\n    // If result is due to OfferSelection, redirect to payments.\n    this.activityIframeView_.onMessage(result => {\n      if (result['alreadySubscribed']) {\n        this.deps_.callbacks().triggerLoginRequest({\n          linkRequested: !!result['linkRequested'],\n        });\n        return;\n      }\n      if (result['sku']) {\n        new PayStartFlow(\n            this.deps_,\n            /** @type {string} */ (result['sku']))\n            .start();\n        return;\n      }\n      if (result['native']) {\n        this.deps_.callbacks().triggerSubscribeRequest();\n        return;\n      }\n    });\n\n    return this.dialogManager_.openView(this.activityIframeView_);\n  }\n}\n\n\n/**\n * The class for subscribe option flow.\n */\nexport class SubscribeOptionFlow {\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   * @param {!../api/subscriptions.OffersRequest|undefined} options\n   */\n  constructor(deps, options) {\n\n    /** @private @const {!./deps.DepsDef} */\n    this.deps_ = deps;\n\n    /** @private @const {!../api/subscriptions.OffersRequest|undefined} */\n    this.options_ = options;\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {!../components/dialog-manager.DialogManager} */\n    this.dialogManager_ = deps.dialogManager();\n\n    /** @private @const {!ActivityIframeView} */\n    this.activityIframeView_ = new ActivityIframeView(\n        deps.win(),\n        this.activityPorts_,\n        feUrl('/optionsiframe'),\n        feArgs({\n          'publicationId': deps.pageConfig().getPublicationId(),\n          'productId': deps.pageConfig().getProductId(),\n          'list': options && options.list || 'default',\n          'skus': options && options.skus || null,\n          'isClosable': true,\n        }),\n        /* shouldFadeBody */ false);\n  }\n\n  /**\n   * Starts the offers flow or alreadySubscribed flow.\n   * @return {!Promise}\n   */\n  start() {\n    // Start/cancel events.\n    this.deps_.callbacks().triggerFlowStarted(\n        SubscriptionFlows.SHOW_SUBSCRIBE_OPTION);\n    this.activityIframeView_.onCancel(() => {\n      this.deps_.callbacks().triggerFlowCanceled(\n          SubscriptionFlows.SHOW_SUBSCRIBE_OPTION);\n    });\n\n    this.activityIframeView_.onMessage(data => {\n      this.maybeOpenOffersFlow_(data);\n    });\n    this.activityIframeView_.acceptResult().then(result => {\n      this.maybeOpenOffersFlow_(result.data);\n    }, reason => {\n      this.dialogManager_.completeView(this.activityIframeView_);\n      throw reason;\n    });\n    return this.dialogManager_.openView(this.activityIframeView_);\n  }\n\n  /**\n   * @param {*} data\n   * @private\n   */\n  maybeOpenOffersFlow_(data) {\n    if (data && data['subscribe']) {\n      const options = this.options_ || {};\n      if (options.isClosable == undefined) {\n        options.isClosable = OFFERS_VIEW_CLOSABLE;\n      }\n      new OffersFlow(this.deps_, options).start();\n    }\n  }\n}\n\n\n/**\n * The class for Abbreviated Offer flow.\n *\n */\nexport class AbbrvOfferFlow {\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   * @param {!../api/subscriptions.OffersRequest=} options\n   */\n  constructor(deps, options = {}) {\n\n    /** @private @const {!./deps.DepsDef} */\n    this.deps_ = deps;\n\n    /** @private @const {!../api/subscriptions.OffersRequest|undefined} */\n    this.options_ = options;\n\n    /** @private @const {!Window} */\n    this.win_ = deps.win();\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {!../components/dialog-manager.DialogManager} */\n    this.dialogManager_ = deps.dialogManager();\n\n    /** @private @const {!ActivityIframeView} */\n    this.activityIframeView_ = new ActivityIframeView(\n        this.win_,\n        this.activityPorts_,\n        feUrl('/abbrvofferiframe'),\n        feArgs({\n          'publicationId': deps.pageConfig().getPublicationId(),\n          'productId': deps.pageConfig().getProductId(),\n          'showNative': deps.callbacks().hasSubscribeRequestCallback(),\n          'list': options && options.list || 'default',\n          'skus': options && options.skus || null,\n          'isClosable': true,\n        }),\n        /* shouldFadeBody */ false);\n  }\n\n  /**\n   * Starts the offers flow\n   * @return {!Promise}\n   */\n  start() {\n    // Start/cancel events.\n    this.deps_.callbacks().triggerFlowStarted(\n        SubscriptionFlows.SHOW_ABBRV_OFFER);\n    this.activityIframeView_.onCancel(() => {\n      this.deps_.callbacks().triggerFlowCanceled(\n          SubscriptionFlows.SHOW_ABBRV_OFFER);\n    });\n\n    // If the user is already subscribed, trigger login flow\n    this.activityIframeView_.onMessage(data => {\n      if (data['alreadySubscribed']) {\n        this.deps_.callbacks().triggerLoginRequest({\n          linkRequested: !!data['linkRequested'],\n        });\n        return;\n      }\n    });\n    // If result is due to requesting offers, redirect to offers flow\n    this.activityIframeView_.acceptResult().then(result => {\n      if (result.data['viewOffers']) {\n        const options = this.options_ || {};\n        if (options.isClosable == undefined) {\n          options.isClosable = OFFERS_VIEW_CLOSABLE;\n        }\n        new OffersFlow(this.deps_, options).start();\n        return;\n      }\n      if (result.data['native']) {\n        this.deps_.callbacks().triggerSubscribeRequest();\n        // The flow is complete.\n        this.dialogManager_.completeView(this.activityIframeView_);\n        return;\n      }\n    });\n\n    return this.dialogManager_.openView(this.activityIframeView_);\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {ActivityIframeView} from '../ui/activity-iframe-view';\nimport {JwtHelper} from '../utils/jwt';\nimport {\n  PurchaseData,\n  SubscribeResponse,\n} from '../api/subscribe-response';\nimport {SubscriptionFlows} from '../api/subscriptions';\nimport {UserData} from '../api/user-data';\nimport {Xhr} from '../utils/xhr';\nimport {feArgs, feCached, feUrl} from './services';\nimport {isCancelError} from '../utils/errors';\nimport {parseJson} from '../utils/json';\n\nconst PAY_REQUEST_ID = 'swg-pay';\n\n/**\n * @const {!Object<string, string>}\n * @package Visible for testing only.\n */\nexport const PAY_ORIGIN = {\n  'PRODUCTION': 'https://pay.google.com',\n  'SANDBOX': 'https://pay.sandbox.google.com',\n};\n\n\n/** @return {string} */\nfunction payOrigin() {\n  return PAY_ORIGIN['$payEnvironment$'];\n}\n\n/** @return {string} */\nfunction payUrl() {\n  return feCached(PAY_ORIGIN['$payEnvironment$'] + '/gp/p/ui/pay');\n}\n\n/** @return {string} */\nfunction payDecryptUrl() {\n  return PAY_ORIGIN['$payEnvironment$'] + '/gp/p/apis/buyflow/process';\n}\n\n\n/**\n * The flow to initiate payment process.\n */\nexport class PayStartFlow {\n\n  /**\n   * @param {!../utils/preconnect.Preconnect} pre\n   */\n  static preconnect(pre) {\n    pre.prefetch(payUrl());\n  }\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   * @param {string} sku\n   */\n  constructor(deps, sku) {\n    /** @private @const {!./deps.DepsDef} */\n    this.deps_ = deps;\n\n    /** @private @const {!Window} */\n    this.win_ = deps.win();\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {!../model/page-config.PageConfig} */\n    this.pageConfig_ = deps.pageConfig();\n\n    /** @private @const {!../components/dialog-manager.DialogManager} */\n    this.dialogManager_ = deps.dialogManager();\n\n    /** @private @const {string} */\n    this.sku_ = sku;\n  }\n\n  /**\n   * Starts the payments flow.\n   * @return {!Promise}\n   */\n  start() {\n    // Start/cancel events.\n    this.deps_.callbacks().triggerFlowStarted(SubscriptionFlows.SUBSCRIBE, {\n      'sku': this.sku_,\n    });\n\n    // TODO(dvoytenko): switch to gpay async client.\n    const opener = this.activityPorts_.open(\n        PAY_REQUEST_ID,\n        payUrl(),\n        '_blank',\n        feArgs({\n          'apiVersion': 1,\n          'allowedPaymentMethods': ['CARD'],\n          'environment': '$payEnvironment$',\n          'playEnvironment': '$playEnvironment$',\n          'swg': {\n            'publicationId': this.pageConfig_.getPublicationId(),\n            'skuId': this.sku_,\n          },\n        }), {});\n    this.dialogManager_.popupOpened(opener && opener.targetWin);\n    return Promise.resolve();\n  }\n}\n\n\n/**\n * The flow for successful payments completion.\n */\nexport class PayCompleteFlow {\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   */\n  static configurePending(deps) {\n    deps.activities().onResult(PAY_REQUEST_ID, port => {\n      deps.dialogManager().popupClosed();\n      deps.entitlementsManager().blockNextNotification();\n      const flow = new PayCompleteFlow(deps);\n      const promise = validatePayResponse(\n          deps.win(), port, flow.complete.bind(flow));\n      deps.callbacks().triggerSubscribeResponse(promise);\n      return promise.then(response => {\n        flow.start(response);\n      }, reason => {\n        if (isCancelError(reason)) {\n          deps.callbacks().triggerFlowCanceled(SubscriptionFlows.SUBSCRIBE);\n        }\n        throw reason;\n      });\n    });\n  }\n\n  /**\n   * @param {!./deps.DepsDef} deps\n   */\n  constructor(deps) {\n    /** @private @const {!Window} */\n    this.win_ = deps.win();\n\n    /** @private @const {!./deps.DepsDef} */\n    this.deps_ = deps;\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {!../components/dialog-manager.DialogManager} */\n    this.dialogManager_ = deps.dialogManager();\n\n    /** @private @const {!../runtime/callbacks.Callbacks} */\n    this.callbacks_ = deps.callbacks();\n\n    /** @private {?ActivityIframeView} */\n    this.activityIframeView_ = null;\n\n    /** @private {?SubscribeResponse} */\n    this.response_ = null;\n\n    /** @private {?Promise} */\n    this.readyPromise_ = null;\n  }\n\n  /**\n   * Starts the payments completion flow.\n   * @param {!SubscribeResponse} response\n   * @return {!Promise}\n   */\n  start(response) {\n    this.deps_.entitlementsManager().reset(true);\n    this.response_ = response;\n    this.activityIframeView_ = new ActivityIframeView(\n        this.win_,\n        this.activityPorts_,\n        feUrl('/payconfirmiframe'),\n        feArgs({\n          'publicationId': this.deps_.pageConfig().getPublicationId(),\n          'loginHint': response.userData && response.userData.email,\n        }),\n        /* shouldFadeBody */ true);\n    this.activityIframeView_.acceptResult().then(() => {\n      // The flow is complete.\n      this.dialogManager_.completeView(this.activityIframeView_);\n    });\n    this.readyPromise_ = this.dialogManager_.openView(this.activityIframeView_);\n    return this.readyPromise_;\n  }\n\n  /**\n   * @return {!Promise}\n   */\n  complete() {\n    this.deps_.entitlementsManager().unblockNextNotification();\n    this.readyPromise_.then(() => {\n      this.activityIframeView_.message({'complete': true});\n    });\n    return this.activityIframeView_.acceptResult().catch(() => {\n      // Ignore errors.\n    }).then(() => {\n      this.deps_.entitlementsManager().setToastShown(true);\n    });\n  }\n}\n\n\n/**\n  *@param {!Window} win\n * @param {!web-activities/activity-ports.ActivityPort} port\n * @param {function():!Promise} completeHandler\n * @return {!Promise<!SubscribeResponse>}\n * @package Visible for testing only.\n */\nexport function validatePayResponse(win, port, completeHandler) {\n  // Do not require security immediately: it will be checked below.\n  return port.acceptResult().then(result => {\n    if (result.origin != payOrigin()) {\n      throw new Error('channel mismatch');\n    }\n    const data = /** @type {!Object} */ (result.data);\n    if (data['redirectEncryptedCallbackData']) {\n      // Data is supplied as an encrypted blob.\n      const xhr = new Xhr(win);\n      const url = payDecryptUrl();\n      const init = /** @type {!../utils/xhr.FetchInitDef} */ ({\n        method: 'post',\n        headers: {'Accept': 'text/plain, application/json'},\n        credentials: 'include',\n        body: data['redirectEncryptedCallbackData'],\n        mode: 'cors',\n      });\n      return xhr.fetch(url, init).then(response => response.json());\n    }\n    // Data is supplied directly: must be a verified and secure channel.\n    if (result.originVerified && result.secureChannel) {\n      return data;\n    }\n    throw new Error('channel mismatch');\n  }).then(data => parseSubscriptionResponse(data, completeHandler));\n}\n\n\n/**\n * @param {*} data\n * @param {function():!Promise} completeHandler\n * @return {!SubscribeResponse}\n */\nexport function parseSubscriptionResponse(data, completeHandler) {\n  let swgData = null;\n  let raw = null;\n  if (data) {\n    if (typeof data == 'string') {\n      raw = /** @type {string} */ (data);\n    } else {\n      // Assume it's a json object in the format:\n      // `{integratorClientCallbackData: \"...\"}` or `{swgCallbackData: \"...\"}`.\n      const json = /** @type {!Object} */ (data);\n      if ('swgCallbackData' in json) {\n        swgData = /** @type {!Object} */ (json['swgCallbackData']);\n      } else if ('integratorClientCallbackData' in json) {\n        raw = json['integratorClientCallbackData'];\n      }\n    }\n  }\n  if (raw && !swgData) {\n    raw = atob(raw);\n    if (raw) {\n      const parsed = parseJson(raw);\n      swgData = parsed['swgCallbackData'];\n    }\n  }\n  if (!swgData) {\n    throw new Error('unexpected payment response');\n  }\n  raw = JSON.stringify(/** @type {!JsonObject} */ (swgData));\n  return new SubscribeResponse(\n      raw,\n      parsePurchaseData(swgData),\n      parseUserData(swgData),\n      completeHandler);\n}\n\n\n/**\n * @param {!Object} swgData\n * @return {!PurchaseData}\n */\nfunction parsePurchaseData(swgData) {\n  const raw = swgData['purchaseData'];\n  const signature = swgData['purchaseDataSignature'];\n  return new PurchaseData(raw, signature);\n}\n\n\n/**\n * @param {!Object} swgData\n * @return {?UserData}\n * @package Visible for testing.\n */\nexport function parseUserData(swgData) {\n  const idToken = swgData['idToken'];\n  if (!idToken) {\n    return null;\n  }\n  const jwt = /** @type {!Object} */ (new JwtHelper().decode(idToken));\n  return new UserData(idToken, jwt);\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {ActivityPorts} from 'web-activities/activity-ports';\nimport {ButtonApi} from './button-api';\nimport {CSS as SWG_DIALOG} from '../../build/css/components/dialog.css';\nimport {Callbacks} from './callbacks';\nimport {DeferredAccountFlow} from './deferred-account-flow';\nimport {DepsDef} from './deps';\nimport {DialogManager} from '../components/dialog-manager';\nimport {Doc, resolveDoc} from '../model/doc';\nimport {EntitlementsManager} from './entitlements-manager';\nimport {Fetcher, XhrFetcher} from './fetcher';\nimport {\n  LinkCompleteFlow,\n  LinkbackFlow,\n  LinkSaveFlow,\n} from './link-accounts-flow';\nimport {OffersApi} from './offers-api';\nimport {\n  OffersFlow,\n  SubscribeOptionFlow,\n  AbbrvOfferFlow,\n} from './offers-flow';\nimport {PageConfig} from '../model/page-config';\nimport {\n  PageConfigResolver,\n  getControlFlag,\n} from '../model/page-config-resolver';\nimport {\n  PayStartFlow,\n  PayCompleteFlow,\n} from './pay-flow';\nimport {Preconnect} from '../utils/preconnect';\nimport {Storage} from './storage';\nimport {Subscriptions} from '../api/subscriptions';\nimport {injectStyleSheet} from '../utils/dom';\nimport {isArray} from '../utils/types';\n\nconst RUNTIME_PROP = 'SWG';\nconst RUNTIME_LEGACY_PROP = 'SUBSCRIPTIONS';  // MIGRATE\n\n\n/** @private {Runtime} */\nlet runtimeInstance_;\n\n\n/**\n * Returns runtime for testing if available. Throws if the runtime is not\n * initialized yet.\n * @visibleForTesting\n * @return {!Runtime}\n */\nexport function getRuntime() {\n  if (!runtimeInstance_) {\n    throw new Error('not initialized yet');\n  }\n  return runtimeInstance_;\n}\n\n\n/**\n * @param {!Window} win\n */\nexport function installRuntime(win) {\n  if (win[RUNTIME_PROP] && !isArray(win[RUNTIME_PROP])) {\n    return;\n  }\n\n  const runtime = new Runtime(win);\n\n  const waitingArray = [].concat(win[RUNTIME_PROP], win[RUNTIME_LEGACY_PROP]);\n\n  // Public runtime.\n  const publicRuntime = createPublicRuntime(runtime);\n\n  const dependencyInstaller = {};\n\n  /**\n   * @param {function(!Subscriptions)} callback\n   */\n  function pushDependency(callback) {\n    if (!callback) {\n      return;\n    }\n    runtime.whenReady().then(() => {\n      callback(publicRuntime);\n    });\n  }\n  Object.defineProperty(dependencyInstaller, 'push', {\n    get: () => pushDependency,\n    configurable: false,\n  });\n  win[RUNTIME_PROP] = dependencyInstaller;\n  win[RUNTIME_LEGACY_PROP] = dependencyInstaller;\n  if (waitingArray) {\n    waitingArray.forEach(pushDependency);\n  }\n  runtimeInstance_ = runtime;\n  runtime.startSubscriptionsFlowIfNeeded();\n}\n\n\n/**\n * @implements {Subscriptions}\n */\nexport class Runtime {\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @private @const {!Window} */\n    this.win_ = win;\n\n    /** @private @const {!Doc} */\n    this.doc_ = resolveDoc(win);\n\n    /** @private @const {!Promise} */\n    this.ready_ = Promise.resolve();\n\n    /** @private {?string} */\n    this.productOrPublicationId_ = null;\n\n    /** @private {boolean} */\n    this.committed_ = false;\n\n    /** @private {?function((!ConfiguredRuntime|!Promise))} */\n    this.configuredResolver_ = null;\n\n    /** @private @const {!Promise<!ConfiguredRuntime>} */\n    this.configuredPromise_ = new Promise(resolve => {\n      this.configuredResolver_ = resolve;\n    });\n\n    /** @private {?PageConfigResolver} */\n    this.pageConfigResolver_ = null;\n\n    /** @private @const {!ButtonApi} */\n    this.buttonApi_ = new ButtonApi(this.doc_);\n    this.buttonApi_.init();  // Injects swg-button stylesheet.\n  }\n\n  /**\n   * @return {!Promise}\n   */\n  whenReady() {\n    return this.ready_;\n  }\n\n  /**\n   * @param {boolean} commit\n   * @return {!Promise<!ConfiguredRuntime>}\n   * @private\n   */\n  configured_(commit) {\n    if (!this.committed_ && commit) {\n      this.committed_ = true;\n      /** @type {!Promise<!PageConfig>} */\n      let configPromise;\n      if (this.productOrPublicationId_) {\n        configPromise = Promise.resolve(new PageConfig(\n            this.productOrPublicationId_,\n            /* locked */ false));\n      } else {\n        this.pageConfigResolver_ = new PageConfigResolver(this.doc_);\n        configPromise = this.pageConfigResolver_.resolveConfig()\n            .then(config => {\n              this.pageConfigResolver_ = null;\n              return config;\n            });\n      }\n      configPromise.then(config => {\n        this.configuredResolver_(new ConfiguredRuntime(this.doc_, config));\n        this.configuredResolver_ = null;\n      }, reason => {\n        this.configuredResolver_(Promise.reject(reason));\n        this.configuredResolver_ = null;\n      });\n    } else if (commit && this.pageConfigResolver_) {\n      this.pageConfigResolver_.check();\n    }\n    return this.configuredPromise_;\n  }\n\n  /**\n   * Starts the subscription flow if it hasn't been started and the page is\n   * configured to start it automatically.\n   *\n   * @return {?Promise}\n   * @package\n   */\n  startSubscriptionsFlowIfNeeded() {\n    const control = getControlFlag(this.win_.document);\n    if (control == 'manual') {\n      // \"Skipping automatic start because control flag is set to \"manual\".\n      return null;\n    }\n    return this.start();\n  }\n\n  /** @override */\n  init(productOrPublicationId) {\n    if (this.committed_) {\n      throw new Error('already configured');\n    }\n    this.productOrPublicationId_ = productOrPublicationId;\n  }\n\n  /** @override */\n  start() {\n    return this.configured_(true)\n        .then(runtime => runtime.start());\n  }\n\n  /** @override */\n  reset() {\n    return this.configured_(true)\n        .then(runtime => runtime.reset());\n  }\n\n  /** @override */\n  getEntitlements() {\n    return this.configured_(true)\n        .then(runtime => runtime.getEntitlements());\n  }\n\n  /** @override */\n  setOnEntitlementsResponse(callback) {\n    return this.configured_(false)\n        .then(runtime => runtime.setOnEntitlementsResponse(callback));\n  }\n\n  /** @override */\n  getOffers(opt_options) {\n    return this.configured_(true)\n        .then(runtime => runtime.getOffers(opt_options));\n  }\n\n  /** @override */\n  showOffers(opt_options) {\n    return this.configured_(true)\n        .then(runtime => runtime.showOffers(opt_options));\n  }\n\n  /** @override */\n  showSubscribeOption(opt_options) {\n    return this.configured_(true)\n        .then(runtime => runtime.showSubscribeOption(opt_options));\n  }\n\n  /** @override */\n  showAbbrvOffer(opt_options) {\n    return this.configured_(true)\n        .then(runtime => runtime.showAbbrvOffer(opt_options));\n  }\n\n  /** @override */\n  setOnNativeSubscribeRequest(callback) {\n    return this.configured_(false)\n        .then(runtime => runtime.setOnNativeSubscribeRequest(callback));\n  }\n\n  /** @override */\n  setOnSubscribeResponse(callback) {\n    return this.configured_(false)\n        .then(runtime => runtime.setOnSubscribeResponse(callback));\n  }\n\n  /** @override */\n  subscribe(sku) {\n    return this.configured_(true)\n        .then(runtime => runtime.subscribe(sku));\n  }\n\n  /** @override */\n  completeDeferredAccountCreation(opt_options) {\n    return this.configured_(true)\n        .then(runtime => runtime.completeDeferredAccountCreation(opt_options));\n  }\n\n  /** @override */\n  setOnLoginRequest(callback) {\n    return this.configured_(false)\n        .then(runtime => runtime.setOnLoginRequest(callback));\n  }\n\n  /** @override */\n  setOnLinkComplete(callback) {\n    return this.configured_(false)\n        .then(runtime => runtime.setOnLinkComplete(callback));\n  }\n\n  /** @override */\n  linkAccount() {\n    return this.configured_(true)\n        .then(runtime => runtime.linkAccount());\n  }\n\n  /** @override */\n  setOnFlowStarted(callback) {\n    return this.configured_(false)\n        .then(runtime => runtime.setOnFlowStarted(callback));\n  }\n\n  /** @override */\n  setOnFlowCanceled(callback) {\n    return this.configured_(false)\n        .then(runtime => runtime.setOnFlowCanceled(callback));\n  }\n\n  /** @override */\n  saveSubscription(saveSubscriptionRequest) {\n    return this.configured_(true)\n        .then(runtime => {\n          runtime.saveSubscription(saveSubscriptionRequest);\n        });\n  }\n\n  /** @override */\n  createButton(optionsOrCallback, opt_callback) {\n    return this.buttonApi_.create(optionsOrCallback, opt_callback);\n  }\n\n  /** @override */\n  attachButton(button, optionsOrCallback, opt_callback) {\n    return this.buttonApi_.attach(button, optionsOrCallback, opt_callback);\n  }\n}\n\n\n/**\n * @implements {DepsDef}\n * @implements {Subscriptions}\n */\nexport class ConfiguredRuntime {\n\n  /**\n   * @param {!Window|!Document|!Doc} winOrDoc\n   * @param {!../model/page-config.PageConfig} config\n   * @param {{\n   *     fetcher: (!Fetcher|undefined),\n   *   }=} opt_integr\n   */\n  constructor(winOrDoc, config, opt_integr) {\n    /** @private @const {!Doc} */\n    this.doc_ = resolveDoc(winOrDoc);\n\n    /** @private @const {!Window} */\n    this.win_ = this.doc_.getWin();\n\n    /** @private @const {!../model/page-config.PageConfig} */\n    this.config_ = config;\n\n    /** @private @const {!Promise} */\n    this.documentParsed_ = this.doc_.whenReady();\n\n    /** @private @const {!Fetcher} */\n    this.fetcher_ = opt_integr && opt_integr.fetcher ||\n        new XhrFetcher(this.win_);\n\n    /** @private @const {!Storage} */\n    this.storage_ = new Storage(this.win_);\n\n    /** @private @const {!DialogManager} */\n    this.dialogManager_ = new DialogManager(this.doc_);\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = new ActivityPorts(this.win_);\n\n    /** @private @const {!Callbacks} */\n    this.callbacks_ = new Callbacks();\n\n    /** @private @const {!EntitlementsManager} */\n    this.entitlementsManager_ =\n        new EntitlementsManager(this.win_, this.config_, this.fetcher_, this);\n\n    /** @private @const {!OffersApi} */\n    this.offersApi_ = new OffersApi(this.config_, this.fetcher_);\n\n    /** @private @const {!ButtonApi} */\n    this.buttonApi_ = new ButtonApi(this.doc_);\n\n    const preconnect = new Preconnect(this.win_.document);\n\n    LinkCompleteFlow.configurePending(this);\n    PayCompleteFlow.configurePending(this);\n    PayStartFlow.preconnect(preconnect);\n\n    injectStyleSheet(this.win_.document, SWG_DIALOG);\n    this.buttonApi_.init();  // Injects swg-button stylesheet.\n  }\n\n  /** @override */\n  doc() {\n    return this.doc_;\n  }\n\n  /** @override */\n  win() {\n    return this.win_;\n  }\n\n  /** @override */\n  pageConfig() {\n    return this.config_;\n  }\n\n  /** @override */\n  activities() {\n    return this.activityPorts_;\n  }\n\n  /** @override */\n  dialogManager() {\n    return this.dialogManager_;\n  }\n\n  /** @override */\n  entitlementsManager() {\n    return this.entitlementsManager_;\n  }\n\n  /** @override */\n  callbacks() {\n    return this.callbacks_;\n  }\n\n  /** @override */\n  storage() {\n    return this.storage_;\n  }\n\n  /** @override */\n  init() {\n    // Implemented by the `Runtime` class.\n  }\n\n  /** @override */\n  reset() {\n    this.entitlementsManager_.reset();\n    this.dialogManager_.completeAll();\n  }\n\n  /** @override */\n  start() {\n    // No need to run entitlements without a product or for an unlocked page.\n    if (!this.config_.getProductId() || !this.config_.isLocked()) {\n      return Promise.resolve();\n    }\n    this.getEntitlements();\n  }\n\n  /** @override */\n  getEntitlements() {\n    return this.entitlementsManager_.getEntitlements()\n        .then(entitlements => entitlements.clone());\n  }\n\n  /** @override */\n  setOnEntitlementsResponse(callback) {\n    this.callbacks_.setOnEntitlementsResponse(callback);\n  }\n\n  /** @override */\n  getOffers(opt_options) {\n    return this.offersApi_.getOffers(opt_options && opt_options.productId);\n  }\n\n  /** @override */\n  showOffers(opt_options) {\n    return this.documentParsed_.then(() => {\n      const flow = new OffersFlow(this, opt_options);\n      return flow.start();\n    });\n  }\n\n  /** @override */\n  showSubscribeOption(opt_options) {\n    return this.documentParsed_.then(() => {\n      const flow = new SubscribeOptionFlow(this, opt_options);\n      return flow.start();\n    });\n  }\n\n  /** @override */\n  showAbbrvOffer(opt_options) {\n    return this.documentParsed_.then(() => {\n      const flow = new AbbrvOfferFlow(this, opt_options);\n      return flow.start();\n    });\n  }\n\n  /** @override */\n  setOnLoginRequest(callback) {\n    this.callbacks_.setOnLoginRequest(callback);\n  }\n\n  /** @override */\n  setOnLinkComplete(callback) {\n    this.callbacks_.setOnLinkComplete(callback);\n  }\n\n  /** @override */\n  linkAccount() {\n    return this.documentParsed_.then(() => {\n      return new LinkbackFlow(this).start();\n    });\n  }\n\n  /** @override */\n  saveSubscription(saveSubscriptionRequest) {\n    return this.documentParsed_.then(() => {\n      return new LinkSaveFlow(this, saveSubscriptionRequest).start();\n    });\n  }\n\n  /** @override */\n  setOnNativeSubscribeRequest(callback) {\n    this.callbacks_.setOnSubscribeRequest(callback);\n  }\n\n  /** @override */\n  setOnSubscribeResponse(callback) {\n    this.callbacks_.setOnSubscribeResponse(callback);\n  }\n\n  /** @override */\n  subscribe(sku) {\n    return this.documentParsed_.then(() => {\n      return new PayStartFlow(this, sku).start();\n    });\n  }\n\n  /** @override */\n  completeDeferredAccountCreation(opt_options) {\n    return this.documentParsed_.then(() => {\n      return new DeferredAccountFlow(this, opt_options || null).start();\n    });\n  }\n\n  /** @override */\n  setOnFlowStarted(callback) {\n    this.callbacks_.setOnFlowStarted(callback);\n  }\n\n  /** @override */\n  setOnFlowCanceled(callback) {\n    this.callbacks_.setOnFlowCanceled(callback);\n  }\n\n  /** @override */\n  createButton(optionsOrCallback, opt_callback) {\n    // This is a minor duplication to allow this code to be sync.\n    return this.buttonApi_.create(optionsOrCallback, opt_callback);\n  }\n\n  /** @override */\n  attachButton(button, optionsOrCallback, opt_callback) {\n    // This is a minor duplication to allow this code to be sync.\n    this.buttonApi_.attach(button, optionsOrCallback, opt_callback);\n  }\n}\n\n/**\n * @param {!Runtime} runtime\n * @return {!Subscriptions}\n */\nfunction createPublicRuntime(runtime) {\n  return /** @type {!Subscriptions} */ ({\n    init: runtime.init.bind(runtime),\n    start: runtime.start.bind(runtime),\n    reset: runtime.reset.bind(runtime),\n    getEntitlements: runtime.getEntitlements.bind(runtime),\n    linkAccount: runtime.linkAccount.bind(runtime),\n    getOffers: runtime.getOffers.bind(runtime),\n    showOffers: runtime.showOffers.bind(runtime),\n    showAbbrvOffer: runtime.showAbbrvOffer.bind(runtime),\n    showSubscribeOption: runtime.showSubscribeOption.bind(runtime),\n    subscribe: runtime.subscribe.bind(runtime),\n    completeDeferredAccountCreation:\n        runtime.completeDeferredAccountCreation.bind(runtime),\n    setOnEntitlementsResponse: runtime.setOnEntitlementsResponse.bind(runtime),\n    setOnLoginRequest: runtime.setOnLoginRequest.bind(runtime),\n    setOnLinkComplete: runtime.setOnLinkComplete.bind(runtime),\n    setOnNativeSubscribeRequest:\n        runtime.setOnNativeSubscribeRequest.bind(runtime),\n    setOnSubscribeResponse: runtime.setOnSubscribeResponse.bind(runtime),\n    setOnFlowStarted: runtime.setOnFlowStarted.bind(runtime),\n    setOnFlowCanceled: runtime.setOnFlowCanceled.bind(runtime),\n    saveSubscription: runtime.saveSubscription.bind(runtime),\n    createButton: runtime.createButton.bind(runtime),\n    attachButton: runtime.attachButton.bind(runtime),\n  });\n}\n\n\n/**\n * @return {!Function}\n * @protected\n */\nexport function getSubscriptionsClassForTesting() {\n  return Subscriptions;\n}\n\n/**\n * @return {!Function}\n * @protected\n */\nexport function getFetcherClassForTesting() {\n  return Fetcher;\n}\n\n/** @package Visible for testing only. */\nexport function getDocClassForTesting() {\n  return Doc;\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {addQueryParam, parseUrl} from '../utils/url';\n\n/**\n * Have to put these in the map to avoid compiler optimization. Due to\n * optimization issues, this map only allows property-style keys. E.g. \"hr1\",\n * as opposed to \"1hr\".\n * @type {!Object<string, number>}\n * @package Visible for testing only.\n */\nexport const CACHE_KEYS = {\n  'nocache': 1,\n  'hr1': 3600000,  // 1hr = 1000 * 60 * 60\n  'hr12': 43200000,  // 12hr = 1000 * 60 * 60 * 12\n};\n\n\n/**\n * @return {string}\n */\nexport function feOrigin() {\n  return parseUrl('$frontend$').origin;\n}\n\n\n/**\n * @param {string} url Relative URL, e.g. \"/service1\".\n * @return {string} The complete URL.\n */\nexport function serviceUrl(url) {\n  return '$frontend$/swg/_/api/v1' + url;\n}\n\n\n/**\n * @param {string} url Relative URL, e.g. \"/offersiframe\".\n * @param {string=} prefix\n * @return {string} The complete URL.\n */\nexport function feUrl(url, prefix = '') {\n  return feCached('$frontend$' + prefix + '/swg/_/ui/v1' + url);\n}\n\n\n/**\n * @param {string} url FE URL.\n * @return {string} The complete URL including cache params.\n */\nexport function feCached(url) {\n  return addQueryParam(url, '_', cacheParam('$frontendCache$'));\n}\n\n\n/**\n * @param {!Object<string, ?>} args\n * @return {!Object<string, ?>}\n */\nexport function feArgs(args) {\n  return Object.assign(args, {\n    '_client': 'SwG $internalRuntimeVersion$',\n  });\n}\n\n\n/**\n * @param {string} cacheKey\n * @return {string}\n * @package Visible for testing only.\n */\nexport function cacheParam(cacheKey) {\n  let period = CACHE_KEYS[cacheKey];\n  if (period == null) {\n    period = 1;\n  }\n  if (period === 0) {\n    return '_';\n  }\n  const now = Date.now();\n  return String(period <= 1 ? now : Math.floor(now / period));\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst PREFIX = 'subscribe.google.com';\n\n\nexport class Storage {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @private @const {!Window} */\n    this.win_ = win;\n\n    /** @private @const {!Object<string, !Promise<?string>>} */\n    this.values_ = {};\n  }\n\n  /**\n   * @param {string} key\n   * @return {!Promise<?string>}\n   */\n  get(key) {\n    if (!this.values_[key]) {\n      this.values_[key] = new Promise(resolve => {\n        if (this.win_.sessionStorage) {\n          try {\n            resolve(this.win_.sessionStorage.getItem(storageKey(key)));\n          } catch (e) {\n            // Ignore error.\n            resolve(null);\n          }\n        } else {\n          resolve(null);\n        }\n      });\n    }\n    return this.values_[key];\n  }\n\n  /**\n   * @param {string} key\n   * @param {string} value\n   * @return {!Promise}\n   */\n  set(key, value) {\n    this.values_[key] = Promise.resolve(value);\n    return new Promise(resolve => {\n      if (this.win_.sessionStorage) {\n        try {\n          this.win_.sessionStorage.setItem(storageKey(key), value);\n        } catch (e) {\n          // Ignore error.\n        }\n      }\n      resolve();\n    });\n  }\n}\n\n\n/**\n * @param {string} key\n * @return {string}\n */\nfunction storageKey(key) {\n  return PREFIX + ':' + key;\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {View} from '../components/view';\nimport {createElement} from '../utils/dom';\nimport {isCancelError} from '../utils/errors';\n\n/** @const {!Object<string, string>} */\nconst iframeAttributes = {\n  'frameborder': '0',\n  'scrolling': 'no',\n};\n\n\n/**\n * Class to build and render Activity iframe view.\n */\nexport class ActivityIframeView extends View {\n\n  /**\n   * @param {!Window} win\n   * @param {!web-activities/activity-ports.ActivityPorts} activityPorts\n   * @param {string} src\n   * @param {!Object<string, ?>=} args\n   * @param {boolean=} shouldFadeBody\n   */\n  constructor(\n      win,\n      activityPorts,\n      src,\n      args,\n      shouldFadeBody = false) {\n    super();\n\n    /** @private @const {!Window} */\n    this.win_ = win;\n\n    /** @private @const {!Document} */\n    this.doc_ = this.win_.document;\n\n    /** @private @const {!HTMLIFrameElement} */\n    this.iframe_ =\n        /** @type {!HTMLIFrameElement} */ (\n            createElement(this.doc_, 'iframe', iframeAttributes));\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = activityPorts;\n\n    /** @private @const {string} */\n    this.src_ = src;\n\n    /** @private @const {!Object<string, ?>} */\n    this.args_ = args || {};\n\n    /** @private @const {boolean} */\n    this.shouldFadeBody_ = shouldFadeBody;\n\n    /** @private {?web-activities/activity-ports.ActivityIframePort} */\n    this.port_ = null;\n\n    /**\n     * @private\n     * {?function<!web-activities/activity-ports.ActivityIframePort|!Promise>}\n     */\n    this.portResolver_ = null;\n\n    /**\n     * @private @const\n     * {!Promise<!web-activities/activity-ports.ActivityIframePort>}\n     */\n    this.portPromise_ = new Promise(resolve => {\n      this.portResolver_ = resolve;\n    });\n  }\n\n  /** @override */\n  getElement() {\n    return this.iframe_;\n  }\n\n  /** @override */\n  init(dialog) {\n    return this.activityPorts_.openIframe(this.iframe_, this.src_, this.args_)\n        .then(port => this.onOpenIframeResponse_(port, dialog));\n  }\n\n  /**\n   * Returns if document should fade for this view.\n   * @return {boolean}\n   */\n  shouldFadeBody() {\n    return this.shouldFadeBody_;\n  }\n\n  /**\n   * @param {!web-activities/activity-ports.ActivityIframePort} port\n   * @param {!../components/dialog.Dialog} dialog\n   * @return {!Promise}\n   */\n  onOpenIframeResponse_(port, dialog) {\n    this.port_ = port;\n    this.portResolver_(port);\n\n    this.port_.onResizeRequest(height => {\n      dialog.resizeView(this, height);\n    });\n\n    return this.port_.whenReady();\n  }\n\n  /**\n   * @return {!Promise<!web-activities/activity-ports.ActivityIframePort>}\n   */\n  port() {\n    return this.portPromise_;\n  }\n\n  /**\n   * @param {!Object} data\n   */\n  message(data) {\n    this.port().then(port => {\n      port.message(data);\n    });\n  }\n\n  /**\n   * Handles the message received by the port.\n   * @param {function(!Object<string, string|boolean>)} callback\n   */\n  onMessage(callback) {\n    this.port().then(port => {\n      port.onMessage(callback);\n    });\n  }\n\n  /**\n   * Accepts results from the caller.\n   * @return {!Promise<!web-activities/activity-ports.ActivityResult>}\n   */\n  acceptResult() {\n    return this.port().then(port => port.acceptResult());\n  }\n\n  /**\n   * Completes the flow.\n   * @return {!Promise}\n   */\n  whenComplete() {\n    return this.acceptResult();\n  }\n\n  /**\n   * @param {function()} callback\n   */\n  onCancel(callback) {\n    this.acceptResult().catch(reason => {\n      if (isCancelError(reason)) {\n        callback();\n      }\n      throw reason;\n    });\n  }\n\n  /** @override */\n  resized() {\n    if (this.port_) {\n      this.port_.resized();\n    }\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {createElement} from '../utils/dom';\n\n\n/**\n * Loading indicator class. Builds the loading indicator view to be injected in\n * parent element <iframe class=\"swg-dialog\"> element. Provides methods to\n * show/hide loading indicator.\n */\nexport class LoadingView {\n\n  /**\n   * @param {!Document} doc\n   */\n  constructor(doc) {\n\n    /** @private @const {!Document} */\n    this.doc_ = doc;\n\n    this.loadingContainer_ =\n        createElement(this.doc_, 'swg-loading-container', {});\n\n    /** @private @const {!Element} */\n    this.loading_ = createElement(this.doc_, 'swg-loading', {});\n    this.loadingContainer_.appendChild(this.loading_);\n\n    this.loadingContainer_.style.setProperty('display', 'none', 'important');\n\n    // Build the animated loading indicator.\n    this.buildLoadingIndicator_();\n  }\n\n  /**\n   * Gets the populated loading container.\n   * @return {!Element}\n   */\n  getElement() {\n    return this.loadingContainer_;\n  }\n\n  /*\n   * Shows the loading indicator within the container element.\n   */\n  show() {\n    this.loadingContainer_.style.removeProperty('display');\n  }\n\n  /*\n   * Hides the loading indicator within the container element.\n   */\n  hide() {\n    this.loadingContainer_.style.setProperty('display', 'none', 'important');\n  }\n\n  /*\n   * Populates the loading indivicator. The populated element\n   * can be added in any view, when required.\n   * @private\n   */\n  buildLoadingIndicator_() {\n    const loadingContainer = this.loading_;\n\n    const loadingIndicatorTopContainer =\n        createElement(this.doc_, 'swg-loading-animate', {});\n    loadingContainer.appendChild(loadingIndicatorTopContainer);\n\n    const loadingIndicatorChildContainer =\n        createElement(this.doc_, 'swg-loading-image', {});\n    loadingIndicatorTopContainer.appendChild(loadingIndicatorChildContainer);\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {createElement} from '../utils/dom';\nimport {\n  resetStyles,\n  setImportantStyles,\n} from '../utils/style';\n\n/** @const {!Object<string, string|number>} */\nexport const toastImportantStyles = {\n  'position': 'fixed',\n  'bottom': 0,\n  'height': 0,\n  'max-height': '46px',\n  'z-index': '2147483647',\n  'border': 'none',\n};\n\n/** @typedef {{\n *    text: string,\n *    action: ({label: string, handler: function()}|undefined)\n *  }}\n */\nexport let ToastSpecDef;\n\n/** @const {!Object<string, string>} */\nconst iframeAttributes = {\n  'frameborder': '0',\n  'scrolling': 'no',\n  'class': 'swg-toast',\n};\n\n/**\n * The class Notification toast.\n */\nexport class Toast {\n\n  /**\n   * @param {!../runtime/deps.DepsDef} deps\n   * @param {string} src\n   * @param {!Object<string, ?>} args\n   */\n  constructor(deps, src, args) {\n\n    /** @private @const {!../model/doc.Doc} */\n    this.doc_ = deps.doc();\n\n    /** @private @const {!web-activities/activity-ports.ActivityPorts} */\n    this.activityPorts_ = deps.activities();\n\n    /** @private @const {string} */\n    this.src_ = src;\n\n    /** @private @const {!Object<string, ?>} */\n    this.args_ = args;\n\n    /** @private @const {!HTMLIFrameElement} */\n    this.iframe_ =\n        /** @type {!HTMLIFrameElement} */ (\n            createElement(\n                this.doc_.getWin().document,\n                'iframe',\n                iframeAttributes));\n\n    setImportantStyles(this.iframe_, toastImportantStyles);\n\n    /** @private @const {!Promise} */\n    this.ready_ = new Promise(resolve => {\n      this.iframe_.onload = resolve;\n    });\n  }\n\n  /**\n   * Returns the iframe element.\n   * @return {!HTMLIFrameElement}\n   */\n  getElement() {\n    return this.iframe_;\n  }\n\n  /**\n   * Opens the notification toast.\n   * @return {!Promise}\n   */\n  open() {\n    this.doc_.getBody().appendChild(this.iframe_);  // Fires onload.\n    return this.buildToast_();\n  }\n\n  /**\n   * Builds the content of the iframe. On load, animates the toast.\n   */\n  buildToast_() {\n    const toastDurationSeconds = 7;\n    return this.activityPorts_.openIframe(\n        this.iframe_, this.src_, this.args_).then(port => {\n          return port.whenReady();\n        }).then(() => {\n          resetStyles(this.iframe_, ['height']);\n          setImportantStyles(this.iframe_, {\n            'animation': 'swg-notify .3s ease-out normal backwards, '\n                  + 'swg-notify-hide .3s ease-out ' + toastDurationSeconds +\n                  's normal forwards',\n          });\n          this.doc_.getWin().setTimeout(() => {\n            this.close();\n          }, (toastDurationSeconds + 1) * 1000);\n        });\n  }\n\n  /**\n   * Closes the toast.\n   */\n  close() {\n    this.doc_.getBody().removeChild(this.iframe_);\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * @param {!web-activities/activity-ports.ActivityPort} port\n * @param {string} requireOrigin\n * @param {boolean} requireOriginVerified\n * @param {boolean} requireSecureChannel\n * @return {!Promise<!Object>}\n */\nexport function acceptPortResultData(\n    port,\n    requireOrigin,\n    requireOriginVerified,\n    requireSecureChannel) {\n  return port.acceptResult().then(result => {\n    if (result.origin != requireOrigin ||\n        requireOriginVerified && !result.originVerified ||\n        requireSecureChannel && !result.secureChannel) {\n      throw new Error('channel mismatch');\n    }\n    return result.data;\n  });\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {setImportantStyles} from './style';\n\n/**\n * Returns a promise which is resolved after the given duration of animation\n * @param {!Element} el - Element to be observed.\n * @param {!Object<string, string|number>} props - properties to be animated.\n * @param {number} durationMillis - duration of animation.\n * @param {string} curve - transition function for the animation.\n * @return {!Promise} Promise which resolves once the animation is done playing.\n */\nexport function transition(el, props, durationMillis, curve) {\n  const win = el.ownerDocument.defaultView;\n  const previousTransitionValue = el.style.transition || '';\n  return new Promise(resolve => {\n    win.setTimeout(() => {\n      win.setTimeout(resolve, durationMillis);\n      const tr = `${durationMillis}ms ${curve}`;\n      setImportantStyles(el, Object.assign({\n        'transition': `transform ${tr}, opacity ${tr}`,\n      }, props));\n    });\n  }).then(() => {\n    setImportantStyles(el, {\n      'transition': previousTransitionValue,\n    });\n  });\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './log';\n\n/**\n * Character mapping from base64url to base64.\n * @const {!Object<string, string>}\n */\nconst base64UrlDecodeSubs = {'-': '+', '_': '/', '.': '='};\n\n/**\n * Character mapping from base64 to base64url.\n * @const {!Object<string, string>}\n */\nconst base64UrlEncodeSubs = {'+': '-', '/': '_', '=': '.'};\n\n\n/**\n * Converts a string which holds 8-bit code points, such as the result of atob,\n * into a Uint8Array with the corresponding bytes.\n * If you have a string of characters, you probably want to be using utf8Encode.\n * @param {string} str\n * @return {!Uint8Array}\n */\nexport function stringToBytes(str) {\n  const bytes = new Uint8Array(str.length);\n  for (let i = 0; i < str.length; i++) {\n    const charCode = str.charCodeAt(i);\n    assert(charCode <= 255, 'Characters must be in range [0,255]');\n    bytes[i] = charCode;\n  }\n  return bytes;\n}\n\n\n/**\n * Converts a 8-bit bytes array into a string\n * @param {!Uint8Array} bytes\n * @return {string}\n */\nexport function bytesToString(bytes) {\n  // Intentionally avoids String.fromCharCode.apply so we don't suffer a\n  // stack overflow. #10495, https://jsperf.com/bytesToString-2\n  const array = new Array(bytes.length);\n  for (let i = 0; i < bytes.length; i++) {\n    array[i] = String.fromCharCode(bytes[i]);\n  }\n  return array.join('');\n}\n\n\n/**\n * Interpret a byte array as a UTF-8 string.\n * @param {!BufferSource} bytes\n * @return {string}\n */\nexport function utf8DecodeSync(bytes) {\n  if (typeof TextDecoder !== 'undefined') {\n    return new TextDecoder('utf-8').decode(bytes);\n  }\n  const asciiString = bytesToString(new Uint8Array(bytes.buffer || bytes));\n  return decodeURIComponent(escape(asciiString));\n}\n\n\n/**\n * Turn a string into UTF-8 bytes.\n * @param {string} string\n * @return {!Uint8Array}\n */\nexport function utf8EncodeSync(string) {\n  if (typeof TextEncoder !== 'undefined') {\n    return new TextEncoder('utf-8').encode(string);\n  }\n  return stringToBytes(unescape(encodeURIComponent(string)));\n}\n\n\n/**\n * Converts a string which is in base64url encoding into a Uint8Array\n * containing the decoded value.\n * @param {string} str\n * @return {!Uint8Array}\n */\nexport function base64UrlDecodeToBytes(str) {\n  const encoded = atob(str.replace(/[-_.]/g, ch => base64UrlDecodeSubs[ch]));\n  return stringToBytes(encoded);\n}\n\n\n/**\n * Converts a bytes array into base64url encoded string.\n * base64url is defined in RFC 4648. It is sometimes referred to as \"web safe\".\n * @param {!Uint8Array} bytes\n * @return {string}\n */\nexport function base64UrlEncodeFromBytes(bytes) {\n  const str = bytesToString(bytes);\n  return btoa(str).replace(/[+/=]/g, ch => base64UrlEncodeSubs[ch]);\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * @param {!Document} doc\n * @return {string}\n */\nfunction getReadyState(doc) {\n  return /** @type {string} */ (doc['readyState']);\n}\n\n\n/**\n * Whether the document is ready.\n * @param {!Document} doc\n * @return {boolean}\n */\nexport function isDocumentReady(doc) {\n  const readyState = getReadyState(doc);\n  return readyState != 'loading' && readyState != 'uninitialized';\n}\n\n/**\n * Whether the document has loaded all the css and sub-resources.\n * @param {!Document} doc\n * @return {boolean}\n */\nfunction isDocumentComplete(doc) {\n  return getReadyState(doc) == 'complete';\n}\n\n/**\n * Calls the callback when document is ready.\n * @param {!Document} doc\n * @param {function(!Document)} callback\n */\nexport function onDocumentReady(doc, callback) {\n  onDocumentState(doc, isDocumentReady, callback);\n}\n\n/**\n * Calls the callback when document's state satisfies the stateFn.\n * @param {!Document} doc\n * @param {function(!Document):boolean} stateFn\n * @param {function(!Document)} callback\n */\nfunction onDocumentState(doc, stateFn, callback) {\n  let ready = stateFn(doc);\n  if (ready) {\n    callback(doc);\n  } else {\n    const readyListener = () => {\n      if (stateFn(doc)) {\n        if (!ready) {\n          ready = true;\n          callback(doc);\n        }\n        doc.removeEventListener('readystatechange', readyListener);\n      }\n    };\n    doc.addEventListener('readystatechange', readyListener);\n  }\n}\n\n/**\n * Returns a promise that is resolved when document is ready.\n * @param {!Document} doc\n * @return {!Promise<!Document>}\n */\nexport function whenDocumentReady(doc) {\n  return new Promise(resolve => {\n    onDocumentReady(doc, resolve);\n  });\n}\n\n/**\n * Returns a promise that is resolved when document is complete.\n * @param {!Document} doc\n * @return {!Promise<!Document>}\n */\nexport function whenDocumentComplete(doc) {\n  return new Promise(resolve => {\n    onDocumentState(doc, isDocumentComplete, resolve);\n  });\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './log';\nimport {setStyles} from './style';\n\n/** @const @enum{string} */\nexport const styleLinkAttrs = {\n  'rel': 'stylesheet',\n  'type': 'text/css',\n};\n\n/** @const {string} */\nexport const styleType = 'text/css';\n\n/** @const {string} */\nexport const styleExistsQuerySelector = 'link[rel=stylesheet][href]';\n\n\n/**\n * Add attributes to an element.\n * @param {!Element} element\n * @param {!Object<string, string|number|boolean|!Object<string, string|number|boolean>>} attributes\n * @return {!Element} updated element.\n */\nexport function addAttributesToElement(element, attributes) {\n  for (const attr in attributes) {\n    if (attr == 'style') {\n      setStyles(element,\n        /** @type !Object<string, string|boolean|number> */ (attributes[attr]));\n    } else {\n      element.setAttribute(attr,\n          /** @type {string|boolean|number} */ (attributes[attr]));\n    }\n\n  }\n  return element;\n}\n\n\n/**\n * Create a new element on document with specified tagName and attributes.\n * @param {!Document} doc\n * @param {string} tagName\n * @param {!Object<string, string>} attributes\n * @param {?(string|!Node|!ArrayLike<!Node>|!Array<!Node>)=} opt_content\n * @return {!Element} created element.\n */\nexport function createElement(doc, tagName, attributes, opt_content) {\n  const element = doc.createElement(tagName);\n  addAttributesToElement(element, attributes);\n  if (opt_content != null) {\n    if (typeof opt_content == 'string') {\n      element.textContent = opt_content;\n    } else if (opt_content.nodeType) {\n      element.appendChild(opt_content);\n    } else if ('length' in opt_content) {\n      for (let i = 0; i < opt_content.length; i++) {\n        element.appendChild(opt_content[i]);\n      }\n    } else {\n      assert(false, 'Unsupported content: %s', opt_content);\n    }\n  }\n  return element;\n}\n\n\n/**\n * Removes the element.\n * @param {!Element} element\n */\nexport function removeElement(element) {\n  if (element.parentElement) {\n    element.parentElement.removeChild(element);\n  }\n}\n\n\n/**\n * Removes all children from the parent element.\n * @param {!Element} parent\n */\nexport function removeChildren(parent) {\n  parent.textContent = '';\n}\n\n\n/**\n * Injects the provided styles in the HEAD section of the document.\n * @param {!Document} doc The document object.\n * @param {string} styleText The style string.\n * @return {!Element}\n */\nexport function injectStyleSheet(doc, styleText) {\n  const styleElement = createElement(doc, 'style', {\n    'type': styleType,\n  });\n  styleElement.textContent = styleText;\n  doc.head.appendChild(styleElement);\n  return styleElement;\n}\n\n\n/**\n * Whether the element have a next node in the document order.\n * This means either:\n *  a. The element itself has a nextSibling.\n *  b. Any of the element ancestors has a nextSibling.\n * @param {!Element} element\n * @param {?Node=} opt_stopNode\n * @return {boolean}\n */\nexport function hasNextNodeInDocumentOrder(element, opt_stopNode) {\n  let currentElement = element;\n  do {\n    if (currentElement.nextSibling) {\n      return true;\n    }\n  } while ((currentElement = currentElement.parentNode) &&\n            currentElement != opt_stopNode);\n  return false;\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * @param {*} error\n * @return {boolean}\n */\nexport function isCancelError(error) {\n  if (!error || typeof error != 'object') {\n    return false;\n  }\n  return (error['name'] === 'AbortError');\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview This module declares JSON types as defined in the\n * {@link http://json.org/}.\n */\n\nimport {isObject} from './types';\n\n\n/**\n * Recreates objects with prototype-less copies.\n * @param {!JsonObject} obj\n * @return {!JsonObject}\n */\nexport function recreateNonProtoObject(obj) {\n  const copy = Object.create(null);\n  for (const k in obj) {\n    if (!hasOwnProperty(obj, k)) {\n      continue;\n    }\n    const v = obj[k];\n    copy[k] = isObject(v) ? recreateNonProtoObject(v) : v;\n  }\n  return /** @type {!JsonObject} */ (copy);\n}\n\n\n/**\n * Returns a value from an object for a field-based expression. The expression\n * is a simple nested dot-notation of fields, such as `field1.field2`. If any\n * field in a chain does not exist or is not an object, the returned value will\n * be `undefined`.\n *\n * @param {!JsonObject} obj\n * @param {string} expr\n * @return {*}\n */\nexport function getValueForExpr(obj, expr) {\n  // The `.` indicates \"the object itself\".\n  if (expr == '.') {\n    return obj;\n  }\n  // Otherwise, navigate via properties.\n  const parts = expr.split('.');\n  let value = obj;\n  for (let i = 0; i < parts.length; i++) {\n    const part = parts[i];\n    if (!part) {\n      value = undefined;\n      break;\n    }\n    if (!isObject(value) ||\n            value[part] === undefined ||\n            !hasOwnProperty(value, part)) {\n      value = undefined;\n      break;\n    }\n    value = value[part];\n  }\n  return value;\n}\n\n/**\n * Simple wrapper around JSON.parse that casts the return value\n * to JsonObject.\n * Create a new wrapper if an array return value is desired.\n * @param {*} json JSON string to parse\n * @return {?JsonObject|undefined} May be extend to parse arrays.\n */\nexport function parseJson(json) {\n  return /** @type {?JsonObject} */(JSON.parse(/** @type {string} */ (json)));\n}\n\n/**\n * Parses the given `json` string without throwing an exception if not valid.\n * Returns `undefined` if parsing fails.\n * Returns the `Object` corresponding to the JSON string when parsing succeeds.\n * @param {*} json JSON string to parse\n * @param {function(!Error)=} opt_onFailed Optional function that will be called\n *     with the error if parsing fails.\n * @return {?JsonObject|undefined} May be extend to parse arrays.\n */\nexport function tryParseJson(json, opt_onFailed) {\n  try {\n    return parseJson(json);\n  } catch (e) {\n    if (opt_onFailed) {\n      opt_onFailed(e);\n    }\n    return undefined;\n  }\n}\n\n\n/**\n * @param {*} obj\n * @param {string} key\n * @return {boolean}\n */\nfunction hasOwnProperty(obj, key) {\n  if (obj == null || typeof obj != 'object') {\n    return false;\n  }\n  return Object.prototype.hasOwnProperty.call(\n      /** @type {!Object} */ (obj), key);\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {base64UrlDecodeToBytes, utf8DecodeSync} from './bytes';\nimport {tryParseJson} from './json';\n\n\n/**\n * @typedef {{\n *   header: (?JsonObject|undefined),\n *   payload: (?JsonObject|undefined),\n *   verifiable: string,\n *   sig: string,\n * }}\n */\nlet JwtTokenInternalDef;\n\n\n/**\n * Provides helper methods to decode and verify JWT tokens.\n */\nexport class JwtHelper {\n\n  constructor() {\n  }\n\n  /**\n   * Decodes JWT token and returns its payload.\n   * @param {string} encodedToken\n   * @return {?JsonObject|undefined}\n   */\n  decode(encodedToken) {\n    return this.decodeInternal_(encodedToken).payload;\n  }\n\n  /**\n   * @param {string} encodedToken\n   * @return {!JwtTokenInternalDef}\n   * @private\n   */\n  decodeInternal_(encodedToken) {\n    // See https://jwt.io/introduction/\n    function invalidToken() {\n      throw new Error(`Invalid token: \"${encodedToken}\"`);\n    }\n\n    // Encoded token has three parts: header.payload.sig\n    // Note! The padding is not allowed by JWT spec:\n    // http://self-issued.info/docs/draft-goland-json-web-token-00.html#rfc.section.5\n    const parts = encodedToken.split('.');\n    if (parts.length != 3) {\n      invalidToken();\n    }\n    const headerUtf8Bytes = base64UrlDecodeToBytes(parts[0]);\n    const payloadUtf8Bytes = base64UrlDecodeToBytes(parts[1]);\n    return {\n      header: tryParseJson(utf8DecodeSync(headerUtf8Bytes), invalidToken),\n      payload: tryParseJson(utf8DecodeSync(payloadUtf8Bytes), invalidToken),\n      verifiable: `${parts[0]}.${parts[1]}`,\n      sig: parts[2],\n    };\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @param  {...*} var_args [description]\n */\n export function log(var_args) {\n   console.log.apply(console, arguments);\n }\n\n/**\n * Throws an error if the first argument isn't trueish.\n *\n * Supports argument substitution into the message via %s placeholders.\n *\n * Throws an error object that has two extra properties:\n * - associatedElement: This is the first element provided in the var args.\n *   It can be used for improved display of error messages.\n * - messageArray: The elements of the substituted message as non-stringified\n *   elements in an array. When e.g. passed to console.error this yields\n *   native displays of things like HTML elements.\n *\n * @param {T} shouldBeTrueish The value to assert. The assert fails if it does\n *     not evaluate to true.\n * @param {string=} opt_message The assertion message\n * @param {...*} var_args Arguments substituted into %s in the message.\n * @return {T} The value of shouldBeTrueish.\n * @template T\n */\n export function assert(shouldBeTrueish, opt_message, var_args) {\n   let firstElement;\n   if (!shouldBeTrueish) {\n     const message = opt_message || 'Assertion failed';\n     const splitMessage = message.split('%s');\n     const first = splitMessage.shift();\n     let formatted = first;\n     const messageArray = [];\n     pushIfNonEmpty(messageArray, first);\n     for (let i = 2; i < arguments.length; i++) {\n       const val = arguments[i];\n       if (val && val.tagName) {\n         firstElement = val;\n       }\n       const nextConstant = splitMessage.shift();\n       messageArray.push(val);\n       pushIfNonEmpty(messageArray, nextConstant.trim());\n       formatted += toString(val) + nextConstant;\n     }\n     const e = new Error(formatted);\n     e.fromAssert = true;\n     e.associatedElement = firstElement;\n     e.messageArray = messageArray;\n     throw e;\n   }\n   return shouldBeTrueish;\n }\n\n/**\n * @param {!Array} array\n * @param {*} val\n */\n function pushIfNonEmpty(array, val) {\n   if (val != '') {\n     array.push(val);\n   }\n }\n\n function toString(val) {\n  // Do check equivalent to `val instanceof Element` without cross-window bug\n   if (val && val.nodeType == 1) {\n     return val.tagName.toLowerCase() + (val.id ? '#' + val.id : '');\n   }\n   return /** @type {string} */ (val);\n }\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * Returns a map-like object.\n * If opt_initial is provided, copies its own properties into the\n * newly created object.\n * @param {Object=} opt_initial This should typically be an object literal.\n * @return {!Object}\n * @template T\n */\nexport function map(opt_initial) {\n  const obj = Object.create(null);\n  if (opt_initial) {\n    Object.assign(obj, opt_initial);\n  }\n  return obj;\n}\n\n\n/**\n * Implements `Array.find()` method that's not yet available in all browsers.\n *\n * @param {?Array<T>} array\n * @param {function(T, number, !Array<T>):boolean} predicate\n * @return {?T}\n * @template T\n */\nexport function findInArray(array, predicate) {\n  if (!array) {\n    return null;\n  }\n  const len = array.length || 0;\n  if (len > 0) {\n    for (let i = 0; i < len; i++) {\n      const other = array[i];\n      if (predicate(other, i, array)) {\n        return other;\n      }\n    }\n  }\n  return null;\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {createElement} from './dom';\n\n\nexport class Preconnect {\n\n  /**\n   * @param {!Document} doc\n   */\n  constructor(doc) {\n    /** @private @const {!Document} */\n    this.doc_ = doc;\n  }\n\n  /**\n   * @param {string} url\n   */\n  preconnect(url) {\n    this.pre_(url, 'preconnect');\n  }\n\n  /**\n   * @param {string} url\n   */\n  dnsPrefetch(url) {\n    this.pre_(url, 'dns-prefetch');\n  }\n\n  /**\n   * @param {string} url\n   */\n  prefetch(url) {\n    this.pre_(url, 'preconnect prefetch');\n  }\n\n  /**\n   * @param {string} url\n   * @param {string} as\n   */\n  preload(url, as) {\n    this.pre_(url, 'preconnect preload', as);\n  }\n\n  /**\n   * @param {string} url\n   * @param {string} rel\n   * @param {?string=} opt_as\n   * @private\n   */\n  pre_(url, rel, opt_as) {\n    // <link rel=\"prefetch\" href=\"...\" as=\"\">\n    const linkEl = createElement(this.doc_, 'link', {\n      'rel': rel,\n      'href': url,\n    });\n    if (opt_as) {\n      linkEl.setAttribute('as', opt_as);\n    }\n    this.doc_.head.appendChild(linkEl);\n  }\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @param {string} _match\n * @param {string} character\n * @return {string}\n */\nfunction toUpperCase(_match, character) {\n  return character.toUpperCase();\n}\n\n/**\n * @param {string} name Attribute name with dashes\n * @return {string} Dashes removed and character after to upper case.\n * visibleForTesting\n */\nexport function dashToCamelCase(name) {\n  return name.replace(/-([a-z])/g, toUpperCase);\n}\n\n/**\n * @param {string} name Attribute name with dashes\n * @return {string} Dashes replaced by underlines.\n */\nexport function dashToUnderline(name) {\n  return name.replace('-', '_');\n}\n\n/**\n * Polyfill for String.prototype.endsWith.\n * @param {string} string\n * @param {string} suffix\n * @return {boolean}\n */\nexport function endsWith(string, suffix) {\n  const index = string.length - suffix.length;\n  return index >= 0 && string.indexOf(suffix, index) == index;\n}\n\n/**\n * Polyfill for String.prototype.startsWith.\n * @param {string} string\n * @param {string} prefix\n * @return {boolean}\n */\nexport function startsWith(string, prefix) {\n  if (prefix.length > string.length) {\n    return false;\n  }\n  return string.lastIndexOf(prefix, 0) == 0;\n}\n\n/**\n * Expands placeholders in a given template string with values.\n *\n * Placeholders use ${key-name} syntax and are replaced with the value\n * returned from the given getter function.\n *\n * @param {string} template The template string to expand.\n * @param {!function(string):*} getter Function used to retrieve a value for a\n *   placeholder. Returns values will be coerced into strings.\n * @param {number=} opt_maxIterations Number of times to expand the template.\n *   Defaults to 1, but should be set to a larger value your placeholder tokens\n *   can be expanded to other placeholder tokens. Take caution with large values\n *   as recursively expanding a string can be exponentially expensive.\n */\nexport function expandTemplate(template, getter, opt_maxIterations) {\n  const maxIterations = opt_maxIterations || 1;\n  for (let i = 0; i < maxIterations; i++) {\n    let matches = 0;\n    template = template.replace(/\\${([^}]*)}/g, (_a, b) => {\n      matches++;\n      return getter(b);\n    });\n    if (!matches) {\n      break;\n    }\n  }\n  return template;\n}\n\n/**\n * Hash function djb2a\n * This is intended to be a simple, fast hashing function using minimal code.\n * It does *not* have good cryptographic properties.\n * @param {string} str\n * @return {string} 32-bit unsigned hash of the string\n */\nexport function stringHash32(str) {\n  const length = str.length;\n  let hash = 5381;\n  for (let i = 0; i < length; i++) {\n    hash = hash * 33 ^ str.charCodeAt(i);\n  }\n  // Convert from 32-bit signed to unsigned.\n  return String(hash >>> 0);\n};\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Note: loaded by 3p system. Cannot rely on babel polyfills.\nimport {map} from './object.js';\nimport {startsWith} from './string';\n\n/** @type {Object<string, string>} */\nlet propertyNameCache;\n\n/** @const {!Array<string>} */\nconst vendorPrefixes = ['Webkit', 'webkit', 'Moz', 'moz', 'ms', 'O', 'o'];\n\n/**\n * Default styles to be set for top level friendly iframe.\n * Some attributes are not included such as height, left, margin-left; since\n * these attributes are updated by @media queries and having these values\n * defined here as !important does not work on IE/edge browsers.\n * @const {!Object<string, string|number>}\n */\nexport const defaultStyles = {\n  'align-content': 'normal',\n  'animation': 'none',\n  'align-items': 'normal',\n  'align-self': 'auto',\n  'alignment-baseline': 'auto',\n  'backface-visibility': 'hidden',\n  'background-clip': 'border-box',\n  'background-image': 'none',\n  'baseline-shift': '0',\n  'block-size': 'auto',\n  'border': 'none',\n  'border-collapse': 'separate',\n  'bottom': '0',\n  'box-sizing': 'border-box',\n  'break-after': 'auto',\n  'break-before': 'auto',\n  'break-inside': 'auto',\n  'buffered-rendering': 'auto',\n  'caption-side': 'top',\n  'caret-color': 'rgb(51, 51, 51)',\n  'clear': 'none',\n  'color': 'rgb(51, 51, 51)',\n  'color-rendering': 'auto',\n  'column-count': 'auto',\n  'column-fill': 'balance',\n  'column-gap': 'normal',\n  'column-rule-color': 'rgb(51, 51, 51)',\n  'column-rule-style': 'none',\n  'column-rule-width': '0',\n  'column-span': 'none',\n  'column-width': 'auto',\n  'contain': 'none',\n  'counter-increment': 'none',\n  'counter-reset': 'none',\n  'cursor': 'auto',\n  'direction': 'inherit',\n  'display': 'block',\n  'empty-cells': 'show',\n  'filter': 'none',\n  'flex': 'none',  // flex-grow, flex-shrink, and flex-basis.\n  'flex-flow': 'row nowrap',  // flex-direction, flex-wrap.\n  'float': 'none',\n  'flood-color': 'rgb(0, 0, 0)',\n  'flood-opacity': '1',\n  'font': 'none',\n  'font-size': 'medium',\n  'font-family': '',\n  'height': 'auto',\n  'hyphens': 'manual',\n  'image-rendering': 'auto',\n  'inline-size': '',  // Setting to 'auto' will not allow override.\n  'isolation': 'auto',\n  'justify-content': 'normal',\n  'justify-items': 'normal',\n  'justify-self': 'auto',\n  'letter-spacing': 'normal',\n  'lighting-color': 'rgb(255, 255, 255)',\n  'line-break': 'auto',\n  'line-height': 'normal',\n  'mask': 'none',\n  'max-block-size': 'none',\n  'max-height': 'none',\n  'max-inline-size': 'none',\n  'max-width': 'none',\n  'min-block-size': 'none',\n  'min-height': '0',\n  'min-inline-size': '0',\n  'min-width': '0',\n  'mix-blend-mode': 'normal',\n  'object-fit': 'fill',  // Important for Safari browser.\n  'offset-distance': 'none',  // Chrome only (Experimental).\n  'offset-path': 'none',  // Chrome only (Experimental).\n  'offset-rotate': 'auto 0deg',  // Chrome only (Experimental).\n  'opacity': '1',\n  'order': '0',\n  'orphans': '2',\n  'outline': 'none',\n  'overflow-anchor': 'auto',\n  'overflow-wrap': 'normal',\n  'overflow': 'visible',\n  'padding': '0',\n  'page': '',\n  'perspective': 'none',\n  'pointer-events': 'auto',\n  'position': 'static',\n  'quotes': '',\n  'resize': 'none',\n  'right': '0',\n  'scroll-behavior': 'auto',\n  'tab-size': '8',  // Only Chrome, Safari (Experimental).\n  'table-layout': 'auto',\n  'text-align': 'start',\n  'text-align-last': 'auto',\n  'text-anchor': 'start',\n  'text-combine-upright': 'none',\n  'text-decoration': 'none',\n  'text-indent': '0',\n  'text-orientation': 'mixed',\n  'text-overflow': 'clip',\n  'text-rendering': 'auto',\n  'text-shadow': 'none',\n  'text-size-adjust': 'auto',\n  'text-transform': 'none',\n  'text-underline-position': 'auto',\n  'top': 'auto',\n  'touch-action': 'auto',\n  'transform': 'none',\n  'transition': 'none 0s ease 0s',\n  'unicode-bidi': 'normal',\n  'user-select': 'auto',\n  'vector-effect': 'none',\n  'vertical-align': 'baseline',\n  'visibility': 'visible',\n  'white-space': 'normal',\n  'widows': '2',\n  'word-break': 'normal',\n  'word-spacing': '0',\n  'word-wrap': 'normal',\n  'writing-mode': 'horizontal-tb',\n  'zoom': '1',\n  'z-index': 'auto',\n};\n\n/** @const {string} */\nexport const googleFontsUrl =\n    'https://fonts.googleapis.com/css?family=Google+Sans';\n\n/**\n * @export\n * @param {string} camelCase camel cased string\n * @return {string} title cased string\n */\nexport function camelCaseToTitleCase(camelCase) {\n  return camelCase.charAt(0).toUpperCase() + camelCase.slice(1);\n}\n\n/**\n * Checks the style if a prefixed version of a property exists and returns\n * it or returns an empty string.\n * @private\n * @param {!Object} style\n * @param {string} titleCase the title case version of a css property name\n * @return {string} the prefixed property name or null.\n */\nfunction getVendorJsPropertyName_(style, titleCase) {\n  for (let i = 0; i < vendorPrefixes.length; i++) {\n    const propertyName = vendorPrefixes[i] + titleCase;\n    if (style[propertyName] !== undefined) {\n      return propertyName;\n    }\n  }\n  return '';\n}\n\n\n/**\n * Returns the possibly prefixed JavaScript property name of a style property\n * (ex. WebkitTransitionDuration) given a camelCase'd version of the property\n * (ex. transitionDuration).\n * @export\n * @param {!Object} style\n * @param {string} camelCase the camel cased version of a css property name\n * @param {boolean=} opt_bypassCache bypass the memoized cache of property\n *   mapping\n * @return {string}\n */\nexport function getVendorJsPropertyName(style, camelCase, opt_bypassCache) {\n  if (startsWith(camelCase, '--')) {\n    // CSS vars are returned as is.\n    return camelCase;\n  }\n  if (!propertyNameCache) {\n    propertyNameCache = map();\n  }\n  let propertyName = propertyNameCache[camelCase];\n  if (!propertyName || opt_bypassCache) {\n    propertyName = camelCase;\n    if (style[camelCase] === undefined) {\n      const titleCase = camelCaseToTitleCase(camelCase);\n      const prefixedPropertyName = getVendorJsPropertyName_(style, titleCase);\n\n      if (style[prefixedPropertyName] !== undefined) {\n        propertyName = prefixedPropertyName;\n      }\n    }\n    if (!opt_bypassCache) {\n      propertyNameCache[camelCase] = propertyName;\n    }\n  }\n  return propertyName;\n}\n\n\n/**\n * Sets the CSS styles of the specified element with !important. The styles\n * are specified as a map from CSS property names to their values.\n * @param {!Element} element\n * @param {!Object<string, string|number>} styles\n */\nexport function setImportantStyles(element, styles) {\n  for (const k in styles) {\n    element.style.setProperty(\n        getVendorJsPropertyName(styles, k), styles[k].toString(), 'important');\n  }\n}\n\n\n/**\n * Sets the CSS style of the specified element with optional units, e.g. \"px\".\n * @param {Element} element\n * @param {string} property\n * @param {?string|number|boolean} value\n * @param {string=} opt_units\n * @param {boolean=} opt_bypassCache\n */\nexport function setStyle(element, property, value, opt_units, opt_bypassCache) {\n  const propertyName = getVendorJsPropertyName(element.style, property,\n      opt_bypassCache);\n  if (propertyName) {\n    element.style[propertyName] =\n        /** @type {string} */ (opt_units ? value + opt_units : value);\n  }\n}\n\n\n/**\n * Returns the value of the CSS style of the specified element.\n * @param {!Element} element\n * @param {string} property\n * @param {boolean=} opt_bypassCache\n * @return {*}\n */\nexport function getStyle(element, property, opt_bypassCache) {\n  const propertyName = getVendorJsPropertyName(element.style, property,\n      opt_bypassCache);\n  if (!propertyName) {\n    return undefined;\n  }\n  return element.style[propertyName];\n}\n\n\n/**\n * Sets the CSS styles of the specified element. The styles\n * a specified as a map from CSS property names to their values.\n * @param {!Element} element\n * @param {!Object<string, ?string|number|boolean>} styles\n */\nexport function setStyles(element, styles) {\n  for (const k in styles) {\n    setStyle(element, k, styles[k]);\n  }\n}\n\n\n/**\n * Shows or hides the specified element.\n * @param {!Element} element\n * @param {boolean=} opt_display\n */\nexport function toggle(element, opt_display) {\n  if (opt_display === undefined) {\n    opt_display = getStyle(element, 'display') == 'none';\n  }\n  setStyle(element, 'display', opt_display ? '' : 'none');\n}\n\n\n/**\n * Returns a pixel value.\n * @param {number} value\n * @return {string}\n */\nexport function px(value) {\n  return value + 'px';\n}\n\n\n/**\n * Returns a \"translateX\" for CSS \"transform\" property.\n * @param {number|string} value\n * @return {string}\n */\nexport function translateX(value) {\n  if (typeof value == 'string') {\n    return `translateX(${value})`;\n  }\n  return `translateX(${px(value)})`;\n}\n\n\n/**\n * Returns a \"translateX\" for CSS \"transform\" property.\n * @param {number|string} x\n * @param {(number|string)=} opt_y\n * @return {string}\n */\nexport function translate(x, opt_y) {\n  if (typeof x == 'number') {\n    x = px(x);\n  }\n  if (opt_y === undefined) {\n    return `translate(${x})`;\n  }\n  if (typeof opt_y == 'number') {\n    opt_y = px(opt_y);\n  }\n  return `translate(${x}, ${opt_y})`;\n}\n\n\n/**\n * Returns a \"scale\" for CSS \"transform\" property.\n * @param {number|string} value\n * @return {string}\n */\nexport function scale(value) {\n  return `scale(${value})`;\n}\n\n\n/**\n * Remove alpha value from a rgba color value.\n * Return the new color property with alpha equals if has the alpha value.\n * Caller needs to make sure the input color value is a valid rgba/rgb value\n * @param {string} rgbaColor\n * @return {string}\n */\nexport function removeAlphaFromColor(rgbaColor) {\n  return rgbaColor.replace(\n      /\\(([^,]+),([^,]+),([^,)]+),[^)]+\\)/g, '($1,$2,$3, 1)');\n}\n\n\n/**\n * Gets the computed style of the element. The helper is necessary to enforce\n * the possible `null` value returned by a buggy Firefox.\n *\n * @param {!Window} win\n * @param {!Element} el\n * @return {!Object<string, string>}\n */\nexport function computedStyle(win, el) {\n  const style = /** @type {?CSSStyleDeclaration} */(win.getComputedStyle(el));\n  return /** @type {!Object<string, string>} */(style) || map();\n}\n\n\n/**\n * Resets styles that were set dynamically (i.e. inline)\n * @param {!Element} element\n * @param {!Array<string>} properties\n */\nexport function resetStyles(element, properties) {\n  const styleObj = {};\n  properties.forEach(prop => {\n    styleObj[prop] = null;\n  });\n  setStyles(element, styleObj);\n}\n\n\n/**\n * Resets all the styles of an element to a given value. Defaults to null.\n * The valid values are 'inherit', 'initial', 'unset' or null.\n */\nexport function resetAllStyles(element) {\n  setImportantStyles(element, defaultStyles);\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* @const */\nconst toString_ = Object.prototype.toString;\n\n/**\n * Returns the ECMA [[Class]] of a value\n * @param {*} value\n * @return {string}\n */\nfunction toString(value) {\n  return toString_.call(value);\n}\n\n/**\n * Determines if value is actually an Array.\n * @param {*} value\n * @return {boolean}\n */\nexport function isArray(value) {\n  return Array.isArray(value);\n}\n\n/**\n * Converts an array-like object to an array.\n * @param {?IArrayLike<T>|string} arrayLike\n * @return {!Array<T>}\n * @template T\n */\nexport function toArray(arrayLike) {\n  if (!arrayLike) {\n    return [];\n  }\n  const array = new Array(arrayLike.length);\n  for (let i = 0; i < arrayLike.length; i++) {\n    array[i] = arrayLike[i];\n  }\n  return array;\n}\n\n/**\n * Determines if value is actually an Object.\n * @param {*} value\n * @return {boolean}\n */\nexport function isObject(value) {\n  return toString(value) === '[object Object]';\n}\n\n/**\n * Determines if value is of number type and finite.\n * NaN and Infinity are not considered a finite number.\n * String numbers are not considered numbers.\n * @param {*} value\n * @return {boolean}\n */\nexport function isFiniteNumber(value) {\n  return (typeof value === 'number' && isFinite(value));\n}\n\n/**\n * Determines if value is of FormData type.\n * @param {*} value\n * @return {boolean}\n */\nexport function isFormData(value) {\n  return toString(value) === '[object FormData]';\n}\n\n/**\n * Checks whether `s` is a valid value of `enumObj`.\n *\n * @param {!Object<T>} enumObj\n * @param {T} s\n * @return {boolean}\n * @template T\n */\nexport function isEnumValue(enumObj, s) {\n  for (const k in enumObj) {\n    if (enumObj[k] === s) {\n      return true;\n    }\n  }\n  return false;\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {isArray} from './types';\n\n\n/**\n  @typedef {{\n    href: string,\n    protocol: string,\n    host: string,\n    hostname: string,\n    port: string,\n    pathname: string,\n    search: string,\n    hash: string,\n    origin: string,\n  }}\n  */\nlet LocationDef;\n\n\n/**\n * Cached a-tag to avoid memory allocation during URL parsing.\n * @type {HTMLAnchorElement}\n */\nlet a;\n\n\n/**\n * We cached all parsed URLs. As of now there are no use cases\n * of AMP docs that would ever parse an actual large number of URLs,\n * but we often parse the same one over and over again.\n * @type {Object<string, !LocationDef>}\n */\nlet cache;\n\n/**\n * Serializes the passed parameter map into a query string with both keys\n * and values encoded.\n * @param {!JsonObject} params\n * @return {string}\n */\nexport function serializeQueryString(params) {\n  const s = [];\n  for (const k in params) {\n    const v = params[k];\n    if (v == null) {\n      continue;\n    } else if (isArray(v)) {\n      for (let i = 0; i < v.length; i++) {\n        const sv = /** @type {string} */ (v[i]);\n        s.push(`${encodeURIComponent(k)}=${encodeURIComponent(sv)}`);\n      }\n    } else {\n      const sv = /** @type {string} */ (v);\n      s.push(`${encodeURIComponent(k)}=${encodeURIComponent(sv)}`);\n    }\n  }\n  return s.join('&');\n}\n\n/**\n * Returns a Location-like object for the given URL. If it is relative,\n * the URL gets resolved.\n * Consider the returned object immutable. This is enforced during\n * testing by freezing the object.\n * @param {string} url\n * @param {boolean=} opt_nocache\n * @return {!LocationDef}\n */\nexport function parseUrl(url, opt_nocache) {\n  if (!a) {\n    a = /** @type {!HTMLAnchorElement} */ (self.document.createElement('a'));\n    cache = self.UrlCache || (self.UrlCache = Object.create(null));\n  }\n\n  const fromCache = cache[url];\n  if (fromCache) {\n    return fromCache;\n  }\n\n  const info = parseUrlWithA(a, url);\n\n  return cache[url] = info;\n}\n\n/**\n * Returns a Location-like object for the given URL. If it is relative,\n * the URL gets resolved.\n * @param {!HTMLAnchorElement} a\n * @param {string} url\n * @return {!LocationDef}\n */\nfunction parseUrlWithA(a, url) {\n  a.href = url;\n\n  // IE11 doesn't provide full URL components when parsing relative URLs.\n  // Assigning to itself again does the trick.\n  if (!a.protocol) {\n    a.href = a.href;\n  }\n\n  /** @type {!LocationDef} */\n  const info = {\n    href: a.href,\n    protocol: a.protocol,\n    host: a.host,\n    hostname: a.hostname,\n    port: a.port == '0' ? '' : a.port,\n    pathname: a.pathname,\n    search: a.search,\n    hash: a.hash,\n    origin: '', // Set below.\n  };\n\n  // Some IE11 specific polyfills.\n  // 1) IE11 strips out the leading '/' in the pathname.\n  if (info.pathname[0] !== '/') {\n    info.pathname = '/' + info.pathname;\n  }\n\n  // 2) For URLs with implicit ports, IE11 parses to default ports while\n  // other browsers leave the port field empty.\n  if ((info.protocol == 'http:' && info.port == 80) ||\n      (info.protocol == 'https:' && info.port == 443)) {\n    info.port = '';\n    info.host = info.hostname;\n  }\n\n  // For data URI a.origin is equal to the string 'null' which is not useful.\n  // We instead return the actual origin which is the full URL.\n  if (a.origin && a.origin != 'null') {\n    info.origin = a.origin;\n  } else if (info.protocol == 'data:' || !info.host) {\n    info.origin = info.href;\n  } else {\n    info.origin = info.protocol + '//' + info.host;\n  }\n  return info;\n}\n\n\n/**\n * Parses and builds Object of URL query string.\n * @param {string} query The URL query string.\n * @return {!Object<string, string>}\n */\nexport function parseQueryString(query) {\n  if (!query) {\n    return {};\n  }\n  return (/^[?#]/.test(query) ? query.slice(1) : query)\n      .split('&')\n      .reduce((params, param) => {\n        const item = param.split('=');\n        const key = decodeURIComponent(item[0] || '');\n        const value = decodeURIComponent(item[1] || '');\n        if (key) {\n          params[key] = value;\n        }\n        return params;\n      }, {});\n}\n\n\n/**\n * Adds a parameter to a query string.\n * @param {string} url\n * @param {string} param\n * @param {string} value\n * @return {string}\n */\nexport function addQueryParam(url, param, value) {\n  const queryIndex = url.indexOf('?');\n  const fragmentIndex = url.indexOf('#');\n  let fragment = '';\n  if (fragmentIndex != -1) {\n    fragment = url.substring(fragmentIndex);\n    url = url.substring(0, fragmentIndex);\n  }\n  if (queryIndex == -1) {\n    url += '?';\n  } else if (queryIndex < url.length - 1) {\n    url += '&';\n  }\n  url += encodeURIComponent(param) + '=' + encodeURIComponent(value);\n  return url + fragment;\n}\n\n\n/**\n * Returns the Url including the path and search, without fregment.\n * @param {string} url\n * @return {string}\n */\nexport function getHostUrl(url) {\n  const locationHref = parseUrl(url);\n  return locationHref.origin + locationHref.pathname + locationHref.search;\n}\n","/**\n * Copyright 2018 The Subscribe with Google Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assert} from './log';\nimport {parseJson} from './json';\nimport {parseUrl} from './url';\nimport {utf8EncodeSync} from './bytes';\n\n/**\n * The \"init\" argument of the Fetch API. Currently, only \"credentials: include\"\n * is implemented.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch\n *\n * @typedef {{\n *   body: (!FormData|string|undefined),\n *   credentials: (string|undefined),\n *   headers: (!Object|undefined),\n *   method: (string|undefined),\n *   responseType: (string)\n * }}\n */\nexport let FetchInitDef;\n\n\n/** @private @const {!Array<string>} */\nconst allowedMethods_ = ['GET', 'POST'];\n\n/** @private @enum {number} Allowed fetch responses. */\nconst allowedFetchTypes_ = {\n  document: 1,\n  text: 2,\n};\n\n\n/**\n * A class that polyfills Fetch API.\n */\nexport class Xhr {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @const {!Window} */\n    this.win = win;\n  }\n\n  /**\n   * We want to call `fetch_` unbound from any context since it could\n   * be either the native fetch or our polyfill.\n   *\n   * @param {string} input\n   * @param {!FetchInitDef} init\n   * @return {!Promise<!FetchResponse>|!Promise<!Response>}\n   * @private\n   */\n  fetch_(input, init) {\n    // TODO(avimehta): Should the requests go through when page is not visible?\n    assert(typeof input == 'string', 'Only URL supported: %s', input);\n    // In particular, Firefox does not tolerate `null` values for\n    // `credentials`.\n    const creds = init.credentials;\n    assert(\n        creds === undefined || creds == 'include' || creds == 'omit',\n        'Only credentials=include|omit support: %s', creds);\n    // Fallback to xhr polyfill since `fetch` api does not support\n    // responseType = 'document'. We do this so we don't have to do any parsing\n    // and document construction on the UI thread which would be expensive.\n    if (init.responseType == 'document') {\n      return fetchPolyfill(input, init);\n    }\n    return (this.win.fetch || fetchPolyfill).apply(null, arguments);\n  }\n\n  /**\n   * @param {string} input URL\n   * @param {?FetchInitDef} opt_init Fetch options object.\n   * @return {!Promise<!FetchResponse>}\n   */\n  fetch(input, opt_init) {\n    // TODO (avimehta): Figure out if CORS needs be handled the way AMP does it.\n    const init = setupInit(opt_init);\n    return this.fetch_(input, init).then(response => response, reason => {\n      const targetOrigin = parseUrl(input).origin;\n      throw new Error('XHR Failed fetching' +\n          ` (${targetOrigin}/...):`, reason && reason.message);\n    }).then(response => assertSuccess(response));\n  }\n}\n\n/**\n * Normalized method name by uppercasing.\n * @param {string|undefined} method\n * @return {string}\n * @private\n */\nfunction normalizeMethod_(method) {\n  if (method === undefined) {\n    return 'GET';\n  }\n  method = method.toUpperCase();\n\n  assert(\n      allowedMethods_.includes(method),\n      'Only one of %s is currently allowed. Got %s',\n      allowedMethods_.join(', '),\n      method\n  );\n\n  return method;\n}\n\n/**\n * Sets up and normalizes the FetchInitDef\n *\n * @param {?FetchInitDef=} opt_init Fetch options object.\n * @param {string=} opt_accept The HTTP Accept header value.\n * @return {!FetchInitDef}\n */\nfunction setupInit(opt_init, opt_accept) {\n  const init = opt_init || /** @type {FetchInitDef} */ ({});\n  init.method = normalizeMethod_(init.method);\n  init.headers = init.headers || {};\n  if (opt_accept) {\n    init.headers['Accept'] = opt_accept;\n  }\n  return init;\n}\n\n\n/**\n * A minimal polyfill of Fetch API. It only polyfills what we currently use.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch\n *\n * Notice that the \"fetch\" method itself is not exported as that would require\n * us to immediately support a much wide API.\n *\n * @param {string} input\n * @param {!FetchInitDef} init\n * @return {!Promise<!FetchResponse>}\n * @private Visible for testing\n */\nexport function fetchPolyfill(input, init) {\n  return new Promise(function(resolve, reject) {\n    const xhr = createXhrRequest(init.method || 'GET', input);\n\n    if (init.credentials == 'include') {\n      xhr.withCredentials = true;\n    }\n\n    if (init.responseType in allowedFetchTypes_) {\n      xhr.responseType = init.responseType;\n    }\n\n    if (init.headers) {\n      Object.keys(init.headers).forEach(function(header) {\n        xhr.setRequestHeader(header, init.headers[header]);\n      });\n    }\n\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState < /* STATUS_RECEIVED */ 2) {\n        return;\n      }\n      if (xhr.status < 100 || xhr.status > 599) {\n        xhr.onreadystatechange = null;\n        reject(new Error(`Unknown HTTP status ${xhr.status}`));\n        return;\n      }\n\n      // TODO(dvoytenko): This is currently simplified: we will wait for the\n      // whole document loading to complete. This is fine for the use cases\n      // we have now, but may need to be reimplemented later.\n      if (xhr.readyState == /* COMPLETE */ 4) {\n        resolve(new FetchResponse(xhr));\n      }\n    };\n    xhr.onerror = () => {\n      reject(new Error('Network failure'));\n    };\n    xhr.onabort = () => {\n      reject(new Error('Request aborted'));\n    };\n\n    if (init.method == 'POST') {\n      xhr.send(init.body);\n    } else {\n      xhr.send();\n    }\n  });\n}\n\n/**\n * @param {string} method\n * @param {string} url\n * @return {!XMLHttpRequest}\n * @private\n */\nfunction createXhrRequest(method, url) {\n  const xhr = new XMLHttpRequest();\n  // TODO(avimehta): IE 8/9 don't support XHR (with CORS). Use XDR instead\n  // if we plan to support those browsers.\n  if ('withCredentials' in xhr) {\n    xhr.open(method, url, true);\n  } else {\n    throw new Error('CORS is not supported');\n  }\n  return xhr;\n}\n\n/**\n * If 415 or in the 5xx range.\n * @param {number} status\n */\nfunction isRetriable(status) {\n  return status == 415 || (status >= 500 && status < 600);\n}\n\n\n/**\n * Returns the response if successful or otherwise throws an error.\n * @param {!FetchResponse} response\n * @return {!Promise<!FetchResponse>}\n * @private Visible for testing\n */\nexport function assertSuccess(response) {\n  return new Promise(resolve => {\n    if (response.ok) {\n      return resolve(response);\n    }\n\n    const {status} = response;\n    const err = new Error(`HTTP error ${status}`);\n    err.retriable = isRetriable(status);\n    // TODO(@jridgewell, #9448): Callers who need the response should\n    // skip processing.\n    err.response = response;\n    throw err;\n  });\n}\n\n\n/**\n * Response object in the Fetch API.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch\n */\nexport class FetchResponse {\n  /**\n   * @param {!XMLHttpRequest} xhr\n   */\n  constructor(xhr) {\n    /** @private @const {!XMLHttpRequest} */\n    this.xhr_ = xhr;\n\n    /** @const {number} */\n    this.status = this.xhr_.status;\n\n    /** @const {boolean} */\n    this.ok = this.status >= 200 && this.status < 300;\n\n    /** @const {!FetchResponseHeaders} */\n    this.headers = new FetchResponseHeaders(xhr);\n\n    /** @type {boolean} */\n    this.bodyUsed = false;\n\n    /** @type {?ReadableStream} */\n    this.body = null;\n  }\n\n  /**\n   * Create a copy of the response and return it.\n   * @return {!FetchResponse}\n   */\n  clone() {\n    assert(!this.bodyUsed, 'Body already used');\n    return new FetchResponse(this.xhr_);\n  }\n\n  /**\n   * Drains the response and returns the text.\n   * @return {!Promise<string>}\n   * @private\n   */\n  drainText_() {\n    assert(!this.bodyUsed, 'Body already used');\n    this.bodyUsed = true;\n    return Promise.resolve(this.xhr_.responseText);\n  }\n\n  /**\n   * Drains the response and returns a promise that resolves with the response\n   * text.\n   * @return {!Promise<string>}\n   */\n  text() {\n    return this.drainText_();\n  }\n\n  /**\n   * Drains the response and returns the JSON object.\n   * @return {!Promise<!JsonObject>}\n   */\n  json() {\n    return /** @type {!Promise<!JsonObject>} */ (\n        this.drainText_().then(parseJson));\n  }\n\n  /**\n   * Reads the xhr responseXML.\n   * @return {!Promise<!Document>}\n   * @private\n   */\n  document_() {\n    assert(!this.bodyUsed, 'Body already used');\n    this.bodyUsed = true;\n    assert(this.xhr_.responseXML,\n        'responseXML should exist. Make sure to return ' +\n        'Content-Type: text/html header.');\n    return /** @type {!Promise<!Document>} */ (\n        Promise.resolve(assert(this.xhr_.responseXML)));\n  }\n\n  /**\n   * Drains the response and returns a promise that resolves with the response\n   * ArrayBuffer.\n   * @return {!Promise<!ArrayBuffer>}\n   */\n  arrayBuffer() {\n    return /** @type {!Promise<!ArrayBuffer>} */ (\n        this.drainText_().then(utf8EncodeSync));\n  }\n}\n\n\n/**\n * Provides access to the response headers as defined in the Fetch API.\n * @private Visible for testing.\n */\nexport class FetchResponseHeaders {\n  /**\n   * @param {!XMLHttpRequest} xhr\n   */\n  constructor(xhr) {\n    /** @private @const {!XMLHttpRequest} */\n    this.xhr_ = xhr;\n  }\n\n  /**\n   * @param {string} name\n   * @return {string}\n   */\n  get(name) {\n    return this.xhr_.getResponseHeader(name);\n  }\n\n  /**\n   * @param {string} name\n   * @return {boolean}\n   */\n  has(name) {\n    return this.xhr_.getResponseHeader(name) != null;\n  }\n}\n","(function (global) {\n  var babelHelpers = global.babelHelpers = {};\n\n  babelHelpers.inherits = function (subClass, superClass) {\n    if (typeof superClass !== \"function\" && superClass !== null) {\n      throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  };\n\n  babelHelpers.createClass = (function () {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  })();\n\n  babelHelpers.slice = Array.prototype.slice;\n  babelHelpers.bind = Function.prototype.bind;\n\n  babelHelpers.interopRequireWildcard = function (obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n        }\n      }\n\n      newObj[\"default\"] = obj;\n      return newObj;\n    }\n  };\n\n  babelHelpers.interopRequireDefault = function (obj) {\n    return obj && obj.__esModule ? obj : { default: obj };\n  };\n\n  babelHelpers.get = function get(object, property, receiver) {\n    if (object === null) object = Function.prototype;\n    var desc = Object.getOwnPropertyDescriptor(object, property);\n\n    if (desc === undefined) {\n      var parent = Object.getPrototypeOf(object);\n\n      if (parent === null) {\n        return undefined;\n      } else {\n        return get(parent, property, receiver);\n      }\n    } else if (\"value\" in desc) {\n      return desc.value;\n    } else {\n      var getter = desc.get;\n\n      if (getter === undefined) {\n        return undefined;\n      }\n\n      return getter.call(receiver);\n    }\n  };\n\n  babelHelpers.classCallCheck = function (instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  };\n\n  babelHelpers.defineProperty = function(obj, key, value) {\n      obj[key] = value;\n      return obj;\n  };\n})(typeof global === \"undefined\" ? self : global);\n"]}